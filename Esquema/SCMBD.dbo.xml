<?xml version="1.0" encoding="UTF-8"?><database name="SCMBD" schema="dbo" type="Microsoft SQL Server - 15.00.2155">
   <tables>
      <table catalog="SCMBD" name="catAplicacionesTbl" numRows="1" remarks="Catálogo de Aplicaciones" schema="dbo" type="TABLE">
         <column autoUpdated="false" defaultValue="null" digits="0" id="0" name="idAplicacion" nullable="false" remarks="Identificador Único de Aplicación." size="2" type="smallint" typeCode="5">
            <child catalog="SCMBD" column="idAplicacion" foreignKey="Implied Constraint" implied="true" onDeleteCascade="false" schema="dbo" table="conEmisionNotificacionesTbl"/>
            <child catalog="SCMBD" column="idAplicacion" foreignKey="Implied Constraint" implied="true" onDeleteCascade="false" schema="dbo" table="movEnvioCorreosTbl"/>
            <child catalog="SCMBD" column="idAplicacion" foreignKey="segRelAplicacionUsuarioFk02" implied="false" onDeleteCascade="false" schema="dbo" table="segRelAplicacionUsuarioTbl"/>
         </column>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="descripcion" nullable="false" remarks="Nombre de la aplicación." size="100" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="((1))" digits="0" id="2" name="idEstatus" nullable="false" remarks="0 = Desactivado, 1 = Activo" size="1" type="bit" typeCode="-7"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="3" name="idUsuarioAct" nullable="false" remarks="CódiGo de Usuario que realizó la Actualización del Registro" size="2" type="smallint" typeCode="5"/>
         <column autoUpdated="false" defaultValue="(getdate())" digits="3" id="4" name="fechaAct" nullable="false" remarks="Última Fecha de Actualización del Registro" size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="5" name="ipAct" nullable="true" remarks="Última Dirección IP desde donde se efectuó la Actualización del Registro" size="30" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="6" name="macAddressAct" nullable="true" remarks="Última Dirección Mac desde donde se efectuó la Actualización del Registro" size="30" type="varchar" typeCode="12"/>
         <primaryKey column="idAplicacion" sequenceNumberInPK="1"/>
         <index name="catAplicacionesPk" unique="true">
            <column ascending="true" name="idAplicacion"/>
         </index>
      </table>
      <table catalog="SCMBD" name="catCaracterEspecTbl" numRows="27" remarks="Catálogo de Caracteres especiales Permitidos." schema="dbo" type="TABLE">
         <column autoUpdated="false" defaultValue="null" digits="0" id="0" name="caracter" nullable="false" remarks="Carácter Especial" size="1" type="char" typeCode="1"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="chrAscii" nullable="false" remarks="Código Ascii del Carácter Especial" size="2" type="smallint" typeCode="5"/>
         <primaryKey column="chrAscii" sequenceNumberInPK="1"/>
         <index name="catCaracterEspecPk" unique="true">
            <column ascending="true" name="chrAscii"/>
         </index>
      </table>
      <table catalog="SCMBD" name="catControlProcesosTbl" numRows="12" remarks="Tabla de Procesos de Mantenimientos a las Bases de Datos" schema="dbo" type="TABLE">
         <column autoUpdated="false" defaultValue="null" digits="0" id="0" name="idProceso" nullable="false" remarks="Identificador Correlativo del Proceso de Mantenimiento." size="2" type="smallint" typeCode="5"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="descripcion" nullable="false" remarks="Descripción del Proceso de Mantenimiento." size="100" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="2" name="procedimiento" nullable="false" remarks="Nombre del Procedimiento Relacionado al Proceso de Mantenimiento." size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="3" name="tablaLog" nullable="false" remarks="Nombre de la Tabla que Contiene el Log de Proceso." size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="('')" digits="0" id="4" name="mensaje" nullable="false" remarks="Mensaje del Proceso." size="2147483647" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="('')" digits="0" id="5" name="mensajeError" nullable="false" remarks="Mensaje de Error Para el Proceso." size="2147483647" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="((1))" digits="0" id="6" name="idTipoNotificacion" nullable="false" remarks="Identificador del Tipo de Notificación para la Notificación." size="1" type="tinyint" typeCode="-6"/>
         <column autoUpdated="false" defaultValue="((2))" digits="0" id="7" name="enviaNotificacion" nullable="false" remarks="Flag que indica si envia Notitificación. 0 = No, 1 = Solo con Errores, 2 = Siempre" size="1" type="tinyint" typeCode="-6"/>
         <column autoUpdated="false" defaultValue="((1))" digits="0" id="8" name="idFiltraError" nullable="false" remarks="Identificador de Filtro de Información solo por Procesos en Error" size="1" type="bit" typeCode="-7"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="9" name="link" nullable="true" remarks="Link de Información Adicional" size="512" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="10" name="codigoGrupoCorreo" nullable="true" remarks="Grupo de Usuarios a los Cuales se les informará sobre el resultado del proceso" size="20" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="11" name="periodicidad" nullable="true" remarks="Información sobre la periodicidad de ejecución del proceso." size="60" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="3" id="12" name="ultFechaEjecucion" nullable="true" remarks="Última fecha de ejecución del proceso." size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="((1))" digits="0" id="13" name="idEstatus" nullable="false" remarks="Identificador del Estatus del Registro." size="1" type="bit" typeCode="-7"/>
         <column autoUpdated="false" defaultValue="(getdate())" digits="3" id="14" name="fechaAct" nullable="false" remarks="Última Fecha de Actualización del Registro." size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="15" name="procedimientoNotif" nullable="true" remarks="Procedimiento que notifica el resultado del proceso." size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="3" id="16" name="ultFechaNotifif" nullable="true" remarks="Última fecha de Notificación del proceso." size="16" type="datetime" typeCode="93"/>
         <primaryKey column="idProceso" sequenceNumberInPK="1"/>
         <index name="catControlProcesosPk" unique="true">
            <column ascending="true" name="idProceso"/>
         </index>
         <checkConstraint constraint="([idTipoNotificacion]=(2) OR [idTipoNotificacion]=(1) OR [idTipoNotificacion]=(0))" name="catControlProcesosCk01"/>
      </table>
      <table catalog="SCMBD" name="catCorreosNoValidosTbl" numRows="0" remarks="Catalogo de correos no Válidos." schema="dbo" type="TABLE">
         <column autoUpdated="false" defaultValue="null" digits="0" id="0" name="Correo" nullable="false" remarks="Dirección de correo no Válido." size="260" type="varchar" typeCode="12">
            <child catalog="SCMBD" column="correo" foreignKey="Implied Constraint" implied="true" onDeleteCascade="false" schema="dbo" table="segUsuariosTbl"/>
         </column>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="Motivo" nullable="true" remarks="Motivo de correo no Válido." size="1000" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="(getdate())" digits="3" id="2" name="fechaAlta" nullable="false" remarks="F correo no Válido." size="16" type="datetime" typeCode="93"/>
         <primaryKey column="Correo" sequenceNumberInPK="1"/>
         <index name="catCorreosNoValidosPk" unique="true">
            <column ascending="true" name="Correo"/>
         </index>
      </table>
      <table catalog="SCMBD" name="catCriteriosTbl" numRows="48" remarks="CatáloGo de Criterios de Búsquedas." schema="dbo" type="TABLE">
         <column autoUpdated="false" defaultValue="null" digits="0" id="0" name="criterio" nullable="false" remarks="Criterio de Búsqueda de Valor" size="25" type="char" typeCode="1"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="valor" nullable="false" remarks="Valor del Criterio de Búsqueda" size="2" type="smallint" typeCode="5"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="2" name="descripcion" nullable="true" remarks="Descripción del Criterio de Búsqueda" size="60" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="3" name="valorAdicional" nullable="true" remarks="Valor Adicional al Criterio" size="250" type="varchar" typeCode="12"/>
         <primaryKey column="criterio" sequenceNumberInPK="1"/>
         <primaryKey column="valor" sequenceNumberInPK="2"/>
         <index name="catCriteriosTblPk" unique="true">
            <column ascending="true" name="criterio"/>
            <column ascending="true" name="valor"/>
         </index>
      </table>
      <table catalog="SCMBD" name="catGeneralesTbl" numRows="43" remarks="Tabla de Variables Generales Aplicables a Tablas Especificas." schema="dbo" type="TABLE">
         <column autoUpdated="false" defaultValue="null" digits="0" id="0" name="tabla" nullable="false" remarks="Nombre de la tabla a la cual se le van a referenciar las variables" size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="columna" nullable="false" remarks="Columna a la cual se le van a referenciar las variables" size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="2" name="valor" nullable="false" remarks="Valor de la variable" size="2" type="smallint" typeCode="5"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="3" name="descripcion" nullable="true" remarks="Descripción de la Variable" size="60" type="varchar" typeCode="12"/>
         <primaryKey column="tabla" sequenceNumberInPK="1"/>
         <primaryKey column="columna" sequenceNumberInPK="2"/>
         <primaryKey column="valor" sequenceNumberInPK="3"/>
         <index name="catGeneralesPk" unique="true">
            <column ascending="true" name="tabla"/>
            <column ascending="true" name="columna"/>
            <column ascending="true" name="valor"/>
         </index>
      </table>
      <table catalog="SCMBD" name="catMantenimentoTablasTbl" numRows="3" remarks="Catálogo de Tablas a ser depuradas." schema="dbo" type="TABLE">
         <column autoUpdated="true" defaultValue="null" digits="0" id="0" name="idProceso" nullable="false" remarks="Identificador Correlativo del Proceso de Mantenimiento" size="4" type="int identity" typeCode="4">
            <child catalog="SCMBD" column="secuencia" foreignKey="logMantenimientoDepTablaFk01" implied="false" onDeleteCascade="true" schema="dbo" table="logMantenimientoDepTablaTbl"/>
         </column>
         <column autoUpdated="false" defaultValue="(@@servername)" digits="0" id="1" name="servidor" nullable="false" remarks="Identificador del Servidor donde se realizó Proceso de Mantenimiento" size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="(db_name())" digits="0" id="2" name="baseDatos" nullable="false" remarks="Identificador de BD donde se realizará el Proceso de Mantenimiento" size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="3" name="tabla" nullable="false" remarks="Identificador de la entidad donde se realizará el Proceso de Mantenimiento" size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="((1))" digits="0" id="4" name="idTipoDep" nullable="false" remarks="Identificador del Tipo de Depuración Aplicacble a la Tabla." size="1" type="tinyint" typeCode="-6"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="5" name="campo" nullable="true" remarks="Columna de Comparación para el Proceso de Mantenimiento de la Tabla por Fecha." size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="((0))" digits="0" id="6" name="dias" nullable="false" remarks="Cantidad de Dias Mínimo para la Depuración de Datos de la Tabla." size="2" type="smallint" typeCode="5"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="7" name="procedimiento" nullable="true" remarks="Procedimiento a Ejecutar para la Depuración de la Tabla." size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="3" id="8" name="ultFechaProceso" nullable="true" remarks="Última Fecha de Depuración realizada." size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="(getdate())" digits="3" id="9" name="fechaAlta" nullable="false" remarks="Fecha de Alta del Registro." size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="(getdate())" digits="3" id="10" name="fechaAct" nullable="false" remarks="Última Fecha de Actualización del Registro." size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="((1))" digits="0" id="11" name="idEstatus" nullable="false" remarks="Identificador del Estatus del Registro." size="1" type="bit" typeCode="-7"/>
         <primaryKey column="idProceso" sequenceNumberInPK="1"/>
         <index name="catMantenimentoTablasPk" unique="true">
            <column ascending="true" name="idProceso"/>
         </index>
      </table>
      <table catalog="SCMBD" name="catMensajesErroresTbl" numRows="177" remarks="CátaloGo Generales" schema="dbo" type="TABLE">
         <column autoUpdated="false" defaultValue="null" digits="0" id="0" name="idError" nullable="false" remarks="Identificador del Código de Error" size="4" type="int" typeCode="4">
            <child catalog="SCMBD" column="idError" foreignKey="Implied Constraint" implied="true" onDeleteCascade="false" schema="dbo" table="LogErrorApiNotificacionesTbl"/>
            <child catalog="SCMBD" column="idError" foreignKey="Implied Constraint" implied="true" onDeleteCascade="false" schema="dbo" table="tmpLogError"/>
         </column>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="mensaje" nullable="true" remarks="Descipción del Error" size="250" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="2" name="idUsuarioAct" nullable="false" remarks="Identificador del Usuario que Actualizó el Registro" size="4" type="int" typeCode="4">
            <parent catalog="SCMBD" column="idUsuario" foreignKey="catMensajesErroresFk01" implied="false" onDeleteCascade="false" schema="dbo" table="segUsuariosTbl"/>
         </column>
         <column autoUpdated="false" defaultValue="(getdate())" digits="3" id="3" name="fechaAct" nullable="true" remarks="Última Fecha de  Actualización del Registro" size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="4" name="ipAct" nullable="true" remarks="Dirección IP desde donde se Actualizó el Registro" size="30" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="5" name="macAddressAct" nullable="true" remarks="Dirección Mac desde donde se Actualizó el Registro" size="30" type="varchar" typeCode="12"/>
         <primaryKey column="idError" sequenceNumberInPK="1"/>
         <index name="catMensajesErroresPk" unique="true">
            <column ascending="true" name="idError"/>
         </index>
      </table>
      <table catalog="SCMBD" name="catMonitoresPushTbl" numRows="0" remarks="Tabla de Control de Monitores de Envío de Notificaciones Push" schema="dbo" type="TABLE">
         <column autoUpdated="false" defaultValue="null" digits="0" id="0" name="idMonitor" nullable="false" remarks="Identificador Único del Monitor de Envío de Notificaciones Push" size="2" type="smallint" typeCode="5">
            <child catalog="SCMBD" column="idMonitor" foreignKey="catRelMonitorPushAplicacionFk01" implied="false" onDeleteCascade="true" schema="dbo" table="catRelMonitorPushAplicacionTbl"/>
            <child catalog="SCMBD" column="idMonitor" foreignKey="Implied Constraint" implied="true" onDeleteCascade="false" schema="dbo" table="movLogMonitoresPushTbl"/>
         </column>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="codigoMonitor" nullable="false" remarks="Código Único del Monitor de Envío de Notificaciones Push" size="20" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="2" name="descripcion" nullable="false" remarks="Descripción Monitor de Envío de Notificaciones Push" size="100" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="3" name="ubicacion" nullable="true" remarks="Ubicación Física del Monitor de Envío de Notificaciones Push" size="100" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="((1))" digits="0" id="4" name="idEstatus" nullable="false" remarks="Identificador del Estatus del Monitor. 1  = Habilitado, 0 = Deshabilitado." size="1" type="bit" typeCode="-7"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="5" name="idUsuarioAct" nullable="false" remarks="Última Usuario que Actualizó el Registro." size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="(getdate())" digits="3" id="6" name="fechaAct" nullable="false" remarks="Última Fecha de Actualización del Registro" size="16" type="datetime" typeCode="93"/>
         <primaryKey column="idMonitor" sequenceNumberInPK="1"/>
         <index name="catMonitoresPushPk" unique="true">
            <column ascending="true" name="idMonitor"/>
         </index>
      </table>
      <table catalog="SCMBD" name="catObjetosExcepcionTbl" numRows="0" remarks="Catálogo de Objetos Exceptuados de Análisis" schema="dbo" type="TABLE">
         <column autoUpdated="true" defaultValue="null" digits="0" id="0" name="idProceso" nullable="false" remarks="Identificador Correlativo del  Objeto Exceptuado." size="4" type="int identity" typeCode="4"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="baseDatos" nullable="false" remarks="Identificador de la base de datos que contiene el Objeto Exceptuado." size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="2" name="tipo" nullable="false" remarks="Identificador del tipo de Objeto Exceptuado." size="2" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="3" name="objeto" nullable="false" remarks="Nombre del Objeto Exceptuado." size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="(getdate())" digits="3" id="4" name="fechaAlta" nullable="false" remarks="Fecha de alta del registro" size="16" type="datetime" typeCode="93"/>
         <primaryKey column="idProceso" sequenceNumberInPK="1"/>
         <index name="catObjetosExcepcionPk" unique="true">
            <column ascending="true" name="idProceso"/>
         </index>
         <index name="catObjetosExcepcionIdx01" unique="true">
            <column ascending="true" name="baseDatos"/>
            <column ascending="true" name="objeto"/>
         </index>
      </table>
      <table catalog="SCMBD" name="catRelMonitorPushAplicacionTbl" numRows="0" remarks="Tabla de Relación de Monitor - Aplicación." schema="dbo" type="TABLE">
         <column autoUpdated="false" defaultValue="null" digits="0" id="0" name="idMonitor" nullable="false" remarks="Identificador Único del Monitor de Envío de Notificaciones Push" size="2" type="smallint" typeCode="5">
            <parent catalog="SCMBD" column="idMonitor" foreignKey="catRelMonitorPushAplicacionFk01" implied="false" onDeleteCascade="true" schema="dbo" table="catMonitoresPushTbl"/>
         </column>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="idAplicacion" nullable="false" remarks="Identificador Único de la Aplicación Relacionado al Monitor" size="2" type="smallint" typeCode="5"/>
         <column autoUpdated="false" defaultValue="((1))" digits="0" id="2" name="prioridad" nullable="false" remarks="Identificador de la Prioridad de Proceso de las Aplicaciones." size="2" type="smallint" typeCode="5"/>
         <column autoUpdated="false" defaultValue="((1))" digits="0" id="3" name="idEstatus" nullable="false" remarks="Identificador del Estatus de la Relación.1  = Habilitado, 0 = Deshabilitado." size="1" type="bit" typeCode="-7"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="4" name="idUsuarioAct" nullable="false" remarks="Última Usuario que Actualizó el Registro." size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="(getdate())" digits="3" id="5" name="fechaAct" nullable="false" remarks="Última Fecha de Actualización del Registro" size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="((0))" digits="0" id="6" name="idOrigen" nullable="false" remarks="Identificador de la Aplicación Origen de la Notificación" size="2" type="smallint" typeCode="5"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="7" name="idTipoMonitor" nullable="true" remarks="Identificador del M;onitor a usar para envío de Mensajes" size="2" type="smallint" typeCode="5"/>
         <primaryKey column="idMonitor" sequenceNumberInPK="1"/>
         <primaryKey column="idAplicacion" sequenceNumberInPK="2"/>
         <primaryKey column="idOrigen" sequenceNumberInPK="3"/>
         <index name="catRelMonitorPushAplicacionPk" unique="true">
            <column ascending="true" name="idMonitor"/>
            <column ascending="true" name="idAplicacion"/>
            <column ascending="true" name="idOrigen"/>
         </index>
      </table>
      <table catalog="SCMBD" name="conEmisionNotificacionesTbl" numRows="0" remarks="Tabla de control de envío de notificaciones" schema="dbo" type="TABLE">
         <column autoUpdated="false" defaultValue="null" digits="0" id="0" name="idSession" nullable="false" remarks="Identificador de la Sesión de Procesos" size="30" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="idAplicacion" nullable="false" remarks="Identificador de la Aplicación" size="2" type="smallint" typeCode="5">
            <parent catalog="SCMBD" column="idAplicacion" foreignKey="Implied Constraint" implied="true" onDeleteCascade="false" schema="dbo" table="catAplicacionesTbl"/>
         </column>
         <column autoUpdated="false" defaultValue="null" digits="0" id="2" name="idOrigen" nullable="false" remarks="Identificador del Origen de Conexión del Usuario Destinatario." size="2" type="smallint" typeCode="5"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="3" name="idPrioridad" nullable="false" remarks="Prioridad del Proceso de Emisión  de Notificaciones" size="1" type="tinyint" typeCode="-6"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="4" name="idMotivoCorreo" nullable="false" remarks="Identificador del Motivo de la Notificación." size="2" type="smallint" typeCode="5"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="5" name="idTipoNotificacion" nullable="false" remarks="Identificador del Tipo de Notificación. 0 = Correo, 1 = Push" size="1" type="tinyint" typeCode="-6"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="6" name="tokenGoogleDestinatario" nullable="true" remarks="Identificador del Token Google del Destinatario." size="500" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="7" name="correoDestinatario" nullable="true" remarks="Identificador del Correo del Destinatario." size="100" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="8" name="asunto" nullable="true" remarks="Asunto a lo se Refiere la Notificación." size="1000" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="9" name="body" nullable="true" remarks="Cuerpo de la Notificación." size="8000" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="10" name="urlArchivos" nullable="true" remarks="Direcci+on URL Relacionada a la Notificación." size="2000" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="11" name="adjuntos" nullable="true" remarks="Archivos Adjuntos a la Notificación." size="2000" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="12" name="observaciones" nullable="true" remarks="Observaciones Adicionales al Proceso de Notificación." size="8000" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="3" id="13" name="fechaEnvioNotificacion" nullable="true" remarks="Fecha de Envío de la Notificación." size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="(NULL)" digits="0" id="14" name="idEstatus" nullable="false" remarks="Identificador del Estratus del Proceso de Env+io de la Notificación." size="1" type="tinyint" typeCode="-6"/>
      </table>
      <table catalog="SCMBD" name="conGrupoReceptorCorreoDetTbl" numRows="2" remarks="Tabla Detalle de Grupo Receptor de Correo" schema="dbo" type="TABLE">
         <column autoUpdated="false" defaultValue="null" digits="0" id="0" name="idGrupo" nullable="false" remarks="Identificador Único de Grupo de Receptores de Correo" size="4" type="int" typeCode="4">
            <parent catalog="SCMBD" column="idGrupo" foreignKey="conGrupoReceptorCorreoDetFk01" implied="false" onDeleteCascade="true" schema="dbo" table="conGrupoReceptorCorreoTbl"/>
         </column>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="idReceptor" nullable="false" remarks="Identificador del Receptor de Correo" size="4" type="int" typeCode="4">
            <parent catalog="SCMBD" column="idUsuario" foreignKey="conGrupoReceptorCorreoDetFk03" implied="false" onDeleteCascade="false" schema="dbo" table="segUsuariosTbl"/>
         </column>
         <column autoUpdated="false" defaultValue="((1))" digits="0" id="2" name="idEstatus" nullable="false" remarks="Identificador del Estatus del Registro. 0 = Inhabilito, 1 = Activo" size="1" type="bit" typeCode="-7"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="3" name="idUsuarioAct" nullable="false" remarks="Identificador del Último Usuario que Actualizó el Registro" size="4" type="int" typeCode="4">
            <parent catalog="SCMBD" column="idUsuario" foreignKey="conGrupoReceptorCorreoDetFk02" implied="false" onDeleteCascade="false" schema="dbo" table="segUsuariosTbl"/>
         </column>
         <column autoUpdated="false" defaultValue="(getdate())" digits="3" id="4" name="fechaAct" nullable="false" remarks="Última Fecha de Actualización del Registro" size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="5" name="ipAct" nullable="true" remarks="Última Dirección IP desde Donde se Actualizo el Registro" size="30" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="6" name="macAddressAct" nullable="true" remarks="Última Dirección MAC desde Donde se Actualizo el Registro" size="30" type="varchar" typeCode="12"/>
         <primaryKey column="idGrupo" sequenceNumberInPK="1"/>
         <primaryKey column="idReceptor" sequenceNumberInPK="2"/>
         <index name="conGrupoReceptorCorreoDetPk" unique="true">
            <column ascending="true" name="idGrupo"/>
            <column ascending="true" name="idReceptor"/>
         </index>
      </table>
      <table catalog="SCMBD" name="conGrupoReceptorCorreoTbl" numRows="1" remarks="Catálogo de Grupo de Receptores de Correo por Aplicación" schema="dbo" type="TABLE">
         <column autoUpdated="false" defaultValue="null" digits="0" id="0" name="idGrupo" nullable="false" remarks="Identificador Único de Grupo de Receptores de Correo" size="4" type="int" typeCode="4">
            <child catalog="SCMBD" column="idGrupo" foreignKey="conGrupoReceptorCorreoDetFk01" implied="false" onDeleteCascade="true" schema="dbo" table="conGrupoReceptorCorreoDetTbl"/>
         </column>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="codigoGrupo" nullable="false" remarks="Código Único de Grupo de Receptores de Correo" size="20" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="2" name="descripcion" nullable="false" remarks="Descripción del Grupo de Receptores de Correo" size="100" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="3" name="idAplicacion" nullable="true" remarks="Identificador de la Aplicación Relacionada al Grupo" size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="4" name="idProcedimiento" nullable="true" remarks="Identificador de Procedimiento de Consulta a la Aplicación" size="4" type="int" typeCode="4">
            <parent catalog="SCMBD" column="idProcedimiento" foreignKey="conGrupoReceptorCorreoFk01" implied="false" onDeleteCascade="false" schema="dbo" table="conProcedimientosTbl"/>
         </column>
         <column autoUpdated="false" defaultValue="((1))" digits="0" id="5" name="idEstatus" nullable="false" remarks="Identificador del Estatus del Registro. 0 = Inhabilito, 1 = Activo" size="1" type="bit" typeCode="-7"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="6" name="idUsuarioAct" nullable="false" remarks="Identificador del Último Usuario que Actualizó el Registro" size="4" type="int" typeCode="4">
            <parent catalog="SCMBD" column="idUsuario" foreignKey="conGrupoReceptorCorreoFk02" implied="false" onDeleteCascade="false" schema="dbo" table="segUsuariosTbl"/>
         </column>
         <column autoUpdated="false" defaultValue="(getdate())" digits="3" id="7" name="fechaAct" nullable="false" remarks="Última Fecha de Actualización del Registro" size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="8" name="ipAct" nullable="true" remarks="Última Dirección IP desde Donde se Actualizo el Registro" size="30" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="9" name="macAddressAct" nullable="true" remarks="Última Dirección MAC desde Donde se Actualizo el Registro" size="30" type="varchar" typeCode="12"/>
         <primaryKey column="idGrupo" sequenceNumberInPK="1"/>
         <index name="conGrupoReceptorCorreoPk" unique="true">
            <column ascending="true" name="idGrupo"/>
         </index>
      </table>
      <table catalog="SCMBD" name="conMotivosCorreoTbl" numRows="8" remarks="Catálogo de Configuración de Motivos de Emisión de Correos." schema="dbo" type="TABLE">
         <column autoUpdated="false" defaultValue="null" digits="0" id="0" name="idMotivo" nullable="false" remarks="Código de Motivo de Emisión de Correo" size="2" type="smallint" typeCode="5">
            <child catalog="SCMBD" column="idMotivoCorreo" foreignKey="conProcedimientosCorreoFk01" implied="false" onDeleteCascade="false" schema="dbo" table="conProcedimientosCorreoTbl"/>
            <child catalog="SCMBD" column="idMotivoCorreo" foreignKey="conProcesosFk02" implied="false" onDeleteCascade="false" schema="dbo" table="conProcesosTbl"/>
         </column>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="descripcion" nullable="true" remarks="Decripción Motivo de Emisión de Correo" size="100" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="2" name="titulo" nullable="false" remarks="Titulo del Correo" size="1000" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="3" name="cuerpo" nullable="false" remarks="Texto del Correo" size="8000" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="4" name="URL" nullable="true" remarks="Dirección URL de Apoyo para Envío de Notificaciones" size="1000" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="5" name="idUsuarioAct" nullable="false" remarks="Identificador del Último Usuario que Actualizó el Registro" size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="(getdate())" digits="3" id="6" name="fechaAct" nullable="false" remarks="Ultima fecha de actualiazción del Registro" size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="7" name="ipAct" nullable="true" remarks="Última Dirección IP desde Donde se Actualizo el Registro" size="30" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="8" name="macAddressAct" nullable="true" remarks="Última Dirección MAC desde Donde se Actualizo el Registro" size="30" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="((0))" digits="0" id="9" name="permiteCompartir" nullable="false" remarks="Bandera que Indica si el Motivo de Correo puede ser Compartido" size="1" type="bit" typeCode="-7"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="10" name="html" nullable="true" remarks="Texto del Correo  en Formato HTML" size="8000" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="11" name="perfilCorreo" nullable="false" remarks="Perfil de Correo Relacionado al Motivo de Correo" size="256" type="sysname" typeCode="-9"/>
         <primaryKey column="idMotivo" sequenceNumberInPK="1"/>
         <index name="conMotivosCorreoPk" unique="true">
            <column ascending="true" name="idMotivo"/>
         </index>
      </table>
      <table catalog="SCMBD" name="conParametrosCorreoTbl" numRows="0" remarks="Catálogo de los Parámetros de Correo por Aplicación" schema="dbo" type="TABLE">
         <column autoUpdated="false" defaultValue="null" digits="0" id="0" name="idAplicacion" nullable="false" remarks="Código de Aplicación" size="2" type="smallint" typeCode="5"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="idParametro" nullable="false" remarks="Código de Parámetro de Correo" size="2" type="smallint" typeCode="5"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="2" name="descripcion" nullable="false" remarks="Descripción del Parámetro de Correo" size="100" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="3" name="valorNumerico" nullable="true" remarks="Valor Numérico del Parámetro" size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="4" name="valorAlfa" nullable="true" remarks="Valor Alfanumérico del Parámetro" size="250" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="5" name="valorTexto" nullable="true" remarks="Valor Texto del Parámetro" size="2147483647" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="3" id="6" name="valorFecha" nullable="true" remarks="Valor Fecha del Parámetro" size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="7" name="idUsuarioAct" nullable="false" remarks="Código de Usuario que Actualizó el Registro" size="4" type="int" typeCode="4">
            <parent catalog="SCMBD" column="idUsuario" foreignKey="conParametrosGralesFk01" implied="false" onDeleteCascade="false" schema="dbo" table="segUsuariosTbl"/>
         </column>
         <column autoUpdated="false" defaultValue="null" digits="3" id="8" name="fechaAct" nullable="false" remarks="Última Fecha de Actualización del Registro" size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="9" name="ipAct" nullable="true" remarks="Dirección IP desde donde se Actualizó el Registro" size="30" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="10" name="macAddressAct" nullable="true" remarks="Dirección MAC desde donde se Actualizó el Registro" size="30" type="varchar" typeCode="12"/>
         <primaryKey column="idAplicacion" sequenceNumberInPK="1"/>
         <primaryKey column="idParametro" sequenceNumberInPK="2"/>
         <index name="conParametrosCorreoPk" unique="true">
            <column ascending="true" name="idAplicacion"/>
            <column ascending="true" name="idParametro"/>
         </index>
      </table>
      <table catalog="SCMBD" name="conParametrosGralesTbl" numRows="31" remarks="CatáloGo de Parámetros de Generales de Configuración" schema="dbo" type="TABLE">
         <column autoUpdated="false" defaultValue="null" digits="0" id="0" name="idParametroGral" nullable="false" remarks="CódiGo de Parámetro General de Configuración" size="2" type="smallint" typeCode="5"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="descripcion" nullable="true" remarks="Descripción de Parámetro General de Configuración" size="100" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="2" name="parametroChar" nullable="true" remarks="Parámetro Tipo Char." size="1000" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="6" id="3" name="parametroNumber" nullable="true" remarks="Parámetro Tipo Numerico." size="26" type="numeric" typeCode="2"/>
         <column autoUpdated="false" defaultValue="null" digits="3" id="4" name="parametroFecha" nullable="true" remarks="Parámetro Tipo Fecha." size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="5" name="idUsuarioAct" nullable="false" remarks="CódiGo de Usuario que realizó última actualizacion" size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="(getdate())" digits="3" id="6" name="fechaAct" nullable="false" remarks="Fecha de Aactualización del Registro" size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="7" name="ipAct" nullable="true" remarks="Última Dirección IP desde donde se efectuó la Actualización del Registro" size="30" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="8" name="macAddressAct" nullable="true" remarks="Última Dirección Mac desde donde se efectuó la Actualización del Registro" size="30" type="varchar" typeCode="12"/>
         <primaryKey column="idParametroGral" sequenceNumberInPK="1"/>
         <index name="conParametrosGralesPk" unique="true">
            <column ascending="true" name="idParametroGral"/>
         </index>
      </table>
      <table catalog="SCMBD" name="conProcedimientosCorreoTbl" numRows="3" remarks="Tabla de Relación de Procedimiento a Motivos de Correo." schema="dbo" type="TABLE">
         <column autoUpdated="false" defaultValue="null" digits="0" id="0" name="idMotivoCorreo" nullable="false" remarks="Identificador del Motivo de Correo." size="2" type="smallint" typeCode="5">
            <parent catalog="SCMBD" column="idMotivo" foreignKey="conProcedimientosCorreoFk01" implied="false" onDeleteCascade="false" schema="dbo" table="conMotivosCorreoTbl"/>
         </column>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="idProcedimiento" nullable="false" remarks="Identificador del Procedimiento Relacionado al Motivo de Correo." size="2" type="smallint" typeCode="5"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="2" name="codigoProcedimiento" nullable="false" remarks="Código Único del Procedimiento Relacionado al Motivo de Correo." size="50" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="3" name="procedimiento" nullable="false" remarks="Nombre del Procedimiento Relacionado al Motivo de Correo." size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="4" name="idUsuarioAct" nullable="false" remarks="ïdentificador del Último Usuario que Actualizó´ el Registro." size="2" type="smallint" typeCode="5"/>
         <column autoUpdated="false" defaultValue="null" digits="3" id="5" name="fechaAct" nullable="false" remarks="Última Fecha de Actualización del Registro." size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="6" name="ipAct" nullable="true" remarks="Última Dirección IP Desde Donde se Actualizó  el Registro." size="30" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="7" name="macAddressAct" nullable="true" remarks="Última Dirección MAC  Desde Donde se Actualizó  el Registro." size="30" type="varchar" typeCode="12"/>
         <primaryKey column="idMotivoCorreo" sequenceNumberInPK="1"/>
         <primaryKey column="idProcedimiento" sequenceNumberInPK="2"/>
         <index name="conProcedimientosCorreoPk" unique="true">
            <column ascending="true" name="idMotivoCorreo"/>
            <column ascending="true" name="idProcedimiento"/>
         </index>
      </table>
      <table catalog="SCMBD" name="conProcedimientosTbl" numRows="0" remarks="Catálogo de Procedimientos de Consultas Especiales" schema="dbo" type="TABLE">
         <column autoUpdated="true" defaultValue="null" digits="0" id="0" name="idProcedimiento" nullable="false" remarks="Identificador Único del Procedimiento" size="4" type="int identity" typeCode="4">
            <child catalog="SCMBD" column="idProcedimiento" foreignKey="conGrupoReceptorCorreoFk01" implied="false" onDeleteCascade="false" schema="dbo" table="conGrupoReceptorCorreoTbl"/>
         </column>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="codigoProcedimiento" nullable="false" remarks="Código Único del Procedimiento" size="20" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="2" name="descripcion" nullable="false" remarks="Descripción Único del Procedimiento" size="100" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="3" name="procedimiento" nullable="false" remarks="Nombre del Procedimiento a Usar" size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="((1))" digits="0" id="4" name="idEstatus" nullable="false" remarks="Identificador del Estatus del Registro. 0 = Inhabilitado, 1 = Activo" size="1" type="bit" typeCode="-7"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="5" name="idUsuarioAct" nullable="false" remarks="Identificador del Último Usuario que Actualizó el Registro" size="4" type="int" typeCode="4">
            <parent catalog="SCMBD" column="idUsuario" foreignKey="conProcedimientosFk01" implied="false" onDeleteCascade="false" schema="dbo" table="segUsuariosTbl"/>
         </column>
         <column autoUpdated="false" defaultValue="null" digits="3" id="6" name="fechaAct" nullable="false" remarks="Última Fecha de Actualización del Registro" size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="7" name="ipAct" nullable="true" remarks="Última Dirección IP desde donde se Actualizó el Registro" size="30" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="8" name="macAddressAct" nullable="true" remarks="Última Dirección MAC desde donde se Actualizó el Registro" size="30" type="varchar" typeCode="12"/>
         <primaryKey column="idProcedimiento" sequenceNumberInPK="1"/>
         <index name="conProcedimientosPk" unique="true">
            <column ascending="true" name="idProcedimiento"/>
         </index>
      </table>
      <table catalog="SCMBD" name="conProcesosTbl" numRows="13" remarks="Tabla de Control de Procesos y Emisión de Correos." schema="dbo" type="TABLE">
         <column autoUpdated="true" defaultValue="null" digits="0" id="0" name="idProceso" nullable="false" remarks="Identificador Único del Proceso." size="4" type="int identity" typeCode="4">
            <child catalog="SCMBD" column="idProceso" foreignKey="movDatosAdicionalesCorreoFk01" implied="false" onDeleteCascade="true" schema="dbo" table="movDatosAdicionalesCorreoTbl"/>
         </column>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="idMotivoCorreo" nullable="false" remarks="Identificador del Motivo de Notificación." size="2" type="smallint" typeCode="5">
            <parent catalog="SCMBD" column="idMotivo" foreignKey="conProcesosFk02" implied="false" onDeleteCascade="false" schema="dbo" table="conMotivosCorreoTbl"/>
         </column>
         <column autoUpdated="false" defaultValue="null" digits="0" id="2" name="idTipoNotificacion" nullable="false" remarks="Identificador del Tipo de Notificación, 0 = Push, 1 = Correo, 2 Ambos." size="1" type="tinyint" typeCode="-6"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="3" name="idUsuario" nullable="false" remarks="Identificador del Usuario que Genera la Acción de Emisión del Correo." size="2" type="smallint" typeCode="5"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="4" name="parametros" nullable="false" remarks="Parámetros de Emisión del Correo." size="8000" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="3" id="5" name="fechaProgramada" nullable="false" remarks="Fecha Programada de Emisión del Correo." size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="null" digits="3" id="6" name="fechaInicio" nullable="true" remarks="Fecha y Hora de Inicio del Proceso o Emisión del Correo." size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="null" digits="3" id="7" name="fechaTermino" nullable="true" remarks="Fecha y Hora de Termino del Proceso o Emisión del Correo." size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="((0.00))" digits="6" id="8" name="tiempoProceso" nullable="false" remarks="Tiempo de Proceso o Emisión del Correo." size="20" type="numeric" typeCode="2"/>
         <column autoUpdated="false" defaultValue="((0))" digits="0" id="9" name="registrosProcesados" nullable="false" remarks="Cantidad de Registros Procesados." size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="10" name="urlArchivoSalida" nullable="true" remarks="Dirección Física y nombre del Archivo Generado." size="200" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="11" name="mensajeProc" nullable="true" remarks="Mensajes del Proceso Realizado." size="1000" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="12" name="tablaSalida" nullable="true" remarks="Nombre de la Tabla donde se Alojan los Datos de Resultantes del Proceso" size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="13" name="idSession" nullable="true" remarks="Identificador de la sesión de Proceso" size="60" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="((1))" digits="0" id="14" name="idEstatus" nullable="false" remarks="Identificador del Estatus del Proceso. 1 = Pendiente, 2 = Proceso, 3 = Terminado Ok, 4 = Terminado con Error" size="1" type="tinyint" typeCode="-6"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="15" name="idUsuarioAct" nullable="false" remarks="Identificador del Usuario que Realizó la Última actualización" size="2" type="smallint" typeCode="5"/>
         <column autoUpdated="false" defaultValue="null" digits="3" id="16" name="fechaAct" nullable="false" remarks="Última Fecha de Actualización del Registro" size="16" type="datetime" typeCode="93"/>
         <primaryKey column="idProceso" sequenceNumberInPK="1"/>
         <index name="conProcesosPk" unique="true">
            <column ascending="true" name="idProceso"/>
         </index>
         <checkConstraint constraint="([idTipoNotificacion]&gt;=(0) AND [idTipoNotificacion]&lt;=(2))" name="conProcesosCk01"/>
      </table>
      <table catalog="SCMBD" name="logAnalisisJobsTbl" numRows="8" remarks="Log de Análisis de Jobs con Errores en su Ejecución." schema="dbo" type="TABLE">
         <column autoUpdated="false" defaultValue="null" digits="0" id="0" name="idProceso" nullable="false" remarks="Identificador Correlativo del Proceso de Análisis." size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="secuencia" nullable="false" remarks="Secuencia del Correlativo del Proceso de Análisis." size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="2" name="servidor" nullable="false" remarks="Identificador del Servidor donde se realizó Proceso de Análisis." size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="3" name="Job" nullable="false" remarks="Identificador del Job que presento Problemas." size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="4" name="idPaso" nullable="false" remarks="Identificador del Paso del Job que presento Problemas." size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="5" name="nombrePaso" nullable="false" remarks="Nombre del Paso del Job que presento Problemas." size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="(getdate())" digits="3" id="6" name="fechaInicio" nullable="false" remarks="Fecha de Ejecución del Job que presento Problemas" size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="null" digits="3" id="7" name="fechaTermino" nullable="true" remarks="Fecha de Ejecución de la Consulta a la Actividad de los Jobs" size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="((0))" digits="0" id="8" name="informado" nullable="false" remarks="Estatus del Proceso de Información del Error Enconstrado" size="1" type="tinyint" typeCode="-6"/>
         <column autoUpdated="false" defaultValue="((0))" digits="0" id="9" name="error" nullable="false" remarks="Identificador del Error encontrado durante la Ejecución del Job" size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="('')" digits="0" id="10" name="mensajeError" nullable="false" remarks="Descripción del Error encontrado durante la Ejecución del Job" size="8000" type="nvarchar" typeCode="-9"/>
         <primaryKey column="idProceso" sequenceNumberInPK="1"/>
         <primaryKey column="secuencia" sequenceNumberInPK="2"/>
         <index name="logAnalisisJobsPk" unique="true">
            <column ascending="true" name="idProceso"/>
            <column ascending="true" name="secuencia"/>
         </index>
         <index name="logAnalisisJobsIdex01" unique="false">
            <column ascending="true" name="fechaTermino"/>
            <column ascending="true" name="informado"/>
         </index>
         <index name="logAnalisisJobsIdex02" unique="true">
            <column ascending="true" name="servidor"/>
            <column ascending="true" name="Job"/>
            <column ascending="true" name="idPaso"/>
            <column ascending="true" name="fechaInicio"/>
         </index>
      </table>
      <table catalog="SCMBD" name="logAnalisisLSTbl" numRows="7" remarks="Log de Procesos de Análisis de Link Sever." schema="dbo" type="TABLE">
         <column autoUpdated="false" defaultValue="null" digits="0" id="0" name="idProceso" nullable="false" remarks="Identificador Correlativo del Proceso de Análisis" size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="Secuencia" nullable="false" remarks="Identificador de la Secuencia del Proceso de Análisis" size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="2" name="servidor" nullable="false" remarks="Identificador del Servidor donde se realizó Proceso de Análisis LS" size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="3" name="linkServer" nullable="false" remarks="Identificador de donde se realizó Proceso de Análisis" size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="4" name="actividad" nullable="false" remarks="Descripción de la Actividad a Ejecutar" size="2147483647" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="(getdate())" digits="3" id="5" name="fechaInicio" nullable="false" remarks="Fecha de Inicio de la Actividad" size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="null" digits="3" id="6" name="fechaTermino" nullable="true" remarks="Fecha Termino  de la Actividad" size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="((0))" digits="0" id="7" name="error" nullable="false" remarks="Identificador del Error encontrado durante el proceso" size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="('')" digits="0" id="8" name="mensajeError" nullable="false" remarks="Descripción del Error encontrado durante el proceso de Análisis" size="250" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="((0))" digits="0" id="9" name="informado" nullable="false" remarks="Estatus del Proceso de Información del Error Enconstrado" size="1" type="tinyint" typeCode="-6"/>
         <primaryKey column="idProceso" sequenceNumberInPK="1"/>
         <primaryKey column="Secuencia" sequenceNumberInPK="2"/>
         <index name="logAnalisisLSPk" unique="true">
            <column ascending="true" name="idProceso"/>
            <column ascending="true" name="Secuencia"/>
         </index>
      </table>
      <table catalog="SCMBD" name="logAnalisisObjetosNoValidosTbl" numRows="20" remarks="Catálogo de Tablas de Objetos No Validos." schema="dbo" type="TABLE">
         <column autoUpdated="false" defaultValue="null" digits="0" id="0" name="idProceso" nullable="false" remarks="Identificador Correlativo del Proceso de Consulta de Objetos No Validos" size="8" type="bigint" typeCode="-5"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="correlativo" nullable="false" remarks="Secuencia del Proceso de Consulta de Objetos No Validos" size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="2" name="servidor" nullable="false" remarks="Identificador del Servidor con  Problemas de Objetos No Validos" size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="3" name="databaseName" nullable="false" remarks="Base de Datos con Problemas de Objetos No Validos" size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="4" name="tipo" nullable="false" remarks="Tipo de Objeto No Valido" size="2" type="char" typeCode="1"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="5" name="objectName" nullable="false" remarks="Identificador del Objeto No Valido" size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="6" name="ErrorMensaje" nullable="false" remarks="Mensaje del Error en el Objeto No Valido" size="2147483647" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="(getdate())" digits="0" id="7" name="fechaConsulta" nullable="false" remarks="Fecha de la Consulta de Objeto No Valido" size="6" type="date" typeCode="91"/>
         <column autoUpdated="false" defaultValue="(getdate())" digits="0" id="8" name="fechaInicio" nullable="false" remarks="Fecha de Inicio del Proceso de Consulta de Objeto No Valido" size="6" type="date" typeCode="91"/>
         <column autoUpdated="false" defaultValue="null" digits="3" id="9" name="fechaTermino" nullable="true" remarks="Fecha de Inicio del Proceso de Consulta de Objeto No Valido" size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="((0))" digits="0" id="10" name="informado" nullable="false" remarks="Indica si fue reportada la incidencia de Objetos No Validos" size="1" type="tinyint" typeCode="-6"/>
         <primaryKey column="idProceso" sequenceNumberInPK="1"/>
         <primaryKey column="correlativo" sequenceNumberInPK="2"/>
         <index name="logAnalisisObjetosNoValidosPk" unique="true">
            <column ascending="true" name="idProceso"/>
            <column ascending="true" name="correlativo"/>
         </index>
         <index name="logAnalisisObjetosNoValidosIdx01" unique="false">
            <column ascending="true" name="tipo"/>
            <column ascending="true" name="objectName"/>
         </index>
      </table>
      <table catalog="SCMBD" name="LogErrorApiNotificacionesTbl" numRows="0" remarks="Tabla de Movimientos de Error en llamados y ejecución de la API de emisión de notificaciones" schema="dbo" type="TABLE">
         <column autoUpdated="true" defaultValue="null" digits="0" id="0" name="idMovimiento" nullable="false" remarks="Identificador Correlativo en Movimientos con Error." size="8" type="bigint identity" typeCode="-5"/>
         <column autoUpdated="false" defaultValue="(getdate())" digits="3" id="1" name="fechaMovimiento" nullable="false" remarks="Fecha del Movimiento con Error." size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="2" name="cadena" nullable="false" remarks="Cadena de Ejecución que Causo el Error." size="250" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="3" name="acccion" nullable="false" remarks="Acción Sobre la Ejecución de la API que presentó el Error." size="100" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="4" name="idError" nullable="false" remarks="Código del Error de la Ejecución de la API." size="4" type="int" typeCode="4">
            <parent catalog="SCMBD" column="idError" foreignKey="Implied Constraint" implied="true" onDeleteCascade="false" schema="dbo" table="catMensajesErroresTbl"/>
         </column>
         <column autoUpdated="false" defaultValue="null" digits="0" id="5" name="mensajeError" nullable="false" remarks="Código del Error de la Ejecución de la API." size="250" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="6" name="informado" nullable="false" remarks="Indica si el Error fue informado." size="1" type="tinyint" typeCode="-6"/>
         <primaryKey column="idMovimiento" sequenceNumberInPK="1"/>
         <index name="LogErrorApiNotificacionesPk" unique="true">
            <column ascending="true" name="idMovimiento"/>
         </index>
      </table>
      <table catalog="SCMBD" name="logHistorialEjecucionProcTbl" numRows="6" remarks="Historial de Ejecuciones de Procedimientos." schema="dbo" type="TABLE">
         <column autoUpdated="false" defaultValue="null" digits="0" id="0" name="idProceso" nullable="false" remarks="Identificador del Proceso de Análisis." size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="secuencia" nullable="false" remarks="Identificador Correlativo del Proceso de Análisis." size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="2" name="baseDatos" nullable="false" remarks="Base de datos donde se ejecuta el Proceso de Análisis." size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="3" name="procedimiento" nullable="false" remarks="Nombre del Procedimiento Ejecutado." size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="3" id="4" name="ultimaEjecucion" nullable="false" remarks="Última Fecha de Ejecución del Procedimiento." size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="null" digits="3" id="5" name="fechaProcesoAnt" nullable="false" remarks="Fecha Anterior de Consulta de Ejecución." size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="(getdate())" digits="3" id="6" name="fechaProcesoAct" nullable="false" remarks="Fecha Actual de Consulta de Ejecución." size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="((0))" digits="0" id="7" name="dias" nullable="false" remarks="Días de Análisis del Proceso." size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="((0))" digits="0" id="8" name="cantidad" nullable="false" remarks="Cantidad de ejecuciones del procedimiento durante el período analizado." size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="((0))" digits="2" id="9" name="tiempoMinimo" nullable="false" remarks="Tiempo Mínimo de ejecución del procedimiento en el período analizado" size="20" type="decimal" typeCode="3"/>
         <column autoUpdated="false" defaultValue="((0))" digits="2" id="10" name="tiempoMaximo" nullable="false" remarks="Tiempo Máximo de ejecución del procedimiento en el período analizado" size="20" type="decimal" typeCode="3"/>
         <column autoUpdated="false" defaultValue="((0))" digits="0" id="11" name="informado" nullable="false" remarks="Estatus del envío del resulatado de la consulta del Proceso" size="1" type="tinyint" typeCode="-6"/>
         <primaryKey column="idProceso" sequenceNumberInPK="1"/>
         <primaryKey column="secuencia" sequenceNumberInPK="2"/>
         <index name="logHistorialEjecucionProcPk" unique="true">
            <column ascending="true" name="idProceso"/>
            <column ascending="true" name="secuencia"/>
         </index>
         <index name="logHistorialEjecucionProcIdx01" unique="true">
            <column ascending="true" name="baseDatos"/>
            <column ascending="true" name="procedimiento"/>
            <column ascending="true" name="fechaProcesoAct"/>
         </index>
      </table>
      <table catalog="SCMBD" name="logMantenimientoBDTbl" numRows="12" remarks="Log de Procesos de Mantenimiento de Base de Datos." schema="dbo" type="TABLE">
         <column autoUpdated="true" defaultValue="null" digits="0" id="0" name="idProceso" nullable="false" remarks="Identificador Correlativo del Proceso de Mantenimiento" size="4" type="int identity" typeCode="4"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="servidor" nullable="false" remarks="Identificador del Servidor donde se realizó Proceso de Mantenimiento" size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="2" name="baseDatos" nullable="false" remarks="Identificador de donde se realizó Proceso de Mantenimiento" size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="3" name="actividad" nullable="false" remarks="Descripción de la Actividad a Ejecutar" size="2147483647" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="(getdate())" digits="3" id="4" name="fechaInicio" nullable="false" remarks="Fecha de Inicio de la Actividad" size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="null" digits="3" id="5" name="fechaTermino" nullable="true" remarks="Fecha Termino  de la Actividad" size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="((0))" digits="0" id="6" name="error" nullable="false" remarks="Identificador del Error encontrado durante el proceso" size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="('')" digits="0" id="7" name="mensajeError" nullable="false" remarks="Descripción del Error encontrado durante el proceso" size="250" type="varchar" typeCode="12"/>
         <primaryKey column="idProceso" sequenceNumberInPK="1"/>
         <index name="logMantenimientoBDPk" unique="true">
            <column ascending="true" name="idProceso"/>
         </index>
      </table>
      <table catalog="SCMBD" name="logMantenimientoDepTablaTbl" numRows="6" remarks="Log de Procesos de Depuración de Información de tablas." schema="dbo" type="TABLE">
         <column autoUpdated="false" defaultValue="null" digits="0" id="0" name="idProceso" nullable="false" remarks="Identificador Correlativo del Proceso de Depuración" size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="secuencia" nullable="false" remarks="Secuencia del Correlativo del Proceso de Depuración" size="4" type="int" typeCode="4">
            <parent catalog="SCMBD" column="idProceso" foreignKey="logMantenimientoDepTablaFk01" implied="false" onDeleteCascade="true" schema="dbo" table="catMantenimentoTablasTbl"/>
         </column>
         <column autoUpdated="false" defaultValue="(@@servername)" digits="0" id="2" name="servidor" nullable="false" remarks="Identificador del Servidor donde se realizó Proceso de Depuración" size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="3" name="baseDatos" nullable="false" remarks="" size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="4" name="tabla" nullable="false" remarks="Identificador de la Tabla donde se realizó Proceso de Depuración" size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="((0))" digits="0" id="5" name="registros" nullable="false" remarks="Número de Registros Depurados en la Tabla." size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="(getdate())" digits="3" id="6" name="fechaInicio" nullable="false" remarks="Fecha de Inicio de la Actividad" size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="null" digits="3" id="7" name="fechaTermino" nullable="true" remarks="Fecha Termino  de la Actividad" size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="((0))" digits="0" id="8" name="error" nullable="false" remarks="Identificador del Error encontrado durante el proceso" size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="('')" digits="0" id="9" name="mensajeError" nullable="false" remarks="Descripción del Error encontrado durante el proceso de Depuración" size="250" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="((0))" digits="0" id="10" name="informado" nullable="false" remarks="Estatus que indica si fue notificado el evento de error." size="1" type="tinyint" typeCode="-6"/>
         <primaryKey column="idProceso" sequenceNumberInPK="1"/>
         <primaryKey column="secuencia" sequenceNumberInPK="2"/>
         <index name="logMantenimientoDepTablaPk" unique="true">
            <column ascending="true" name="idProceso"/>
            <column ascending="true" name="secuencia"/>
         </index>
      </table>
      <table catalog="SCMBD" name="logMantenIndicesDetTbl" numRows="138" remarks="Log Detallado de Proceso Mantenimiento de Índices." schema="dbo" type="TABLE">
         <column autoUpdated="true" defaultValue="null" digits="0" id="0" name="idProcesoDet" nullable="false" remarks="Identificador Correlativo del Detalle de Proceso de Mantenimiento." size="4" type="int identity" typeCode="4"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="idProceso" nullable="false" remarks="Identificador Correlativo del Proceso Padre de Mantenimiento." size="4" type="int" typeCode="4">
            <parent catalog="SCMBD" column="idProceso" foreignKey="logMantenIndicesDetFk01" implied="false" onDeleteCascade="true" schema="dbo" table="logMantenIndicesTbl"/>
         </column>
         <column autoUpdated="false" defaultValue="null" digits="0" id="2" name="secuencia" nullable="false" remarks="Correlativo del Identificador del Proceso de Mantenimiento." size="2" type="smallint" typeCode="5">
            <parent catalog="SCMBD" column="secuencia" foreignKey="logMantenIndicesDetFk01" implied="false" onDeleteCascade="true" schema="dbo" table="logMantenIndicesTbl"/>
         </column>
         <column autoUpdated="false" defaultValue="null" digits="0" id="3" name="actividad" nullable="false" remarks="Descripción de la actividad." size="100" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="(getdate())" digits="3" id="4" name="fechaInicio" nullable="false" remarks="Fecha de Inicio del Proceso de Mantenimiento" size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="null" digits="3" id="5" name="fechaTermino" nullable="true" remarks="Fecha Termino del Proceso de Mantenimiento" size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="((0))" digits="0" id="6" name="error" nullable="false" remarks="Identificador del Error encontrado durante el Proceso de Mantenimiento." size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="('')" digits="0" id="7" name="mensajeError" nullable="false" remarks="Descripción del Error encontrado durante el Proceso de Mantenimiento." size="8000" type="nvarchar" typeCode="-9"/>
         <primaryKey column="idProcesoDet" sequenceNumberInPK="1"/>
         <index name="logMantenIndicesDetPk" unique="true">
            <column ascending="true" name="idProcesoDet"/>
         </index>
         <index name="logMantenIndicesDetIdx01" unique="false">
            <column ascending="true" name="idProceso"/>
            <column ascending="true" name="secuencia"/>
         </index>
      </table>
      <table catalog="SCMBD" name="logMantenIndicesTbl" numRows="1" remarks="Log de Proceso Mantenimiento de Índices." schema="dbo" type="TABLE">
         <column autoUpdated="false" defaultValue="null" digits="0" id="0" name="idProceso" nullable="false" remarks="Identificador Correlativo del Proceso de Mantenimiento." size="4" type="int" typeCode="4">
            <child catalog="SCMBD" column="idProceso" foreignKey="logMantenIndicesDetFk01" implied="false" onDeleteCascade="true" schema="dbo" table="logMantenIndicesDetTbl"/>
         </column>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="secuencia" nullable="false" remarks="Secuencia del Identificador del Proceso de Mantenimiento." size="2" type="smallint" typeCode="5">
            <child catalog="SCMBD" column="secuencia" foreignKey="logMantenIndicesDetFk01" implied="false" onDeleteCascade="true" schema="dbo" table="logMantenIndicesDetTbl"/>
         </column>
         <column autoUpdated="false" defaultValue="null" digits="0" id="2" name="servidor" nullable="false" remarks="Identificador del Servidor donde se realizó Proceso de Mantenimiento." size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="3" name="basedatos" nullable="false" remarks="Nombre de la Base de Datos donde se realizó Proceso de Mantenimiento." size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="(getdate())" digits="3" id="4" name="fechaProceso" nullable="false" remarks="Fecha de Proceso de Mantenimiento" size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="((0))" digits="0" id="5" name="informado" nullable="false" remarks="Estatus que indica si fue notificado el Proceso de Mantenimiento." size="1" type="tinyint" typeCode="-6"/>
         <column autoUpdated="false" defaultValue="((0))" digits="0" id="6" name="error" nullable="false" remarks="Identificador del Error encontrado durante el Proceso de Mantenimiento." size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="('')" digits="0" id="7" name="mensajeError" nullable="false" remarks="Descripción del Error encontrado durante el Proceso de Mantenimiento." size="8000" type="nvarchar" typeCode="-9"/>
         <primaryKey column="idProceso" sequenceNumberInPK="1"/>
         <primaryKey column="secuencia" sequenceNumberInPK="2"/>
         <index name="logMantenIndicesPk" unique="true">
            <column ascending="true" name="idProceso"/>
            <column ascending="true" name="secuencia"/>
         </index>
      </table>
      <table catalog="SCMBD" name="logProcesosBloqueadosTbl" numRows="4" remarks="Log de Análisis de Procesos de Procesos y Consultas Bloqueadas" schema="dbo" type="TABLE">
         <column autoUpdated="false" defaultValue="null" digits="0" id="0" name="idProceso" nullable="false" remarks="Identificador Correlativo del Proceso de Análisis." size="8" type="bigint" typeCode="-5"/>
         <column autoUpdated="false" defaultValue="((1))" digits="0" id="1" name="secuencia" nullable="false" remarks="Identificador Correlativo de la sesión  del Proceso de Análisis." size="2" type="smallint" typeCode="5"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="2" name="servidor" nullable="false" remarks="Identificador del Servidor Problemas de Consultas Bloqueadas." size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="3" name="databaseName" nullable="false" remarks="Identificador de la Base de Datos con Problemas de Consultas Bloqueadas." size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="4" name="sessionId" nullable="false" remarks="Identificador de la Sessión con Problemas de Consultas Bloqueadas." size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="5" name="esource_type" nullable="false" remarks="" size="240" type="nvarchar" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="6" name="ObjectName" nullable="false" remarks="Identificador del Objeto Bloqueado por la Consulta." size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="7" name="resource_description" nullable="false" remarks="Descripción del Recurso donde se genera el Bloqueo." size="1024" type="nvarchar" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="8" name="request_session_id" nullable="true" remarks="Id de la Sesión donde se genera el Bloqueo." size="100" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="9" name="request_mode" nullable="false" remarks="Modos de bloqueo. (Ver catCriteriosTbl)" size="240" type="nvarchar" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="10" name="request_status" nullable="false" remarks="Estado actual de la Consulta. Valores posibles GRANTED, CONVERT, WAIT, LOW_PRIORITY_CONVERT, LOW_PRIORITY_WAIT o ABORT_BLOCKERS" size="240" type="nvarchar" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="11" name="Query" nullable="true" remarks="Consulta que Provoca el Bloqueo." size="2147483647" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="3" id="12" name="fechaInicioProceso" nullable="false" remarks="Fecha / Hora de inicio de la Consulta con Problemas de Bloqueo." size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="13" name="Tiempo_bloqueo" nullable="false" remarks="Tiempo de Bloqueo de la Consulta con Problemas." size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="(getdate())" digits="0" id="14" name="fechaConsulta" nullable="false" remarks="Fecha de la Consulta a los procesos." size="6" type="date" typeCode="91"/>
         <column autoUpdated="false" defaultValue="(getdate())" digits="0" id="15" name="fechaInicio" nullable="false" remarks="Fecha y Hora de Inicio de la Consulta a los procesos" size="6" type="date" typeCode="91"/>
         <column autoUpdated="false" defaultValue="null" digits="3" id="16" name="fechaTermino" nullable="true" remarks="Fecha y Hora de Termino de la Consulta a los procesos." size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="((0))" digits="0" id="17" name="informado" nullable="false" remarks="Indica si fue reportada la incidencia de Procesos Bloqueados." size="1" type="tinyint" typeCode="-6"/>
         <column autoUpdated="false" defaultValue="null" digits="3" id="18" name="fechaInformacion" nullable="true" remarks="" size="16" type="datetime" typeCode="93"/>
         <primaryKey column="idProceso" sequenceNumberInPK="1"/>
         <primaryKey column="secuencia" sequenceNumberInPK="2"/>
         <index name="logProcesosBloqueadosPk" unique="true">
            <column ascending="true" name="idProceso"/>
            <column ascending="true" name="secuencia"/>
         </index>
         <index name="logProcesosBloqueadosIdx01" unique="false">
            <column ascending="true" name="servidor"/>
            <column ascending="true" name="databaseName"/>
            <column ascending="true" name="sessionId"/>
         </index>
      </table>
      <table catalog="SCMBD" name="logProcesosEspacioDDTbl" numRows="2" remarks="Log de Análisis de Análisis de Espacio Disponible en DD." schema="dbo" type="TABLE">
         <column autoUpdated="true" defaultValue="null" digits="0" id="0" name="idProceso" nullable="false" remarks="Identificador Correlativo del Proceso de Análisis." size="4" type="int identity" typeCode="4"/>
         <column autoUpdated="false" defaultValue="(@@servername)" digits="0" id="1" name="servidor" nullable="false" remarks="Identificador del Servidor donde se realizó Proceso de Análisis." size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="(getdate())" digits="3" id="2" name="fechaInicio" nullable="false" remarks="Fecha Inicio de Ejecución del Análisis" size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="null" digits="3" id="3" name="fechaTermino" nullable="true" remarks="Fecha Termino de Ejecución del Análisis" size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="((0))" digits="2" id="4" name="totalEspacio" nullable="false" remarks="Espacio Total del Disco Duro." size="20" type="decimal" typeCode="3"/>
         <column autoUpdated="false" defaultValue="((0))" digits="2" id="5" name="totaldisponible" nullable="false" remarks="Espacio Disponible en Total del Disco Duro." size="20" type="decimal" typeCode="3"/>
         <column autoUpdated="false" defaultValue="((0))" digits="2" id="6" name="porcentajeDisponible" nullable="false" remarks="Porcentaje de Espacio Disponible en Total del Disco Duro." size="20" type="decimal" typeCode="3"/>
         <column autoUpdated="false" defaultValue="((0))" digits="0" id="7" name="informado" nullable="false" remarks="Estatus que indica si fue notificado el resultado del análisis" size="1" type="tinyint" typeCode="-6"/>
         <column autoUpdated="false" defaultValue="((0))" digits="0" id="8" name="error" nullable="false" remarks="Identificador del Error encontrado durante el análisis" size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="('')" digits="0" id="9" name="mensajeError" nullable="false" remarks="Descripción del Error encontrado durante la análisis" size="8000" type="nvarchar" typeCode="-9"/>
         <primaryKey column="idProceso" sequenceNumberInPK="1"/>
         <index name="logProcesosEspacioDDPk" unique="true">
            <column ascending="true" name="idProceso"/>
         </index>
      </table>
      <table catalog="SCMBD" name="logServiciosNotificacionesPushTbl" numRows="0" remarks="Log de Análisis de Servicios Notificaciones Push." schema="dbo" type="TABLE">
         <column autoUpdated="true" defaultValue="null" digits="0" id="0" name="idProceso" nullable="false" remarks="Identificador Correlativo del Proceso de Análisis" size="4" type="int identity" typeCode="4"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="servidor" nullable="false" remarks="Identificador del Servidor donde se realizó Proceso de Análisis" size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="2" name="idMonitor" nullable="false" remarks="Identificador del Monitor con Problemas" size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="3" name="actividad" nullable="false" remarks="Descripción de la Actividad Ejecutada." size="2147483647" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="(getdate())" digits="3" id="4" name="fechaInicio" nullable="false" remarks="Fecha de Inicio de la Actividad" size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="(getdate())" digits="3" id="5" name="fechaTermino" nullable="true" remarks="Fecha Termino  de la Actividad" size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="((0))" digits="0" id="6" name="informado" nullable="false" remarks="Identifica si el Análisis ya fue Informado." size="1" type="bit" typeCode="-7"/>
         <column autoUpdated="false" defaultValue="((0))" digits="0" id="7" name="error" nullable="false" remarks="Identificador del Error encontrado durante el proceso" size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="('')" digits="0" id="8" name="mensajeError" nullable="false" remarks="Descripción del Error encontrado durante el proceso de Análisis" size="250" type="varchar" typeCode="12"/>
         <primaryKey column="idProceso" sequenceNumberInPK="1"/>
         <index name="logServiciosNotificacionesPushPk" unique="true">
            <column ascending="true" name="idProceso"/>
         </index>
      </table>
      <table catalog="SCMBD" name="logServiciosNotificaCorreosTbl" numRows="0" remarks="Log de Análisis de Servicios Notificaciones de Correos" schema="dbo" type="TABLE">
         <column autoUpdated="true" defaultValue="null" digits="0" id="0" name="idProceso" nullable="false" remarks="Identificador Correlativo del Proceso de Análisis" size="4" type="int identity" typeCode="4"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="servidor" nullable="false" remarks="Identificador del Servidor donde se realizó Proceso de Análisis" size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="2" name="idPerfilCorreo" nullable="false" remarks="Identificador del Perfil de Correos con Problemas" size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="3" name="descripcion" nullable="false" remarks="Perfil de Correo no Procesado" size="1020" type="nvarchar" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="(getdate())" digits="3" id="4" name="fechaInicio" nullable="false" remarks="Fecha de Inicio de la Actividad" size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="(getdate())" digits="3" id="5" name="fechaTermino" nullable="true" remarks="Fecha Termino  de la Actividad" size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="((0))" digits="0" id="6" name="informado" nullable="false" remarks="Identifica si el Análisis ya fue Informado." size="1" type="tinyint" typeCode="-6"/>
         <column autoUpdated="false" defaultValue="((0))" digits="0" id="7" name="error" nullable="false" remarks="Identificador del Error encontrado durante el proceso" size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="('')" digits="0" id="8" name="mensajeError" nullable="false" remarks="Descripción del Error encontrado durante el proceso de Análisis" size="250" type="varchar" typeCode="12"/>
         <primaryKey column="idProceso" sequenceNumberInPK="1"/>
         <index name="logServiciosNotificaCorreosPk" unique="true">
            <column ascending="true" name="idProceso"/>
         </index>
      </table>
      <table catalog="SCMBD" name="logTiemposEjecucionTbl" numRows="0" remarks="Log de Análisis de Procesos de Tiempos de Ejecución." schema="dbo" type="TABLE">
         <column autoUpdated="true" defaultValue="null" digits="0" id="0" name="idProceso" nullable="false" remarks="Identificador Correlativo del Proceso de Análisis." size="8" type="bigint identity" typeCode="-5"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="sessionId" nullable="false" remarks="Identificador de la Sessión con Problemas de Tiempos de Ejecución." size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="2" name="servidor" nullable="false" remarks="Identificador del Servidor Problemas de Tiempos de Ejecución." size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="3" name="status" nullable="true" remarks="Identificador del Estatus del Proceso Reportado." size="100" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="4" name="databaseName" nullable="false" remarks="Identificador de la Base de Datos con Problemas de Tiempos de Ejecución." size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="5" name="individualQuery" nullable="true" remarks="Consulta con Problemas de Tiempos de Ejecución." size="2147483647" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="6" name="parentQuery" nullable="true" remarks="Procedimiento / FUnción que ejecuta la Consulta con Problemas de Tiempos de Ejecución." size="2147483647" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="7" name="programName" nullable="true" remarks="Programa desde donde se ejecuta la Consulta con Problemas de Tiempos de Ejecución." size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="3" id="8" name="fechaInicioProceso" nullable="false" remarks="Fecha / Hora de inicio de la Consulta con Problemas de Tiempos de Ejecución." size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="9" name="tiempoEjecucion" nullable="false" remarks="Tiempo de ejecución de la Consulta con Problemas de Tiempos de Ejecución." size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="(getdate())" digits="0" id="10" name="fechaConsulta" nullable="false" remarks="Fecha de la Consulta a los procesos." size="6" type="date" typeCode="91"/>
         <column autoUpdated="false" defaultValue="(getdate())" digits="0" id="11" name="fechaInicio" nullable="false" remarks="Fecha y Hora de Inicio de la Consulta a los procesos" size="6" type="date" typeCode="91"/>
         <column autoUpdated="false" defaultValue="null" digits="3" id="12" name="fechaTermino" nullable="true" remarks="Fecha y Hora de Termino de la Consulta a los procesos." size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="((0))" digits="0" id="13" name="informado" nullable="false" remarks="Indica si fue reportada la incidencia  de tiempos de ejecución." size="1" type="tinyint" typeCode="-6"/>
         <primaryKey column="idProceso" sequenceNumberInPK="1"/>
         <index name="logTiemposEjecucionPk" unique="true">
            <column ascending="true" name="idProceso"/>
         </index>
         <index name="idxLogTiemposEjecucion" unique="false">
            <column ascending="true" name="servidor"/>
            <column ascending="true" name="sessionId"/>
         </index>
      </table>
      <table catalog="SCMBD" name="movDatosAdicionalesCorreoTbl" numRows="0" remarks="Tabla de Datos Adicionals a procesos de Envío de Correo" schema="dbo" type="TABLE">
         <column autoUpdated="false" defaultValue="null" digits="0" id="0" name="idProceso" nullable="false" remarks="Identiicador del Proceso de Envío de Correo" size="4" type="int" typeCode="4">
            <parent catalog="SCMBD" column="idProceso" foreignKey="movDatosAdicionalesCorreoFk01" implied="false" onDeleteCascade="true" schema="dbo" table="conProcesosTbl"/>
         </column>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="XML" nullable="true" remarks="XML relacionado al Correo a Enviar." size="2147483647" type="xml" typeCode="-16"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="2" name="HTML" nullable="true" remarks="HTML relacionado al Correo a Enviar." size="2147483647" type="nvarchar" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="3" name="tipo" nullable="true" remarks="Tipo de Correo a Enviar(HTML, Text)." size="40" type="nvarchar" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="4" name="ruta" nullable="true" remarks="Ruta donde se Aloja el Archivo Anexo al Correo." size="250" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="5" name="nombreArchivo" nullable="true" remarks="Nombre del Archivo Anexo al Correo." size="250" type="varchar" typeCode="12"/>
         <primaryKey column="idProceso" sequenceNumberInPK="1"/>
         <index name="movDatosAdicionalesCorreoPk" unique="true">
            <column ascending="true" name="idProceso"/>
         </index>
      </table>
      <table catalog="SCMBD" name="movEnvioCorreosTbl" numRows="67" remarks="Tabla de Movimientos de Envío de Correos" schema="dbo" type="TABLE">
         <column autoUpdated="false" defaultValue="null" digits="0" id="0" name="mailitem_id" nullable="false" remarks="Identificador Único del Correo Enviado" size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="null" digits="3" id="1" name="fechaEnvio" nullable="false" remarks="Fecha del Correo Enviado" size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="2" name="idProceso" nullable="false" remarks="Identificador relacionado al Correo Enviado" size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="3" name="idAplicacion" nullable="false" remarks="Identificador de la Aplicación relacionado al Correo Enviado" size="2" type="smallint" typeCode="5">
            <parent catalog="SCMBD" column="idAplicacion" foreignKey="Implied Constraint" implied="true" onDeleteCascade="false" schema="dbo" table="catAplicacionesTbl"/>
         </column>
         <column autoUpdated="false" defaultValue="null" digits="0" id="4" name="idMotivoCorreo" nullable="false" remarks="Identificador del Motivo de Correo relacionado al Correo Enviado" size="2" type="smallint" typeCode="5"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="5" name="correo" nullable="false" remarks="Identificador de la Direeción de Correo relacionado al Correo Enviado" size="2147483647" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="6" name="subject" nullable="false" remarks="Objeto del Correo Enviado" size="510" type="nvarchar" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="7" name="idEstatus" nullable="false" remarks="Identificador del Estatus del Correo Enviado" size="1" type="tinyint" typeCode="-6"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="8" name="servidor" nullable="false" remarks="Identificador del Servidor desde donde se envió el Correo" size="510" type="nvarchar" typeCode="-9"/>
         <primaryKey column="fechaEnvio" sequenceNumberInPK="1"/>
         <primaryKey column="mailitem_id" sequenceNumberInPK="2"/>
         <index name="movEnvioCorreosPk" unique="true">
            <column ascending="true" name="fechaEnvio"/>
            <column ascending="true" name="mailitem_id"/>
         </index>
      </table>
      <table catalog="SCMBD" name="movLogControlCambiosTbl" numRows="0" remarks="Tabla Log de Movimientos de Control de Cambio." schema="dbo" type="TABLE">
         <column autoUpdated="true" defaultValue="null" digits="0" id="0" name="secuencia" nullable="false" remarks="Identificador Único del Movimiento de Control de Cambio." size="4" type="int identity" typeCode="4"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="idUsuario" nullable="false" remarks="Identificador del Usuario que solicita el Control de Cambio." size="4" type="int" typeCode="4">
            <parent catalog="SCMBD" column="idUsuario" foreignKey="Implied Constraint" implied="true" onDeleteCascade="false" schema="dbo" table="segUsuariosTbl"/>
         </column>
         <column autoUpdated="false" defaultValue="null" digits="0" id="2" name="baseDatos" nullable="false" remarks="Base de Datos donde se Solicita el Control de Cambio." size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="(getdate())" digits="0" id="3" name="fecha" nullable="false" remarks="Fecha en que se Solicita el Control de Cambio." size="6" type="date" typeCode="91"/>
         <column autoUpdated="false" defaultValue="((1))" digits="0" id="4" name="tipoActualizacion" nullable="false" remarks="Tipo de Actualización Solicitada en el Control de Cambio. 1 = Back, 2 = API/Front" size="1" type="tinyint" typeCode="-6"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="5" name="cantidad" nullable="false" remarks="Cantidad de Objetos del Control de Cambio." size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="((0))" digits="0" id="6" name="cantidadErrores" nullable="false" remarks="Cantidad de Objetos con Errores en el Control de Cambio." size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="('')" digits="0" id="7" name="idError" nullable="true" remarks="Identificador del Error Principal en el Control de Cambio." size="10" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="('')" digits="0" id="8" name="observaciones" nullable="true" remarks="Observaciones en el Control de Cambio." size="250" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="((0))" digits="0" id="9" name="informado" nullable="false" remarks="Indica si fue Informado el Resultado del Control de Cambio." size="1" type="tinyint" typeCode="-6"/>
         <primaryKey column="secuencia" sequenceNumberInPK="1"/>
         <index name="movLogControlCambiosPk" unique="true">
            <column ascending="true" name="secuencia"/>
         </index>
         <index name="movLogControlCambiosIdx01" unique="false">
            <column ascending="true" name="idUsuario"/>
            <column ascending="true" name="baseDatos"/>
            <column ascending="true" name="fecha"/>
         </index>
         <checkConstraint constraint="([tipoActualizacion]=(2) OR [tipoActualizacion]=(1))" name="movLogControlCambiosChk01"/>
      </table>
      <table catalog="SCMBD" name="movLogMonitoresPushTbl" numRows="0" remarks="Tabla de movimientos de los Monitores Push" schema="dbo" type="TABLE">
         <column autoUpdated="true" defaultValue="null" digits="0" id="0" name="idMovimiento" nullable="false" remarks="Identificador de movimientos de los Monitores Push." size="8" type="bigint identity" typeCode="-5"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="idMonitor" nullable="false" remarks="Identificador del Monitor Push." size="2" type="smallint" typeCode="5">
            <parent catalog="SCMBD" column="idMonitor" foreignKey="Implied Constraint" implied="true" onDeleteCascade="false" schema="dbo" table="catMonitoresPushTbl"/>
         </column>
         <column autoUpdated="false" defaultValue="null" digits="0" id="2" name="idOrigen" nullable="false" remarks="" size="2" type="smallint" typeCode="5"/>
         <column autoUpdated="false" defaultValue="(getdate())" digits="3" id="3" name="fechaInicio" nullable="false" remarks="" size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="((0))" digits="0" id="4" name="registros" nullable="false" remarks="" size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="((0))" digits="0" id="5" name="error" nullable="false" remarks="" size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="(char((32)))" digits="0" id="6" name="comentarios" nullable="false" remarks="" size="250" type="varchar" typeCode="12"/>
         <primaryKey column="idMovimiento" sequenceNumberInPK="1"/>
         <index name="movLogMonitoresPushPk" unique="true">
            <column ascending="true" name="idMovimiento"/>
         </index>
      </table>
      <table catalog="SCMBD" name="movProcesosDetELTbl" numRows="0" remarks="" schema="dbo" type="TABLE">
         <column autoUpdated="false" defaultValue="null" digits="0" id="0" name="idProceso" nullable="false" remarks="" size="8" type="bigint" typeCode="-5">
            <parent catalog="SCMBD" column="idProceso" foreignKey="movProcesosDetELFk01" implied="false" onDeleteCascade="true" schema="dbo" table="movProcesosELTbl"/>
         </column>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="secuencia" nullable="false" remarks="" size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="2" name="idRelLab" nullable="false" remarks="" size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="(getdate())" digits="3" id="3" name="fechaInicio" nullable="false" remarks="" size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="null" digits="3" id="4" name="fechaTermino" nullable="true" remarks="" size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="((0))" digits="0" id="5" name="idEstatus" nullable="false" remarks="" size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="6" name="mensaje" nullable="true" remarks="" size="250" type="varchar" typeCode="12"/>
         <primaryKey column="idProceso" sequenceNumberInPK="1"/>
         <primaryKey column="secuencia" sequenceNumberInPK="2"/>
         <index name="movProcesosDetELPk" unique="true">
            <column ascending="true" name="idProceso"/>
            <column ascending="true" name="secuencia"/>
         </index>
      </table>
      <table catalog="SCMBD" name="movProcesosELTbl" numRows="0" remarks="" schema="dbo" type="TABLE">
         <column autoUpdated="true" defaultValue="null" digits="0" id="0" name="idProceso" nullable="false" remarks="" size="8" type="bigint identity" typeCode="-5">
            <child catalog="SCMBD" column="idProceso" foreignKey="movProcesosDetELFk01" implied="false" onDeleteCascade="true" schema="dbo" table="movProcesosDetELTbl"/>
         </column>
         <column autoUpdated="false" defaultValue="(getdate())" digits="3" id="1" name="fechaInicio" nullable="false" remarks="" size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="null" digits="3" id="2" name="fechaTermino" nullable="true" remarks="" size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="((0))" digits="0" id="3" name="registrosProcesados" nullable="false" remarks="" size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="((1))" digits="0" id="4" name="idEstatus" nullable="false" remarks="" size="1" type="tinyint" typeCode="-6"/>
         <primaryKey column="idProceso" sequenceNumberInPK="1"/>
         <index name="PK__movProce__DEC82926A31A215A" unique="true">
            <column ascending="true" name="idProceso"/>
         </index>
      </table>
      <table catalog="SCMBD" name="relBaseDatosGrupoCorreoTbl" numRows="1" remarks="Tabla de Relación de Base de Datos - Grupo de Correo." schema="dbo" type="TABLE">
         <column autoUpdated="true" defaultValue="null" digits="0" id="0" name="idRelacion" nullable="false" remarks="Identificador de Relación de Base de Datos - Grupo de Correo" size="4" type="int identity" typeCode="4"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="baseDatos" nullable="false" remarks="Identificador de la Base de Datos" size="256" type="sysname" typeCode="-9"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="2" name="codigoGrupoCorreo" nullable="false" remarks="Código de Grupo de Correo al que se le envíara el correo de ejecuciones" size="20" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="((1))" digits="0" id="3" name="idEstatus" nullable="false" remarks="Identificador del Estatus del Registro" size="1" type="bit" typeCode="-7"/>
         <column autoUpdated="false" defaultValue="(getdate())" digits="3" id="4" name="fechaAlta" nullable="false" remarks="Fecha de Alta del Registro" size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="(getdate())" digits="3" id="5" name="fechaAct" nullable="false" remarks="Última Fecha de Actualización del Registro" size="16" type="datetime" typeCode="93"/>
         <primaryKey column="idRelacion" sequenceNumberInPK="1"/>
         <index name="relBaseDatosGrupoCorreoPk" unique="true">
            <column ascending="true" name="idRelacion"/>
         </index>
         <index name="relBaseDatosGrupoCorreoIdex01" unique="true">
            <column ascending="true" name="baseDatos"/>
            <column ascending="true" name="codigoGrupoCorreo"/>
         </index>
      </table>
      <table catalog="SCMBD" name="segRelAplicacionUsuarioTbl" numRows="2" remarks="Tabla de Relación del Usuario con la Aplicación" schema="dbo" type="TABLE">
         <column autoUpdated="false" defaultValue="null" digits="0" id="0" name="idUsuario" nullable="false" remarks="Identificador del Usuario a relacionar." size="4" type="int" typeCode="4">
            <parent catalog="SCMBD" column="idUsuario" foreignKey="segRelAplicacionUsuarioFk01" implied="false" onDeleteCascade="false" schema="dbo" table="segUsuariosTbl"/>
         </column>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="idAplicacion" nullable="false" remarks="Identificador del Usuario a relacionar." size="2" type="smallint" typeCode="5">
            <parent catalog="SCMBD" column="idAplicacion" foreignKey="segRelAplicacionUsuarioFk02" implied="false" onDeleteCascade="false" schema="dbo" table="catAplicacionesTbl"/>
         </column>
         <column autoUpdated="false" defaultValue="((1))" digits="0" id="2" name="idEstatus" nullable="false" remarks="Identificador del Estatus del Registro de Relación." size="1" type="bit" typeCode="-7"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="3" name="idUsuarioAct" nullable="false" remarks="Identificador del Último Usuario que Actualizó el Registro" size="4" type="int" typeCode="4">
            <parent catalog="SCMBD" column="idUsuario" foreignKey="segRelAplicacionUsuarioFk03" implied="false" onDeleteCascade="false" schema="dbo" table="segUsuariosTbl"/>
         </column>
         <column autoUpdated="false" defaultValue="(getdate())" digits="3" id="4" name="fechaAct" nullable="false" remarks="Última Fecha de Actualización del Registro." size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="5" name="ipAct" nullable="true" remarks="Última dirección IP desde donde se actualizó el Registro." size="30" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="6" name="macAddressAct" nullable="true" remarks="Última dirección MAC desde donde se actualizó el Registro." size="30" type="varchar" typeCode="12"/>
         <primaryKey column="idUsuario" sequenceNumberInPK="1"/>
         <primaryKey column="idAplicacion" sequenceNumberInPK="2"/>
         <index name="segRelAplicacionUsuarioPk" unique="true">
            <column ascending="true" name="idUsuario"/>
            <column ascending="true" name="idAplicacion"/>
         </index>
      </table>
      <table catalog="SCMBD" name="segRelUsuariosTokenTbl" numRows="0" remarks="" schema="dbo" type="TABLE">
         <column autoUpdated="false" defaultValue="null" digits="0" id="0" name="idUsuario" nullable="false" remarks="" size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="idAplicacion" nullable="false" remarks="" size="2" type="smallint" typeCode="5"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="2" name="token" nullable="false" remarks="" size="500" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="3" name="tokenGoogle" nullable="true" remarks="" size="500" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="(getdate())" digits="0" id="4" name="fechaInicio" nullable="false" remarks="" size="6" type="date" typeCode="91"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="5" name="fechaTermino" nullable="true" remarks="" size="6" type="date" typeCode="91"/>
         <column autoUpdated="false" defaultValue="((1))" digits="0" id="6" name="idOrigen" nullable="false" remarks="" size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="((1))" digits="0" id="7" name="idEstatus" nullable="false" remarks="" size="1" type="bit" typeCode="-7"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="8" name="idUsuarioAct" nullable="false" remarks="" size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="(getdate())" digits="3" id="9" name="fechaAct" nullable="false" remarks="" size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="10" name="ipAct" nullable="true" remarks="" size="30" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="11" name="macAddressAct" nullable="true" remarks="" size="30" type="varchar" typeCode="12"/>
         <primaryKey column="idUsuario" sequenceNumberInPK="1"/>
         <primaryKey column="idAplicacion" sequenceNumberInPK="2"/>
         <primaryKey column="token" sequenceNumberInPK="3"/>
         <index name="segRelUsuariosTokenPk" unique="true">
            <column ascending="true" name="idUsuario"/>
            <column ascending="true" name="idAplicacion"/>
            <column ascending="true" name="token"/>
         </index>
      </table>
      <table catalog="SCMBD" name="segUsuariosTbl" numRows="2" remarks="CatáloGo de Usuarios" schema="dbo" type="TABLE">
         <column autoUpdated="false" defaultValue="null" digits="0" id="0" name="idUsuario" nullable="false" remarks="Identificador Único de Seguridad de Usuario" size="4" type="int" typeCode="4">
            <child catalog="SCMBD" column="idUsuarioAct" foreignKey="catMensajesErroresFk01" implied="false" onDeleteCascade="false" schema="dbo" table="catMensajesErroresTbl"/>
            <child catalog="SCMBD" column="idReceptor" foreignKey="conGrupoReceptorCorreoDetFk03" implied="false" onDeleteCascade="false" schema="dbo" table="conGrupoReceptorCorreoDetTbl"/>
            <child catalog="SCMBD" column="idUsuarioAct" foreignKey="conGrupoReceptorCorreoDetFk02" implied="false" onDeleteCascade="false" schema="dbo" table="conGrupoReceptorCorreoDetTbl"/>
            <child catalog="SCMBD" column="idUsuarioAct" foreignKey="conGrupoReceptorCorreoFk02" implied="false" onDeleteCascade="false" schema="dbo" table="conGrupoReceptorCorreoTbl"/>
            <child catalog="SCMBD" column="idUsuarioAct" foreignKey="conParametrosGralesFk01" implied="false" onDeleteCascade="false" schema="dbo" table="conParametrosCorreoTbl"/>
            <child catalog="SCMBD" column="idUsuarioAct" foreignKey="conProcedimientosFk01" implied="false" onDeleteCascade="false" schema="dbo" table="conProcedimientosTbl"/>
            <child catalog="SCMBD" column="idUsuario" foreignKey="Implied Constraint" implied="true" onDeleteCascade="false" schema="dbo" table="movLogControlCambiosTbl"/>
            <child catalog="SCMBD" column="idUsuario" foreignKey="segRelAplicacionUsuarioFk01" implied="false" onDeleteCascade="false" schema="dbo" table="segRelAplicacionUsuarioTbl"/>
            <child catalog="SCMBD" column="idUsuarioAct" foreignKey="segRelAplicacionUsuarioFk03" implied="false" onDeleteCascade="false" schema="dbo" table="segRelAplicacionUsuarioTbl"/>
         </column>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="claveUsuario" nullable="true" remarks="Código de Usuario en la Aplicación" size="260" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="2" name="nombre" nullable="true" remarks="Nombre completo del Usuario" size="400" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="((0))" digits="0" id="3" name="idTipoUsuario" nullable="false" remarks="Identificador del Tipo de Usuario. 0 = Fucional, 1 = Administrativo" size="1" type="tinyint" typeCode="-6"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="4" name="primerApellido" nullable="true" remarks="Primer Apellido del Usuario" size="80" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="5" name="segundoApellido" nullable="true" remarks="Segundo Apellido del Usuario" size="80" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="6" name="nombres" nullable="true" remarks="Nombres del Usuario" size="160" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="7" name="correo" nullable="true" remarks="Correo del Usuario" size="260" type="varchar" typeCode="12">
            <parent catalog="SCMBD" column="Correo" foreignKey="Implied Constraint" implied="true" onDeleteCascade="false" schema="dbo" table="catCorreosNoValidosTbl"/>
         </column>
         <column autoUpdated="false" defaultValue="((1))" digits="0" id="8" name="idEstatus" nullable="false" remarks="Identificador del Estatus Usuario" size="1" type="tinyint" typeCode="-6"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="9" name="idUsuarioAct" nullable="false" remarks="Identificador del Último Usuario que Actualizó el Registro" size="4" type="int" typeCode="4"/>
         <column autoUpdated="false" defaultValue="(getdate())" digits="3" id="10" name="fechaAct" nullable="false" remarks="Última Fecha de Actualización el Registro" size="16" type="datetime" typeCode="93"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="11" name="ipAct" nullable="true" remarks="Última Dirección IP desde donde se Actualizó el Registro" size="30" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="12" name="macAddressAct" nullable="true" remarks="Última Dirección MAC desde donde se Actualizó el Registro" size="30" type="varchar" typeCode="12"/>
         <primaryKey column="idUsuario" sequenceNumberInPK="1"/>
         <index name="SegUsuariosFk" unique="true">
            <column ascending="true" name="idUsuario"/>
         </index>
         <index name="segUsuariosIdex01" unique="true">
            <column ascending="true" name="claveUsuario"/>
         </index>
      </table>
      <table catalog="SCMBD" name="tmpLogError" numRows="0" remarks="" schema="dbo" type="TABLE">
         <column autoUpdated="true" defaultValue="null" digits="0" id="0" name="idError" nullable="false" remarks="" size="4" type="int identity" typeCode="4">
            <parent catalog="SCMBD" column="idError" foreignKey="Implied Constraint" implied="true" onDeleteCascade="false" schema="dbo" table="catMensajesErroresTbl"/>
         </column>
         <column autoUpdated="false" defaultValue="null" digits="0" id="1" name="error" nullable="true" remarks="" size="800" type="varchar" typeCode="12"/>
         <column autoUpdated="false" defaultValue="null" digits="0" id="2" name="descripcion" nullable="true" remarks="" size="2147483647" type="varchar" typeCode="12"/>
      </table>
   </tables>
   <routines>
      <routine dataAccess="READS" deterministic="false" name="Fn_BuscaDescripcionCriterio" returnType="varchar" type="FUNCTION">
         <comment/>
         <definition language="SQL"><![CDATA[Create   Function dbo.Fn_BuscaDescripcionCriterio
  (@PsCriterio     Char(25),
   @PnValor        Tinyint)  
Returns Varchar(100)
As

Begin
   Declare
      @o_salida           Varchar(100)

   Begin
      Select @o_salida = descripcion
      From   dbo.catCriteriosTbl
      Where  criterio  = @PsCriterio
      And    valor     = @PnValor
      If @@Rowcount = 0
         Begin
            Set @o_salida = ' '
         End
   End

   Set @o_salida = Isnull(@o_salida, ' ')

   Return(@o_salida)

End]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsCriterio" type="char"/>
            <parameter mode="IN" name="@PnValor" type="tinyint"/>
         </parameters>
      </routine>
      <routine dataAccess="READS" deterministic="false" name="Fn_BuscaDescripcionGeneral" returnType="varchar" type="FUNCTION">
         <comment/>
         <definition language="SQL"><![CDATA[Create   Function dbo.Fn_BuscaDescripcionGeneral
  (@PsTabla        Sysname,
   @PsColumna      Sysname,
   @PnValor        Tinyint)  
Returns Varchar(100)
As

Begin
   Declare
      @o_salida           Varchar(100)

   Begin
      Select @o_salida = descripcion
      From   dbo.catGeneralesTbl
      Where  tabla     = @PsTabla
      And    columna   = @PsColumna
      And    valor     = @PnValor
      If @@Rowcount = 0
         Begin
            Set @o_salida = ' '
         End
   End

   Set @o_salida = Isnull(@o_salida, ' ')

   Return(@o_salida)

End]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsTabla" type="nvarchar"/>
            <parameter mode="IN" name="@PsColumna" type="nvarchar"/>
            <parameter mode="IN" name="@PnValor" type="tinyint"/>
         </parameters>
      </routine>
      <routine dataAccess="READS" deterministic="false" name="Fn_BuscaDireccionIP" returnType="varchar" type="FUNCTION">
         <comment/>
         <definition language="SQL"/>
         <parameters/>
      </routine>
      <routine dataAccess="READS" deterministic="false" name="Fn_BuscaMes" returnType="varchar" type="FUNCTION">
         <comment/>
         <definition language="SQL"><![CDATA[Create   Function dbo.Fn_BuscaMes
 (@w_Mes       Integer)
Returns Varchar(15)

As
Begin
    Declare
	   @w_salida   Varchar(15)
       Select @w_salida = Case @w_mes
                          When  1 Then 'Ene'
                          When  2 Then 'Feb'
                          When  3 Then 'Mar'
                          When  4 Then 'Abr'
                          When  5 Then 'May'
                          When  6 Then 'Jun'
                          When  7 Then 'Jul'
                          When  8 Then 'Ago'
                          When  9 Then 'Sep'
                          When 10 Then 'Oct'
                          When 11 Then 'Nov'
                          When 12 Then 'Dic'
          End

Return Isnull(@w_salida,'')

End]]></definition>
         <parameters>
            <parameter mode="IN" name="@w_Mes" type="int"/>
         </parameters>
      </routine>
      <routine dataAccess="READS" deterministic="false" name="Fn_BuscaValorParametro" returnType="varchar" type="FUNCTION">
         <comment/>
         <definition language="SQL"><![CDATA[/*

Declare
   @PnIdParametroGral     Char(25) = 4,
   @PnIdConsulta   Bit      = 0

Begin
   Select dbo.Fn_BuscaValorParametro(@PnIdParametroGral, @PnIdConsulta)

End
Go

*/

Create   Function dbo.Fn_BuscaValorParametro
  (@PnIdParametroGral     Char(25),
   @PnIdConsulta          Bit)    -- 0 = Valor String, 1 = Valor Numérico, 2 = Valor Fecha (Salida 'dd/mm/yyyy') 
Returns Varchar(150)
As

Begin
   Declare
      @o_salida           Varchar(100),
      @w_parametroChar    Varchar(150),
      @w_parametroNumber  Numeric(24, 6),
      @w_parametroFecha   Datetime

   Begin
      Select @w_parametroChar    = parametroChar,
             @w_parametroNumber  = parametroNumber,
             @w_parametroFecha   = parametroFecha
      From   dbo.conParametrosGralesTbl
      Where  idParametroGral  = @PnIdParametroGral
      If @@Rowcount = 0
         Begin
            Select @w_parametroChar   = Null,
                   @w_parametroNumber = Null,
                   @w_parametroFecha  = Null,
                   @o_salida          = ''
         End
      Else
         Begin
            Set @o_salida = Case When @PnIdConsulta = 0
                                 Then @w_parametroChar
                                 When @PnIdConsulta = 1
                                 Then Cast(@w_parametroNumber As Varchar)
                                 Else Convert(Char(10), @w_parametrofecha, 103)
                            End
         End
   End

   Return(@o_salida)

End]]></definition>
         <parameters>
            <parameter mode="IN" name="@PnIdParametroGral" type="char"/>
            <parameter mode="IN" name="@PnIdConsulta" type="bit"/>
         </parameters>
      </routine>
      <routine dataAccess="READS" deterministic="false" name="Fn_Busca_DireccionMac" returnType="char" type="FUNCTION">
         <comment/>
         <definition language="SQL"><![CDATA[Create   Function dbo.Fn_Busca_DireccionMac()
Returns Char(30)
As

Begin
   Declare
      @o_salida           Varchar(30)

   Begin
      Select @o_salida = net_address
      From   master.dbo.sysprocesses 
      Where  spid = @@spid

      Set @o_salida = Isnull(@o_salida, ' ')
   End

   Return(@o_salida)

End]]></definition>
         <parameters/>
      </routine>
      <routine dataAccess="READS" deterministic="false" name="Fn_Busca_MensajeError" returnType="varchar" type="FUNCTION">
         <comment/>
         <definition language="SQL"><![CDATA[Create   Function Fn_Busca_MensajeError
 (@PnIdError         Smallint)
Returns Varchar(250)
As

Begin
   Declare
      @o_salida     Varchar( 250)
   Begin

      Select @o_salida = mensaje
      From   dbo.catMensajesErroresTbl
      Where  idError      = @PnIdError
      If @@Rowcount = 0
         Begin
            Set @o_salida = 'Error.: ' + Cast(@PnIdError As Varchar) +  '.    Mensaje No Definido'
         End

   End

   Return(@o_salida)

End]]></definition>
         <parameters>
            <parameter mode="IN" name="@PnIdError" type="smallint"/>
         </parameters>
      </routine>
      <routine dataAccess="READS" deterministic="false" name="Fn_ConvierteNumeroLetra" returnType="varchar" type="FUNCTION">
         <comment/>
         <definition language="SQL"><![CDATA[/*
Declare
   @PnValor     Decimal(18, 6) = 1001.05
Begin
   Select dbo.Fn_ConvierteNumeroLetra(@PnValor)

   Return
End
Go
*/

Create   Function dbo.Fn_ConvierteNumeroLetra
  (@PnValor     Decimal(18, 6))

Returns Varchar(4000) 
  
As
Begin
   Declare
      @o_salida           Varchar(1000),
      @w_PrimeraParte     Varchar(1000),   
      @w_SegundaParte     Varchar(1000),
      @w_valor            Integer,
      @w_valorDecimal     Decimal(18, 6),
      @w_valorNuevo       Integer,
      @w_decimales         Varchar(20)
      
   Declare 
      @TablaValores1      Table
      (valor              Integer,
       descripcion        Varchar(100))

   Declare
      @TablaValores2      Table
      (valor              Integer,
       descripcion        Varchar(100) Default 'CIENTOS')
       
   Begin

      If @PnValor > 999999999999
         Begin
            Return ''
         End

      Insert into @TablaValores1
      Select       0, 'CERO'    
      Union   
      Select       1, 'UN'    
      Union   
      Select       2, 'DOS'    
      Union   
      Select       3, 'TRES'    
      Union   
      Select       4, 'CUATRO'    
      Union   
      Select       5, 'CINCO'    
      Union   
      Select       6, 'SEIS'    
      Union   
      Select       7, 'SIETE'    
      Union   
      Select       8, 'OCHO'    
      Union   
      Select       9, 'NUEVE'    
      Union   
      Select      10, 'DIEZ'    
      Union   
      Select      11, 'ONCE'    
      Union   
      Select      12, 'DOCE'    
      Union   
      Select      13, 'TRECE'    
      Union   
      Select      14, 'CATORCE'    
      Union   
      Select      15, 'QUINCE'    
      Union   
      Select      20, 'VEINTE'    
      Union   
      Select      30, 'TREINTA'    
      Union   
      Select      40, 'CUARENTA'    
      Union   
      Select      50, 'CINCUENTA'    
      Union   
      Select      60, 'SESENTA'    
      Union   
      Select      70, 'SETENTA'    
      Union   
      Select      80, 'OCHENTA'    
      Union   
      Select      90, 'NOVENTA'    
      Union   
      Select     100, 'CIEN'    
      Union   
      Select     500, 'QUINIENTOS'
      Union   
      Select     700, 'SETECIENTOS'    
      Union   
      Select     900, 'NOVECIENTOS'    
      Union   
      Select    1000, 'MIL'    
      Union   
      Select 1000000, 'UN MILLON'    

      Insert into @TablaValores2
      (valor)
      Select     200
      Union   
      Select     300
      Union   
      Select     400
      Union   
      Select     600
      Union   
      Select     800

--
       
      Select @w_PrimeraParte = '',
             @w_SegundaParte = '',
             @w_valor        = Cast(@PnValor As Integer),
             @w_valorDecimal = (@PnValor - @w_valor) * 100.00,
             @w_decimales    = 'PESOS CON ' + Format(@w_valorDecimal, '00') + '/100 CTS'
      
      Select @o_salida = descripcion
      From   @TablaValores1
      Where  valor  = @w_valor
      If @@Rowcount > 0
         Begin
            Goto  Salida 
         End    

      Select @o_salida = descripcion
      From   @TablaValores2
      Where  valor = @w_valor
      If @@Rowcount > 0
          Begin
             Select @w_valorNuevo   = @w_valor / 100,
                    @w_PrimeraParte = dbo.Fn_ConvierteNumeroLetra (@w_valorNuevo),
                    @o_salida       =  @w_PrimeraParte +  'CIENTOS'
                    
             Goto  Salida   
          End    

      If @w_valor Between 16 And 19    
         Begin    
            Select @w_valorNuevo   = @w_valor - 10, 
                   @w_PrimeraParte = dbo.Fn_ConvierteNumeroLetra(@w_valorNuevo),
                   @o_salida       = 'DIECI' + @w_PrimeraParte    

            Goto  Salida     
       End    

       If @w_valor Between 21 An]]></definition>
         <parameters>
            <parameter mode="IN" name="@PnValor" type="decimal"/>
         </parameters>
      </routine>
      <routine dataAccess="READS" deterministic="false" name="Fn_Desencripta_cadena" returnType="varchar" type="FUNCTION">
         <comment/>
         <definition language="SQL"><![CDATA[--Declare
--   @PsCadena         Varbinary(Max) = 0x020000006D1BDDBF6B1DAE2B85CE870BC7A69D86CF8C4040501279CBFB62D5C5EC549427
--Begin
--   Select dbo.Fn_Desencripta_cadena (@PsCadena)
--   Return
--End
--
--Go



Create   Function dbo.Fn_Desencripta_cadena
 (@PsCadena         Varbinary(Max))
Returns Varchar(Max)
As

Begin
--
-- Obtetivo: Función que Desencripta una Cadena de Caracteres
-- Versión:  1
-- 

   Declare
      @o_salida              Varchar(Max),
	  @w_llave               Varchar(150)
   Begin

      Select @w_llave = parametroChar
      From   dbo.conParametrosGralesTbl
      Where  idParametroGral = 4;
      
	  Select @o_salida = Convert(Varchar(Max), Decryptbypassphrase(@w_llave, @PsCadena))

   End

   Return(@o_salida)

End]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsCadena" type="varbinary"/>
         </parameters>
      </routine>
      <routine dataAccess="READS" deterministic="false" name="Fn_Encripta_cadena" returnType="varchar" type="FUNCTION">
         <comment/>
         <definition language="SQL"><![CDATA[-- Declare
--    @PsCadena         Varchar(Max) = 'aaa'
-- Begin
--    Select dbo.Fn_Encripta_cadena (@PsCadena)
--    Return
-- End

-- Go

Create   Function dbo.Fn_Encripta_cadena
 (@PsCadena         Varchar(max))
Returns Varchar(Max)
As

Begin
   Declare
      @o_salida              Varchar(Max),
      @w_llave               Varchar(150)
   Begin

      Select @w_llave = parametroChar
      From   dbo.conParametrosGralesTbl
      Where  idParametroGral = 4
      
      Select @o_salida = Convert(Varchar(Max),EncryptByPassPhrase(@w_llave, @PsCadena), 1)
   End

   Return(@o_salida)

End]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsCadena" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="READS" deterministic="false" name="Fn_GeneraNombreTablaDin" returnType="nvarchar" type="FUNCTION">
         <comment/>
         <definition language="SQL"><![CDATA[-- Función que Genera el sufujo del nombre Dinámico de una tabla seleccionada.
-- 
-- Declare
--    @PsNombre     Sysname = 'IncidenciaBd'
-- 
-- Begin
--    Select dbo.Fn_GeneraNombreTablaDin('inci')
-- 
--    Return
-- 
-- End
-- Go


Create   Function Fn_GeneraNombreTablaDin
 (@PsNombre     Sysname)
Returns Sysname

Begin
   Declare
      @o_salida           Sysname

   Begin
      Set @o_salida = Rtrim(Rtrim(@PsNombre) + '_' + 
                     Replace(Replace(Replace(Substring(Convert(Varchar, Getdate(), 126), 1, 30),':', ''), '.',''), '-', ''))
   End

   Return(@o_salida)

End]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsNombre" type="nvarchar"/>
         </parameters>
      </routine>
      <routine dataAccess="READS" deterministic="false" name="Fn_ValidaCorreo" returnType="bit" type="FUNCTION">
         <comment/>
         <definition language="SQL"><![CDATA[-- Declare
--    @PsCorreo Varchar(300) = 'nino@live.com.mx'
-- Begin
--    Select dbo.Fn_ValidaCorreo(@PsCorreo)
--    Return
-- End
-- 
-- Go


Create   Function dbo.Fn_ValidaCorreo
  (@PsCorreo Varchar(300))  
Returns Bit  
As  

Begin
/*
Objetivo: Validación de Correo.
Versión:  1

*/
  
   Declare
      @w_salida Bit,  
      @w_aux    Varchar(150);

   Set @w_salida = 0  

   If @PsCorreo Like  '%pendiente%'
      Begin
         Return @w_salida  
      End
      
   If @PsCorreo Like '[a-z,0-9,_,-,.,a-z]%@[a-z,0-9,_,-,.,a-z]%.[a-z][a-z]%'
      Begin  
         Set @w_salida = 1  
      End  
   Else  
      Begin  
           
         Set @w_salida = 0  
         Return @w_salida  
      End  
  
   If CharIndex('@',@PsCorreo) <> 0  
      Begin  
         Set @w_aux = Substring(@PsCorreo, CharIndex('@', @PsCorreo) + 1, Len(@PsCorreo))  
         If CharIndex('@', @w_aux) <> 0  
            Begin  
               Set @w_salida = 0  
               Return @w_salida  
            End  
      End  
   Else  
      Begin  
         Set @w_salida = 1  
      End  
  
   If CharIndex('.@', @PsCorreo) <> 0  
      Begin  
         Set @w_salida = 0  
         Return @w_salida  
      End  
   Else  
      Begin  
         Set @w_salida = 1  
      End  
  
   If CharIndex('..', @PsCorreo) <> 0  
      Begin  
         Set @w_salida = 0  
         Return @w_salida  
      End  
   Else  
      Begin  
         Set @w_salida = 1  
      End  
  
   If CharIndex(',', @PsCorreo) <> 0  
      Begin  
         Set @w_salida = 0  
      End  
   Else  
      Begin  
         Set @w_salida = 1  
      End  
  
   If Right(@PsCorreo, 1) Not Between 'a' And 'z'  
      Begin  
         Set @w_salida = 0  
         Return @w_salida  
      End  
   Else  
      Begin  
         Set @w_salida = 1  
      End  
   
   If Charindex('á', @PsCorreo Collate SQL_Latin1_General_CP850_CI_AS) <> 0
      Begin
         Set @w_salida = 0
         Return @w_salida
      End
   Else
      Begin
         Set @w_salida = 1
      End

   If Charindex('é', @PsCorreo Collate SQL_Latin1_General_CP850_CI_AS) <> 0
      Begin
         Set @w_salida = 0
         Return @w_salida
      End
   Else
      Begin
         Set @w_salida = 1
      End

   If Charindex('í', @PsCorreo Collate SQL_Latin1_General_CP850_CI_AS) <> 0
      Begin
         Set @w_salida = 0
         Return @w_salida
      End
   Else
      Begin
         Set @w_salida = 1
      End

   If Charindex('ó', @PsCorreo Collate SQL_Latin1_General_CP850_CI_AS) <> 0
      Begin
         Set @w_salida = 0
         Return @w_salida
      End
   Else
      Begin
         Set @w_salida = 1
      End

   If Charindex('ú', @PsCorreo Collate SQL_Latin1_General_CP850_CI_AS) <> 0
      Begin
         Set @w_salida = 0
         Return @w_salida
      End
   Else
      Begin
         Set @w_salida = 1
      End
      
   If Charindex('ñ', @PsCorreo Collate Modern_Spanish_CI_AI) <> 0
      Begin
         Set @w_salida = 0
         Return @w_salida
      End
   Else
      Begin
         Set @w_salida = 1
      End
 
 /*
   If Exists (Select Top 1 1
               from   dbo.catCorreosNoValidosTbl   
               Where  correo = @PsCorreo)
       Begin
            Set @w_salida =0
       End
    Else
       Begin
            Set @w_salida = 1
       End

*/

   Return (@w_salida)

End]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsCorreo" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="READS" deterministic="false" name="Fn_ValidaExistaLinkServer" returnType="int" type="FUNCTION">
         <comment/>
         <definition language="SQL"><![CDATA[/*

Declare
   @PsLinkServer Varchar(300) = 'BI'
Begin
   Select dbo.Fn_ValidaExistaLinkServer(@PsLinkServer)
   Return
End

Go

*/

Create   Function Fn_ValidaExistaLinkServer
  (@PsLinkServer     Varchar(250))
Returns Int
As

Begin
/*
Objetivo: Valida existencia de Link Server
Versión:  1

*/
   Declare
      @o_salida           int

   Begin
      If @PsLinkServer Is Not Null
         Begin
            Select @o_salida = count(1)
            From   sys.servers s 
            Where  s.server_id <> 0 
            And    s.name       = @PsLinkServer
         End

      Set @o_salida = Isnull(@o_salida, '0')

   End

   Return(@o_salida)

End]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsLinkServer" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="READS" deterministic="false" name="Fn_ValidaUsuario" returnType="int" type="FUNCTION">
         <comment/>
         <definition language="SQL"><![CDATA[/*  
  
Declare  
   @PnIdUsuario         Integer = 3  
Begin  
   Select dbo.Fn_ValidaUsuario(@PnIdUsuario)  
   Return  
End  
  
Go  
  
*/  
  
CREATE   Function dbo.Fn_ValidaUsuario  
  (@PnIdUsuario         Integer)  
Returns Integer  
As  
  
Begin  
/*  
Objetivo: Valida existencia y Estatus de Usuario de Seguridad Corporativa  
Versión:  1  
  
*/  
  
   Declare  
      @w_idEstatus      Tinyint,  
      @o_salida         Integer  
  
   Begin  
      Set @o_salida = 0  
  
--  
  
      Select @w_idEstatus = idEstatus  
      From   dbo.segUsuariosTbl  
      Where  idUsuario    = @PnIdUsuario  
      If @@Rowcount = 0  
         Begin  
            Set @o_salida = 9999  
            Goto Salida  
         End  
  
      If @w_idEstatus = 0  
         Begin  
            Set  @o_salida = 9998  
            Goto Salida  
         End  
  
   End  
  
Salida:  
  
   Set @o_salida = Isnull(@o_salida, ' ')  
  
   Return(@o_salida)  
  
End]]></definition>
         <parameters>
            <parameter mode="IN" name="@PnIdUsuario" type="int"/>
         </parameters>
      </routine>
      <routine dataAccess="READS" deterministic="false" name="Fn_ValidaUsuarioAdmin" returnType="int" type="FUNCTION">
         <comment/>
         <definition language="SQL"><![CDATA[/*

Declare
   @PnIdUsuario         Integer = 3
Begin
   Select dbo.Fn_ValidaUsuarioAdmin(@PnIdUsuario)
   Return
End

Go

*/

Create   Function dbo.Fn_ValidaUsuarioAdmin
  (@PnIdUsuario         Integer)
Returns Integer
As

Begin
/*
Objetivo: Valida existencia, Estatus de Usuario de Seguridad Corporativa y si es de tipo Administrativo
Versión:  1

*/
   Declare
      @w_idEstatus      Tinyint,
      @w_idTipoUsuario  Tinyint,
      @o_salida         Integer

   Begin
      Set @o_salida       = 0

      Select @w_idEstatus     = idEstatus,
             @w_idTipoUsuario = idTipoUsuario
      From   dbo.segUsuariosTbl
      Where  idUsuario    = @PnIdUsuario
      If @@Rowcount = 0
         Begin
            Set  @o_salida = 9999
            Goto Salida
         End

      If @w_idEstatus = 0
         Begin
            Set  @o_salida = 9998
            Goto Salida
         End

      If @w_idTipoUsuario != 1
         Begin
            Set  @o_salida =  9995
            Goto Salida
         End

--

      Select @w_idEstatus = idEstatus
      From   dbo.segUsuariosTbl
      Where  idUsuario    = @PnIdUsuario
      If @@Rowcount = 0
         Begin
            Set @o_salida = 9997
            Goto Salida
         End

      If @w_idEstatus = 0
         Begin
            Set  @o_salida = 9996
            Goto Salida
         End

   End

Salida:

   Set @o_salida = Isnull(@o_salida, ' ')

   Return(@o_salida)

End]]></definition>
         <parameters>
            <parameter mode="IN" name="@PnIdUsuario" type="int"/>
         </parameters>
      </routine>
      <routine dataAccess="READS" deterministic="false" name="Fn_calculaSaludo" returnType="char" type="FUNCTION">
         <comment/>
         <definition language="SQL"><![CDATA[Create    Function Fn_calculaSaludo  
()  
Returns Char(20)  
As  
  
Begin  
   Declare  
      @o_salida             Varchar(20),  
      @w_fecha              Datetime,  
      @w_fecha1             Datetime,  
      @w_fecha2             Datetime,  
      @w_fecha3             Datetime,  
      @w_fecha4             Datetime,  
      @w_fecha5             Datetime,  
      @w_fecha6             Datetime,  
      @w_fecha7             Datetime;  
  
   Begin  
      Select @w_fecha              = Getdate(),  
             @w_fecha1             = Cast(@w_fecha As Date),   
             @w_fecha2             = Dateadd(second, 0.01,          @w_fecha1),  
             @w_fecha3             = Dateadd(minute, ( 5 * 60),     @w_fecha1),  
             @w_fecha4             = Dateadd(second, 0.01,          @w_fecha3),  
             @w_fecha5             = Dateadd(minute, (12 * 60),     @w_fecha1),  
             @w_fecha6             = Dateadd(second, 0.01,          @w_fecha5),  
             @w_fecha7             = Dateadd(minute, (19 * 60),     @w_fecha1)  
  
  
      Set @o_salida = Case When @w_fecha Between @w_fecha2 And @w_fecha3  
                            Then 'Buenas Noches'  
                            When @w_fecha Between @w_fecha4 And @w_fecha5  
                            Then 'Buenos Días'  
                            When @w_fecha Between @w_fecha6 And @w_fecha7  
                            Then 'Buenas Tardes'  
                            Else 'Buenas Noches'  
                       End  
   End  
  
   Return(@o_salida)  
  
End]]></definition>
         <parameters/>
      </routine>
      <routine dataAccess="READS" deterministic="false" name="Fn_existe_tabla" returnType="smallint" type="FUNCTION">
         <comment/>
         <definition language="SQL"><![CDATA[Create Function dbo.Fn_existe_tabla
(@PsTabla      Sysname)
Returns Smallint
As

Begin
   Declare
      @w_existe      Tinyint  = 0

   Begin
      If Exists ( Select Top 1 1
                  From   Sysobjects
                  Where  Uid  = 1
                  And    Type = 'U'
                  And    Name = @PsTabla)
         Begin
            Set @w_existe = 1
         End

   End

   Return(@w_existe)

End]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsTabla" type="nvarchar"/>
         </parameters>
      </routine>
      <routine dataAccess="READS" deterministic="false" name="Fn_splitStringColumna" returnType="varchar" type="FUNCTION">
         <comment/>
         <definition language="SQL"><![CDATA[CREATE   Function dbo.Fn_splitStringColumna(  
    @PsCadena      Varchar(Max),  
    @PsDelimitador Char(1),  
    @PnColumna     Tinyint)  
Returns Varchar(Max)  
  
As  
Begin  
   Declare @w_x      Smallint = 1,  
           @w_cadena Varchar(Max),  
           @w_salida Varchar(100),  
           @w_len    Smallint  
     
   Set @w_len = Len(@PsCadena)  
     
   While @w_x <= @w_len  
   Begin  
      Set @w_cadena = @PsCadena  
     
      If @w_x = @PnColumna  
         Begin  
            If Charindex(@PsDelimitador, @w_cadena) <> 0  
               Begin  
                  Set @w_salida = Substring(@w_cadena, 1, Charindex(@PsDelimitador, @w_cadena) -1)  
               End  
            Else  
               Begin  
                  Set @w_salida = @w_cadena  
               End  
            Break  
         End  
        
      Set @PsCadena = Substring(@w_cadena, Charindex(@PsDelimitador, @w_cadena) + 1, Len(@w_cadena))  
      Set @w_x = @w_x + 1  
   End  
     
   Return @w_salida  
End]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsCadena" type="varchar"/>
            <parameter mode="IN" name="@PsDelimitador" type="char"/>
            <parameter mode="IN" name="@PnColumna" type="tinyint"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Sp_ValidaCadena" type="PROCEDURE">
         <comment><![CDATA[Procedimiento de Alta a la tabla catMensajesErroresTbl.]]></comment>
         <definition language="SQL"><![CDATA[/*

Procedimiento que Consulta la cantidad de tipos de caracteres incluiddos en una Cadena


Declare
   @PsCadena            Varchar(1000)   = 'DOCUMENTO DE PRUEBA_3.xml',
   @PnConsulta           Numeric(2, 0)  = 3,
   @PnEstatus            Integer        = 0,
   @PsMensaje            Varchar(250)

Begin 
   Execute Sp_ValidaCadena @PsCadena,  @PnConsulta, @PnEstatus   Output,         @PsMensaje        Output

   Select @PnEstatus,  @PsMensaje
End
Go

*/


Create Procedure Sp_ValidaCadena
  (@PsCadena             Varchar(1000),
   @PnConsulta           Numeric(2, 0),  -- 1 = Caracteres Númericos, 2 = Caracteres Alfa, 3 = Caracteres Especiales.
   @PnEstatus            Integer        = 0    Output,
   @PsMensaje            Varchar(250)   = ' '  Output)
As

Declare
   @w_posicion           Numeric(4, 0),
   @w_len                Numeric(4, 0),
   @w_char               Numeric(4, 0),
   @w_number             Numeric(4, 0),
   @w_especial           Numeric(4, 0)

Begin
   Select @w_posicion = 0,
          @PnEstatus  = 0,
          @w_len      = Len(@PsCadena),
          @w_char     = 0,
          @w_number   = 0,
          @w_especial = 0
          
   While @w_posicion   < @w_len
   Begin
      Set @w_posicion = @w_posicion + 1
      If  Substring(@PsCadena, @w_posicion, 1) Between '0' And '9'
          Begin
             Set @w_number = @w_number + 1
          End
      Else
         Begin
            If Ascii(Substring(@PsCadena, @w_posicion, 1)) Between 97 And 122 Or
               Ascii(Substring(@PsCadena, @w_posicion, 1)) Between 65 And 90  Or
               Ascii(Substring(@PsCadena, @w_posicion, 1))       = 32
               Begin
                  Set @w_char = @w_char + 1
               End
            Else
               Begin
                  If Not Exists ( Select top 1 1
                                  From   catCaracterEspecTbl  -- Caracteres Válidos 
                                  Where  Ascii(Substring(@PsCadena, @w_posicion, 1)) = ChrAscii)
                           Begin
                       Set @w_especial = @w_especial + 1
                  End
               End
         End
   End
   
   Select @PnEstatus = Case When @PnConsulta = 1
                            Then @w_number
                            When @PnConsulta = 2
                            Then @w_char
                            Else @w_especial
                       End
   If @PnConsulta > 2 And
      @PnEstatus  > 0
      Begin
         Set @PsMensaje = 'Cadena Contiene ' + Cast(@PnEstatus As Varchar) + 
                          Case When @PnEstatus  = 1
                               Then ' Carácter Especial'
                               Else ' Caracteres Especiales'
                          End
      End


   Set Xact_Abort    Off
   Return
End]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsCadena" type="varchar"/>
            <parameter mode="IN" name="@PnConsulta" type="numeric"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spa_Genera_dbLink" type="PROCEDURE">
         <comment><![CDATA[Procedimiento de Alta a Link Servers.]]></comment>
         <definition language="SQL"><![CDATA[/*

Declare
   @PsSever         NVarchar(128) = '192.168.14.30',
   @PsBaseDatos     Sysname       = 'SCSTI',
   @PsDbLink        Sysname       = 'SCSTI',
   @PsTabla         Sysname       = 'segUsuariosTbl',
   @PsUsuario       Varchar( 30)  = 'usscsti',
   @PsPassword      Varchar(250)  = 'u55c5t1',
   @PnEstatus       Integer       = 0,
   @PsMensaje       Varchar(250)  = ' '

Begin
   Execute Spa_Genera_dbLink @PsSever     = @PsSever,
                             @PsBaseDatos = @PsBaseDatos,
                             @PsDbLink    = @PsDbLink,
                             @PsTabla     = @PsTabla,
                             @PsUsuario   = @PsUsuario,
                             @PsPassword  = @PsPassword,
                             @PnEstatus   = @PnEstatus,
                             @PsMensaje   = @PsMensaje

   If @PnEstatus != 0
      Begin
         Select @PnEstatus, @PsMensaje
      End

   Return

End
Go

*/

Create   Procedure Spa_Genera_dbLink
  (@PsSever         Nvarchar(128),
   @PsBaseDatos     Sysname,
   @PsDbLink        Sysname,
   @PsTabla         Sysname,
   @PsUsuario       Varchar( 30),
   @PsPassword      Varchar(250),
   @PnEstatus       Integer       = 0     Output,
   @PsMensaje       Varchar(250)  = ' '   Output)
-- With Encryption
As

Declare 
   @w_sql              NVarchar(500),
   @w_param            NVarchar(500),
   @w_registros        Integer,
   @w_desc_error       Varchar( 250),
   @w_Error            Integer

   
Begin
/*

Objetivo: Dar de Alta Link Servers
Versión:  1
*/

   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    On
   Set Ansi_Warnings On
   Set Ansi_Padding  On
   
   Select @PnEstatus  = 0,
          @PsMensaje  = Null 

   
   If Exists ( Select top 1 1
               From   sys.servers s 
               Where  s.server_id <> 0 
               And    s.name       = @PsDbLink)
      Begin
         Begin Try
            Execute  sys.sp_dropserver @server = @PsDbLink, @droplogins = 'droplogins'
         End   Try
         
         Begin Catch
            Select  @w_Error      = @@Error,
                    @w_desc_error = Substring (Error_Message(), 1, 230)
         End   Catch
         
            If Isnull(@w_Error, 0) <> 0
         Begin
            Select @PnEstatus = @w_Error,
                   @PsMensaje = 'Error.: Eliminando Db_Link. ' + Rtrim(Ltrim(Cast(@w_Error As Varchar))) + ' ' + @w_desc_error
            Set Xact_Abort Off
            Return
         End
     
      End
  
    Begin Try
       Execute sys.sp_addlinkedserver @server = @PsDbLink, @srvproduct = '', @provider = 'SQLNCLI', @datasrc = @PsSever
    End Try
    
    Begin Catch
       Select  @w_Error      = @@Error,
               @w_desc_error = Substring (Error_Message(), 1, 230)
    End   Catch
         
    If Isnull(@w_Error, 0) <> 0
       Begin
          Select @PnEstatus = @w_Error,
                 @PsMensaje = 'Error.: ' + Rtrim(Ltrim(Cast(@w_Error As Varchar))) + ' ' + @w_desc_error
          Set Xact_Abort Off
          Return
       End

    Begin Try
       Execute sp_addlinkedsrvlogin @rmtsrvname  = @PsDbLink,  @useself     = 'FALSE',     @locallogin  = null, 
                                    @rmtuser     = @PsUsuario, @rmtpassword = @PsPassword
    End Try
    
    Begin Catch
       Select  @w_Error      = @@Error,
               @w_desc_error = Substring (Error_Message(), 1, 230)
    End   Catch
         
    If Isnull(@w_Error, 0) <> 0
       Begin
          Select @PnEstatus = @w_Error,
                 @PsMensaje = 'Error.: ' + Rtrim(Ltrim(Cast(@w_Error As Varchar))) + ' ' + @w_desc_error
          Set Xact_Abort Off
          Return
       End

    Select @w_sql   = 'Select @w_output = count(1) '    +
                      'From ' + Rtrim(Ltrim(@PsDbLink)) + '.' + Rtrim(Ltrim(@PsBaseDatos)) + '.dbo.' + @PsTabla,]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsSever" type="nvarchar"/>
            <parameter mode="IN" name="@PsBaseDatos" type="nvarchar"/>
            <parameter mode="IN" name="@PsDbLink" type="nvarchar"/>
            <parameter mode="IN" name="@PsTabla" type="nvarchar"/>
            <parameter mode="IN" name="@PsUsuario" type="varchar"/>
            <parameter mode="IN" name="@PsPassword" type="varchar"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spa_catGeneralesTbl" type="PROCEDURE">
         <comment><![CDATA[Procedimiento de Alta a la Tabla de Catálogos Generales.]]></comment>
         <definition language="SQL"><![CDATA[Create   Procedure Spa_catGeneralesTbl
   (@PsTabla                   Sysname,
    @PsColumna                 Sysname,
    @PnValor                   Smallint,
    @PsDescripcion             Varchar(  60),
    @PnEstatus                 Integer       = 0   Output,
    @PsMensaje                 Varchar( 250) = ' ' Output)  
As

Declare
    @w_sql               Varchar(Max),
    @w_desc_error        Varchar( 250),
    @w_Error             Integer

Begin
/*
Objetivo: Procedimiento de Alta a la Tabla de Catálogos Generales.
Versión:  1

*/
   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    On
   Set Ansi_Warnings On
   Set Ansi_Padding  On
   
   Select @PnEstatus  = 0,
          @PsMensaje  = Null

   If Exists (Select Top 1 1
                  From   catGeneralesTbl
                  Where  tabla   = @PsTabla
                  And    columna = @PsColumna
                  And    valor   = @PnValor)
      Begin
         Select @PnEstatus = 2,
                @PsMensaje = dbo.Fn_Busca_MensajeError(@PnEstatus)
         Set Xact_Abort Off
         Return
      End

   Begin Try
      Insert Into catGeneralesTbl
      Select @PsTabla, @PsColumna, @PnValor, @PsDescripcion
   End Try

   Begin Catch
      Select  @w_Error      = @@Error,
              @w_desc_error = Substring (Error_Message(), 1, 230)
   End   Catch

   If Isnull(@w_Error, 0) <> 0
      Begin
         Select @PnEstatus = @w_Error,
                @PsMensaje = 'Error.: ' + Rtrim(Ltrim(Cast(@w_Error As Varchar))) + ' ' + @w_desc_error
         Set Xact_Abort Off
         Return
      End

   Set Xact_Abort Off
   Return
End]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsTabla" type="nvarchar"/>
            <parameter mode="IN" name="@PsColumna" type="nvarchar"/>
            <parameter mode="IN" name="@PnValor" type="smallint"/>
            <parameter mode="IN" name="@PsDescripcion" type="varchar"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spa_catMensajesErroresTbl" type="PROCEDURE">
         <comment/>
         <definition language="SQL"><![CDATA[/*

Procedimiento que ingresa valores de la tabla de Catalogos Mensajes de Errores.

Declare
   @PnIdError            Varchar(  90)   = Null,
   @PsMensaje            Varchar( 250)   = Null,
   @PnIdUsuarioAct       Integer         = 1,
   @PsIpAct              Varchar(30)     = Null,
   @PsMacAddressAct      Varchar(30)     = Null,
   @PnEstatus            Integer         = 0,
   @PsMensajeR           Varchar( 250)   = ' '

Begin
   Execute  dbo.Spa_catMensajesErroresTbl @PnIdError       = @PnIdError,
                                          @PsMensaje       = @PsMensaje,
                                          @PnIdUsuarioAct  = @PnIdUsuarioAct,
                                          @PsIpAct         = @PsIpAct,
                                          @PsMacAddressAct = @PsMacAddressAct,
                                          @PnEstatus       = @PnEstatus Output,
                                          @PsMensajeR      = @PsMensajeR Output

   If @PnEstatus != 0
      Begin
         Select @PnEstatus, @PsMensajeR
      End

   Return

End
Go

*/

Create   Procedure dbo.Spa_catMensajesErroresTbl
    (@PnIdError         Integer,
     @PsMensaje         Varchar( 250),
     @PnIdUsuarioAct    Integer,
     @PsIpAct           Varchar(30)   = Null,
     @PsMacAddressAct   Varchar(30)   = Null,
     @PnEstatus         Integer       = 0   Output,
     @PsMensajeR        Varchar( 250) = ' ' Output)
As
Declare
    @w_sql               Varchar(Max),
    @w_desc_error        Varchar( 250),
    @w_Error             Integer,
    @w_comilla           Char(1),
    @w_registros         Integer,
    @w_fechaAct          Datetime,
    @w_ipAct             Varchar(30),
    @w_macAddressAct     Varchar(30);

Begin
/*
Objetivo: Dar de Alta al Catálogo de Errores.
Version:  1
*/

   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    On

   Select @PnEstatus       = 0,
          @PsMensajeR      = Null,
          @w_comilla       = Char(39),
          @w_fechaAct      = Getdate(),
          @w_ipAct         = Isnull(@PsipAct,            dbo.Fn_BuscaDireccionIP()),
          @w_macAddressAct = Isnull(@w_macAddressAct, dbo.Fn_Busca_DireccionMac());

--

   Set @PnEstatus = dbo.Fn_ValidaUsuario(@PnIdUsuarioAct)

   If @PnEstatus <> 0
      Begin
         Set @PsMensajeR =  dbo.Fn_Busca_MensajeError(@PnEstatus)

         Set Xact_Abort Off
         Return
      End
--

   If Isnull(@PsMensaje, '') = ''
      Begin

         Select @PnEstatus  = 8103,
                @PsMensajeR = dbo.Fn_Busca_MensajeError(@PnEstatus)

         Set Xact_Abort Off
         Return
      End

   If Exists ( Select top 1 1
               From   dbo.catMensajesErroresTbl
               Where  idError = @PnIdError)
      Begin
         Select @PnEstatus  = 2601,
                @PsMensajeR = dbo.Fn_Busca_MensajeError(@PnEstatus)

         Set Xact_Abort Off
         Return
      End
      
   If Exists ( Select top 1 1
               From   dbo.catMensajesErroresTbl
               Where  mensaje = @PsMensaje)
      Begin
         Select @PnEstatus  = 2601,
                @PsMensajeR = dbo.Fn_Busca_MensajeError(@PnEstatus)

         Set Xact_Abort Off
         Return
      End
     

   Set @w_sql = Concat('Select ', @PnIdError,      ', ',  @w_comilla, @PsMensaje,  @w_comilla , ', ',
                                  @PnIdUsuarioAct, ', ',  @w_comilla, @w_fechaAct, @w_comilla,  ', ',
                                  @w_comilla, @w_ipAct, @w_comilla, ', ', @w_comilla, @w_macAddressAct, @w_comilla )

   Begin Try
      Insert Into dbo.catMensajesErroresTbl
      (idError, mensaje, idUsuarioAct, fechaAct,
       ipAct,   macAddressAct)
      Execute (@w_sql)

      Set  @w_registros = @@Rowcount
   End Try

   Begin Catch
      Select  @w_Error      = @@Error,
              @w_desc_error = Substring (Error_Message(), 1,]]></definition>
         <parameters>
            <parameter mode="IN" name="@PnIdError" type="int"/>
            <parameter mode="IN" name="@PsMensaje" type="varchar"/>
            <parameter mode="IN" name="@PnIdUsuarioAct" type="int"/>
            <parameter mode="IN" name="@PsIpAct" type="varchar"/>
            <parameter mode="IN" name="@PsMacAddressAct" type="varchar"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensajeR" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spa_conParametrosGralesTbl" type="PROCEDURE">
         <comment><![CDATA[Procedimiento de Alta a la Tabla de Parametros Generales.]]></comment>
         <definition language="SQL"><![CDATA[Create   Procedure Spa_conParametrosGralesTbl
  (@PsDescripcion        Varchar(  100), 
   @PnParametroNumber    Integer,
   @PsParametroChar      Varchar(  120),
   @PdParametroFecha     Datetime,
   @PnIdUsuarioAct       Integer,
   @PsIpAct              Varchar(   30),
   @PsMacAddressAct      Varchar(   30),
   @PnEstatus            Integer          = 0    Output,
   @PsMensaje            Varchar(  250)   = ' '  Output)
As

Declare
   @w_desc_error          Varchar( 250),
   @w_Error               Integer,
   @w_idParametroGral     Smallint,
   @w_fechaAct            Datetime

Begin
/*
Objetivo: Alta de Registros a la Tabla de Parametros Generales.
Versión:  1

*/
   Set Quoted_identifier Off
   Set Nocount            On
   Set Xact_Abort         On
   Set Ansi_Nulls         On
   Set Ansi_Warnings      On
   Set Ansi_Padding       On
   
   Select @PnEstatus      = 0,
          @PsMensaje      = Null,
          @w_fechaAct     = GetDate()

   If Exists ( Select Top 1 1
               From   conParametrosGralesTbl
               Where  descripcion = @PsDescripcion)
      Begin
         Select @PnEstatus = 2028,
                @PsMensaje = Dbo.Fn_Busca_MensajeError(@PnEstatus)
         Set Xact_Abort Off
         Return
      End

   Select @w_idParametroGral = Max(idParametroGral)
   From   conParametrosGralesTbl

   Set @w_idParametroGral = Isnull(@w_idParametroGral, 0) + 1

   Begin Try
      Insert Into  conParametrosGralesTbl
      (idParametroGral, descripcion,  parametroNumber, ParametroChar,
       parametroFecha,  idUsuarioAct, fechaAct,        ipAct,
       macAddressAct)
      Select @w_idParametroGral, @PsDescripcion,   @PnParametroNumber, @PsParametroChar,
             @PdParametroFecha,  @PnIdUsuarioAct,  @w_fechaAct,        @PsIpAct,
             @PsMacAddressAct

   End Try

   Begin Catch
      Select  @w_Error      = @@Error,
              @w_desc_error = Substring (Error_Message(), 1, 230)
   End   Catch
        
   If Isnull(@w_Error, 0) <> 0
      Begin
         Select @PnEstatus = @w_Error,
                @PsMensaje = 'Error.: ' + Rtrim(Ltrim(Cast(@w_Error As Char))) + ' ' + @w_desc_error
         Set Xact_Abort Off
         Return
      End

   Set Xact_Abort Off
   Return

End]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsDescripcion" type="varchar"/>
            <parameter mode="IN" name="@PnParametroNumber" type="int"/>
            <parameter mode="IN" name="@PsParametroChar" type="varchar"/>
            <parameter mode="IN" name="@PdParametroFecha" type="datetime"/>
            <parameter mode="IN" name="@PnIdUsuarioAct" type="int"/>
            <parameter mode="IN" name="@PsIpAct" type="varchar"/>
            <parameter mode="IN" name="@PsMacAddressAct" type="varchar"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spa_conProcesosTbl" type="PROCEDURE">
         <comment/>
         <definition language="SQL"><![CDATA[CREATE Procedure [dbo].[Spa_conProcesosTbl]            
  (@PnIdMotivo                Integer,        
   @PnIdTipoNotificacion      Tinyint        = 0,        
   @PsParametros              Varchar (8000) = '',        
   @PsURL                     Varchar (2000) = '',        
   @PdFechaProgramada         Datetime       = Null,        
   @PnIdUsuarioAct            Smallint,        
   @PsXML                     Varchar(Max)            = Null,        
   @PsHTML                    NVarchar( Max) = Null,        
   @PsTipo                    NVarchar(  20) = Null,        
   @PsRuta                    Varchar ( 250) = Null,        
   @PsNombreArchivo           Varchar ( 250) = Null,        
   @PnEstatus                 Integer        = 0   Output,        
   @PsMensaje                 Varchar (250)  = ' ' Output)        
As            
            
Declare            
   @w_desc_error              Varchar( 250),            
   @w_Error                   Integer,            
   @w_fechaAct                Datetime,            
   @w_idEstatus               Bit,            
   @w_idProceso               Integer,            
   @w_fechaProgramada         Datetime,            
   @w_idSession               Varchar(60)        
            
Begin            
   Set Nocount       On            
   Set Xact_Abort    On            
   Set Ansi_Nulls    On            
   Set Ansi_Warnings On            
   Set Ansi_Padding  On            
            
   Select @PnEstatus         = 0,            
          @w_idEstatus       = 1,            
          @PsMensaje         = Null,            
          @w_fechaAct        = Getdate(),            
          @w_idSession       = Substring(Replace(Cast(newid() As Varchar(100)), '-', ''), 1, 30),            
          @w_fechaProgramada = Case When @PdFechaProgramada Is Null            
                                    Then @w_fechaAct            
                                    Else @PdFechaProgramada            
                               End            
--            
        
   Select @PnEstatus = dbo.Fn_ValidaUsuario(@PnIdUsuarioAct)        
   If @PnEstatus != 0            
      Begin            
         Set @PsMensaje = Dbo.Fn_Busca_MensajeError(@PnEstatus)        
            
         Set Xact_Abort Off            
         Return            
      End            
            
   If Not Exists ( Select Top 1 1            
                   From   dbo.conMotivosCorreoTbl            
                   Where  idMotivo = @PnIdMotivo)        
      Begin            
         Select @PnEstatus = 2007,            
                @PsMensaje = Dbo.Fn_Busca_MensajeError(@PnEstatus)        
            
         Set Xact_Abort Off            
         Return            
      End            
            
   If Not Exists ( Select Top 1 1            
                   From   dbo.catCriteriosTbl            
                   Where  criterio = 'idTipoNotificacion'            
                   And    valor    = @PnIdTipoNotificacion)          
      Begin            
         Select @PnEstatus = 6202,            
                @PsMensaje = Dbo.Fn_Busca_MensajeError(@PnEstatus)        
        
         Set Xact_Abort Off        
         Return        
      End        
        
   Begin Try        
      Insert Into dbo.conProcesosTbl        
      (idMotivoCorreo,  idTipoNotificacion, idUsuario,        
       parametros,      fechaProgramada,    urlArchivoSalida,   idUsuarioAct,            
       fechaAct,        idSession)        
      Select @PnIdMotivo,   @PnIdTipoNotificacion, @PnIdUsuarioAct,            
             @PsParametros,  @w_fechaProgramada, @PsURL,                @PnIdUsuarioAct,            
             @w_fechaAct,    @w_idSession        
      Set @w_idProceso = @@Identity        
   End Try            
         
   Begin Catch            
      Select  @w_Error]]></definition>
         <parameters>
            <parameter mode="IN" name="@PnIdMotivo" type="int"/>
            <parameter mode="IN" name="@PnIdTipoNotificacion" type="tinyint"/>
            <parameter mode="IN" name="@PsParametros" type="varchar"/>
            <parameter mode="IN" name="@PsURL" type="varchar"/>
            <parameter mode="IN" name="@PdFechaProgramada" type="datetime"/>
            <parameter mode="IN" name="@PnIdUsuarioAct" type="smallint"/>
            <parameter mode="IN" name="@PsXML" type="varchar"/>
            <parameter mode="IN" name="@PsHTML" type="nvarchar"/>
            <parameter mode="IN" name="@PsTipo" type="nvarchar"/>
            <parameter mode="IN" name="@PsRuta" type="varchar"/>
            <parameter mode="IN" name="@PsNombreArchivo" type="varchar"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spc_AnalisisObjetosBD" type="PROCEDURE">
         <comment><![CDATA[Procedimiento que lista los objetos de base y fecha de creacion y de modificacion.]]></comment>
         <definition language="SQL"><![CDATA[/*

Procedimiento que lista los objetos de base y fecha de creacion y de modificacion.

Declare
   @PsProcedimiento      Varchar(4000)    = Null,
   @PnIdUsuarioAct       Smallint         = 1,
   @PnEstatus            Integer          = 0,
   @PsMensaje            Varchar(  250)   = ' '

Begin
   Execute  Spc_AnalisisObjetosBD @PsProcedimiento     = @PsProcedimiento,
                                  @PnIdUsuarioAct      = @PnIdUsuarioAct,
                                  @PnEstatus           = @PnEstatus Output,
                                  @PsMensaje           = @PsMensaje Output

   If @PnEstatus != 0
      Begin
         Select @PnEstatus, @PsMensaje
      End

   Return

End
Go

*/

Create   Procedure Spc_AnalisisObjetosBD
  (@PsProcedimiento             Sysname    = Null,
   @PnIdUsuarioAct              Integer,
   @PnEstatus                   Integer          = 0   Output,
   @PsMensaje                   Varchar(  250)   = ' ' Output)
As

Declare
   @w_desc_error              Varchar( 250),
   @w_Error                   Integer,
   @w_idEstatus               Tinyint,
   @w_idTipoUsuario           Tinyint,
   @w_comilla                 Char(1),
   @w_sql                     Varchar(Max),
   @w_tablas                  Varchar(4000),
   @w_tabla                   Sysname,
   @w_existe                  Bit,
   @w_pos                     Integer,
   @w_len                     Integer,
   @w_esquema                 Varchar(   30)

Begin
/*

Objetivo: listar los objetos de base y fecha de creacion y de modificacion.
Versión:  1
*/

   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    On
   Set Ansi_Warnings On
   Set Ansi_Padding  On
   
   Select @PnEstatus       = 0,
          @PsMensaje       = ' ',
          @w_esquema       = Concat(current_User, '.'),
          @w_comilla       = Char(39);

   Select @w_idEstatus     = idEstatus
   From   dbo.segUsuariosTbl
   Where  idUsuario    = @PnIdUsuarioAct
   If @@Rowcount = 0
      Begin
         Select @PnEstatus = 9999,
                @PsMensaje = dbo.Fn_Busca_MensajeError(@PnEstatus)

         Set Xact_Abort Off
         Return
      End

   If @w_idEstatus = 0
      Begin
         Select @PnEstatus = 9998,
                @PsMensaje = dbo.Fn_Busca_MensajeError(@PnEstatus)

         Set Xact_Abort Off
         Return
      End

   If @w_idTipoUsuario != 1
      Begin
         Select @PnEstatus = 9995,
                @PsMensaje = dbo.Fn_Busca_MensajeError(@PnEstatus)

         Set Xact_Abort Off
         Return
      End
   
   Select @w_idEstatus = idEstatus
   From   segUsuariosTbl
   Where  idUsuario    = @PnIdUsuarioAct
   If @@Rowcount = 0
      Begin
         Select @PnEstatus = 9997,
                @PsMensaje = dbo.Fn_Busca_MensajeError(@PnEstatus)

         Set Xact_Abort Off
         Return
      End

   If @w_idEstatus = 0
      Begin
         Select @PnEstatus = 9996,
                @PsMensaje = dbo.Fn_Busca_MensajeError(@PnEstatus)
         Set Xact_Abort Off
         Return
      End

   Set @w_tabla = Rtrim('segDimObjetos_' + 
                  Substring(Replace(Cast(Newid() As Varchar(Max)), '-', ''), 1, 12))


   Set @w_sql   = 'Create  Table    dbo.' + @w_tabla    + ' ' +
                  '(tipo                 Char(2)      Not Null,
                    name                 Sysname      Not Null, 
                    fechaCreacion        Datetime     Not Null,
                    fechaModificacion    Datetime     Not Null,
                    Primary Key (tipo, name)) '

   Begin Try
      Execute (@w_sql)
   End Try

   Begin Catch
      Select  @w_Error      = @@Error,
              @w_desc_error = Substring (Error_Message(), 1, 230)
   End   Catch

   If Isnull(@w_Error, 0) <> 0
      Begin
         Select @PnEstatus = @w_Error,
                @PsMensaje = 'Error.: ' + Rtrim(Ltrim(Cast(@w_Err]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsProcedimiento" type="nvarchar"/>
            <parameter mode="IN" name="@PnIdUsuarioAct" type="int"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spc_AnalisisTabla" type="PROCEDURE">
         <comment><![CDATA[Procedimiento que Consulta el Estatus de las tablas de la base de datos.]]></comment>
         <definition language="SQL"><![CDATA[/*

Procedimiento que lista los tamaños de las tablas.

Declare
   @PsTablas                    Varchar(Max)     = Null,
   @PnRegistrosMinimos          Integer          = 0,
   @PnOrden                     Tinyint          = 2,
   @PnIdUsuarioAct              Smallint         = 1,
   @PnEstatus                   Integer          = 0,
   @PsMensaje                   Varchar(  250)   = ' '

Begin
   Execute  dbo.Spc_AnalisisTabla @PsTablas           = @PsTablas,
                                  @PnRegistrosMinimos = @PnRegistrosMinimos,
                                  @PnOrden            = @PnOrden,
                                  @PnIdUsuarioAct     = @PnIdUsuarioAct,
                                  @PnEstatus          = @PnEstatus Output,
                                  @PsMensaje          = @PsMensaje Output

   If @PnEstatus != 0
      Begin
         Select @PnEstatus, @PsMensaje
      End

   Return

End
Go

*/

Create   Procedure dbo.Spc_AnalisisTabla
  (@PsTablas                    Varchar(Max)          = Null,  
   @PnRegistrosMinimos          Integer          = 0,  
   @PnOrden                     Tinyint          = 1,  
   @PnIdUsuarioAct              Integer,  
   @PnEstatus                   Integer          = 0   Output,  
   @PsMensaje                   Varchar(  250)   = ' ' Output)  
As  
  
Declare  
   @w_desc_error               Varchar( 250),  
   @w_Error                    Integer,  
   @w_idEstatus                Tinyint,  
   @w_idTipoUsuario            Tinyint,  
   @w_comilla                  Char(1),  
   @w_sql                      Varchar(Max),  
   @w_tablas                   Varchar(4000),  
   @w_tabla                    Sysname,  
   @w_existe                   Bit,  
   @w_pos                      Integer,  
   @w_len                      Integer  
  
Begin  
/*  
Objetivo: lista los tamaños de las tablas  
Versión:  1  
  
*/  
  
   Set Nocount       On  
   Set Xact_Abort    On  
   Set Ansi_Nulls    Off  
   Set Ansi_Warnings On  
   Set Ansi_Padding  On  
  
   Select @PnEstatus       = 0,  
          @PsMensaje       = ' ',  
          @w_comilla       = Char(39);  
  
   Set @w_tabla = Rtrim('segDimTablas_' +  
                  Substring(Replace(Cast(Newid() As Varchar(Max)), '-', ''), 1, 12))  
  
   Set @w_existe = dbo.Fn_existe_tabla(@w_tabla)  
  
   If @w_existe = 1  
      Begin  
         Set @w_sql = 'Drop Table Dbo.' + @w_tabla  
  
         Begin Try  
            Execute (@w_sql)  
         End Try  
  
         Begin Catch  
            Select  @w_Error      = @@Error,  
                    @w_desc_error = Substring (Error_Message(), 1, 230)  
         End   Catch  
  
         If Isnull(@w_Error, 0) <> 0  
            Begin  
               Select @PnEstatus = @w_Error,  
                      @PsMensaje = 'Error.: ' + Rtrim(Ltrim(Cast(@w_Error As Varchar))) + ' ' + @w_desc_error  
  
               Set Xact_Abort Off  
               Return  
            End  
  
      End  
  
   Set @w_sql   = 'Create     Table dbo.' + @w_tabla    + ' ' +  
                  '(tabla               Sysname      Not Null, '    +  
                   'registros           Integer      Not Null, '    +  
                   'espacioInicialMB    Varchar(18)  Not Null, '    +  
                   'espacioDatosMB      Varchar(18)  Not Null, '    +  
                   'espacioIndicesMB    Varchar(18)  Not Null, '    +  
                   'disponibleMB        Varchar(18)  Not Null, '    +  
                   'Primary Key (tabla)) '  
  
   Begin Try  
      Execute (@w_sql)  
   End Try  
  
   Begin Catch  
      Select  @w_Error      = @@Error,  
              @w_desc_error = Substring (Error_Message(), 1, 230)  
   End   Catch  
  
   If Isnull(@w_Error, 0) <> 0  
      Begin  
         Select @PnEstatus = @w_Error,  
                @PsMensaje = 'Error.: ' + Rtri]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsTablas" type="varchar"/>
            <parameter mode="IN" name="@PnRegistrosMinimos" type="int"/>
            <parameter mode="IN" name="@PnOrden" type="tinyint"/>
            <parameter mode="IN" name="@PnIdUsuarioAct" type="int"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spc_Lista_Det_Funciones" type="PROCEDURE">
         <comment><![CDATA[Procedimiento que Consulta los parámetros de los Funciones declarados en la base de datos.]]></comment>
         <definition language="SQL"><![CDATA[/*
Declare
   @PsFuncion       Sysname      = Null,
   @PnEstatus       Integer      = 0,
   @PsMensaje       Varchar(250) = ' ';
Begin
   Execute dbo.Spc_Lista_Det_Funciones @PsFuncion    = @PsFuncion,
                                       @PnEstatus    = @PnEstatus Output,
                                       @PsMensaje    = @PsMensaje Output;
   If @PnEstatus != 0
      Begin
         Select @PnEstatus, @PsMensaje;
      End

   Return

End
Go
*/

Create   Procedure dbo.Spc_Lista_Det_Funciones
  (@PsFuncion    Sysname      = Null,
   @PnEstatus    Integer      = 0    Output,
   @PsMensaje    Varchar(250) = ' '  Output)
-- With Encryption
As
   Declare
   @w_Error             Integer,
   @w_desc_error        Varchar( 250)

Begin
   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    On
   Set Ansi_Warnings On
   Set Ansi_Padding  On

   Begin Try

     Select SCHEMA_NAME(so.SCHEMA_ID) AS Esquema,
     so.name AS [Nombre Función],
     so.type As [Tipo Función],
     so.Type_Desc AS [Descripción Tipo Función],
     p.parameter_id AS [Id Parametro],
     p.name AS [Nombre Parametro],
     TYPE_NAME(p.user_type_id) AS [Tipo de Dato]
     , Case When p.system_type_id Not In(34, 35, 58, 61, 189) Then
               Case When p.max_length > 0 And p.precision = 0 Then Cast(p.max_length As Varchar)
     		       When p.max_length < 0 And p.precision = 0 Then 'Max'
     		       When p.precision  > 0 And p.scale = 0 Then Cast(p.precision As Varchar)
     			   When p.precision  > 0 And p.scale > 0 Then Cast(p.precision As Varchar) + ', ' + Cast(p.scale As Varchar)
     		  End
     	   Else Cast(p.max_length As Varchar)
           End As [Longitud]
     , Case When p.is_output = 1 Then 'OUT' Else 'IN' End As [Tipo Parametro]
     From sys.objects    As so
     Join sys.parameters As p  On so.OBJECT_ID = p.OBJECT_ID
     Join sys.types      As st On st.system_type_id = p.system_type_id  And p.user_type_id = st.user_type_id
     Where 1=1
	 And so.TYPE IN ('FN','TF','IF')
     And so.name   like Iif(@PsFuncion  Is Null, so.name,  '%' + @PsFuncion + '%')
	 Order By [Esquema], so.name, p.parameter_id


    End Try

	Begin Catch
       Select  @w_Error      = @@Error,
               @w_desc_error = Substring (Error_Message(), 1, 230)
    End   Catch

    If Isnull(@w_Error, 0) <> 0
       Begin
          Select @PnEstatus = @w_Error,
                 @PsMensaje = 'Error.: ' + Rtrim(Ltrim(Cast(@w_Error As Varchar))) + ' ' + @w_desc_error
          Select @PsMensaje

          Set Xact_Abort Off
          Return
       End
    Select @PnEstatus, @PsMensaje

End]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsFuncion" type="nvarchar"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spc_Lista_Det_Tablas" type="PROCEDURE">
         <comment><![CDATA[Procedimiento que Consulta los Campos de las tablas.]]></comment>
         <definition language="SQL"><![CDATA[/*

Procedimiento que lista los campos de una Tabla

Declare
   @PsTabla      Varchar( 60) = Null,
   @PnEstatus    Integer      = 0,
   @PsMensaje    Varchar(250) = ' '
   
Begin
   Execute Spc_Lista_Det_Tablas @PsTabla   = @PsTabla,
                                @PnEstatus = @PnEstatus Output,
                                @PsMensaje = @PsMensaje Output;

   If @PnEstatus != 0
      Begin
         Select @PnEstatus, @PsMensaje
      End
   
   Return

End
Go
*/

Create   Procedure Spc_Lista_Det_Tablas
  (@PsTabla      Varchar( 60) = Null,
   @PnEstatus    Integer      = 0     Output,
   @PsMensaje    Varchar(250) = Null  Output)

As

Declare
  C_tablas Cursor For
  Select   Name, id
  from     Sysobjects 
  Where    Uid     = 1
  And      Type    = 'U'
  And      Name    = Case When @PsTabla Is Null
                          Then Name
                     Else @PsTabla
                 End
  Order    By 1

Declare
   @w_tabla             Sysname,
   @w_columna           Sysname,
   @w_idTabla           Integer,
   @w_column_id         Integer,
   @w_column_idx        Integer,
   @w_column_Fk         Integer,
   @w_TipoCampo         Varchar(250),
   @w_Longitud          Integer,
   @w_Decimales         Integer,
   @w_requerido         Char(2),
   @w_aplica            Bit,
   @w_desc_error        Varchar( 250),
   @w_Error             Integer,
   @w_descripcion       NVarchar(1500),
   @w_esFk              Char(2),
   @w_nombreFk          Varchar(100), 
   @w_tablaReferenciada Varchar(150),
   @w_campoReferenciado Varchar(150),
   @w_esIndex           Char(2),
   @w_indexType         Varchar(20),
   @w_indexName         Varchar(100),
   @w_dfConstraint      Varchar(100)

Begin

/*
Objetivo: Listar las caracteristicas de los campos que conforman una Tabla.
Versión:  2

*/

Objetivo:
   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    Off
   Set Ansi_Warnings On
   Set Ansi_Padding  On

   Select  @PnEstatus    = 0,
           @PsMensaje    = ''
   
   Create table #Tmp_Objectos
   (Orden             SmallInt     Not Null,
    BaseDatos         Sysname      Default ' ',
    Objeto            Sysname      Default ' ', 
    Tabla             Sysname      Default ' ',
    idcolumna         Integer      Null,
    Columna           Sysname      Default ' ',
    Tipo              Varchar(250) Default ' ',
    Longitud          Varchar(20)  Default ' ',
    Decimales         Varchar(20)  Default ' ',
    Requerido         Char(2)      Default ' ',
    Llave_Prim        Varchar(5)   Default ' ',
    Llave_For         Varchar(5)   Default ' ',
    Descripcion       NVarchar(1500),
    esFk              Char(2)      Default ' ' ,
    nombreFk          Varchar(100) Default ' ',
    tablaReferenciada Varchar(150) Default ' ',
    campoReferenciado Varchar(150) Default ' ',
    esIndex           Char(2)      Default ' ',
    indexType         Varchar(20)  Default ' ',
    indexName         Varchar(100) Default ' ',
    dfConstraint      Varchar(100) Default ' ')

   Insert Into #Tmp_Objectos
   (Orden, BaseDatos, Descripcion)
   Select 0, db_Name(), (Select Cast(Value As NVarchar(1550))
      From   fn_listextendedproperty('MS_Description', Null, Null, Null, Null, 
              Null, Null))

   Open  C_tablas
   While @@Fetch_status < 1
   Begin
      Fetch C_tablas Into @w_tabla, @w_idTabla
      If @@Fetch_status <> 0
         Begin
            Break
         End

      Set @w_descripcion = ''

      Select @w_descripcion = Cast(Value As NVarchar(1550))
      From   fn_listextendedproperty('MS_Description', 'SCHEMA', 'dbo', 'table', @w_tabla, 
              Null, Null)

      Insert Into #Tmp_Objectos
      (Orden, Objeto, tabla, Descripcion)
      Values (1, @w_tabla, @w_tabla, @w_descripcion)
      
      Declare
         C_columnas Cursor For
           Select Name, Column_id]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsTabla" type="varchar"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spc_Lista_Det_Triggers" type="PROCEDURE">
         <comment><![CDATA[Procedimiento que Consulta los disparadores declarados en la base de datos.]]></comment>
         <definition language="SQL"><![CDATA[/*
Declare
   @PsTabla      Sysname      = Null,
   @PnEstatus    Integer      = 0,
   @PsMensaje    Varchar(250) = ' ';
Begin
   Execute dbo.Spc_Lista_Det_Triggers @PsTabla   = @PsTabla,
                                      @PnEstatus = @PnEstatus Output,
                                      @PsMensaje = @PsMensaje Output;
   If @PnEstatus != 0
      Begin
         Select @PnEstatus, @PsMensaje;
      End

   Return

End
Go
*/

Create   Procedure dbo.Spc_Lista_Det_Triggers
  (@PsTabla      Sysname      = Null,
   @PnEstatus    Integer      = 0    Output,
   @PsMensaje    Varchar(250) = ' '  Output)
--- With Encryption
As
Declare
   @w_Error             Integer,
   @w_desc_error        Varchar( 250)

Begin
   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    On
   Set Ansi_Warnings On
   Set Ansi_Padding  On

   Begin Try

     Select
         db_name() [Base de Datos]
         , OBJECT_NAME(so.parent_obj) AS [Nombre Tabla]
         , so.name AS [Nombre Trigger]
         , USER_NAME(so.uid) AS [Propietario]
         , s.name AS [Esquema]
     	 , Case When OBJECTPROPERTY(id, 'ExecIsTriggerDisabled')  = 0 Then 'Si' Else 'No' End As [Habilitado]
         , Case When OBJECTPROPERTY(id, 'ExecIsInsteadOfTrigger') = 1 Then 'Si' Else 'No' End As [InsteadOf]
         , Case When OBJECTPROPERTY(id, 'ExecIsAfterTrigger')     = 1 Then 'Si' Else 'No' End As [After]
     	 , Case When OBJECTPROPERTY(id, 'ExecIsInsertTrigger')    = 1 Then 'Si' Else 'No' End As [Insert]
         , Case When OBJECTPROPERTY(id, 'ExecIsUpdateTrigger')    = 1 Then 'Si' Else 'No' End As [Update]
         , Case When OBJECTPROPERTY(id, 'ExecIsDeleteTrigger')    = 1 Then 'Si' Else 'No' End As [Delete]
     From  sysobjects  so
     Join  sysusers      On so.uid        = sysusers.uid
     Join  sys.tables  t On so.parent_obj = t.object_id
     Join  sys.schemas s On t.schema_id   = s.schema_id
     WHERE 1=1
	 And so.type = 'TR'
	 And OBJECT_NAME(so.parent_obj)  = Iif(@PsTabla  Is Null, OBJECT_NAME(so.parent_obj),  @PsTabla)

    End Try

	Begin Catch
       Select  @w_Error      = @@Error,
               @w_desc_error = Substring (Error_Message(), 1, 230)
    End   Catch

    If Isnull(@w_Error, 0) <> 0
       Begin
          Select @PnEstatus = @w_Error,
                 @PsMensaje = 'Error.: ' + Rtrim(Ltrim(Cast(@w_Error As Varchar))) + ' ' + @w_desc_error
          Select @PsMensaje

          Set Xact_Abort Off
          Return
       End
    Select @PnEstatus, @PsMensaje


End]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsTabla" type="nvarchar"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spc_Lista_Det_Vistas" type="PROCEDURE">
         <comment><![CDATA[Procedimiento que Consulta las vistas declaradas en la base de datos.]]></comment>
         <definition language="SQL"><![CDATA[/*
Declare
   @PsVista      Sysname      = Null,
   @PnEstatus    Integer      = 0,
   @PsMensaje    Varchar(250) = ' ';
Begin
   Execute dbo.Spc_Lista_Det_Vistas @PsVista   = @PsVista,
                                    @PnEstatus = @PnEstatus Output,
                                    @PsMensaje = @PsMensaje Output;
   If @PnEstatus != 0
      Begin
         Select @PnEstatus, @PsMensaje;
      End

   Return

End
Go
*/

Create   Procedure Spc_Lista_Det_Vistas
  (@PsVista      Sysname      = Null,
   @PnEstatus    Integer      = 0    Output,
   @PsMensaje    Varchar(250) = ' '  Output)
-- With Encryption
As

Declare
  C_tablas Cursor For
  Select   Name, id
  from     Sysobjects
  Where    Uid     = 1
  And      Type    = 'V'
  And      Name    = Case When @PsVista Is Null
                          Then Name
                     Else @PsVista
                 End
  Order    By 1

Declare
   @w_tabla             Sysname,
   @w_columna           Sysname,
   @w_idTabla           Integer,
   @w_column_id         Integer,
   @w_TipoCampo         Varchar(250),
   @w_Longitud          Integer,
   @w_Decimales         Integer,
   @w_requerido         Char(2),
   @w_aplica            Bit,
   @w_desc_error        Varchar( 250),
   @w_Error             Integer,
   @w_descripcion       NVarchar(1500),
   @w_dependencias      NVarchar(1500)

Begin
   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    On
   Set Ansi_Warnings On
   Set Ansi_Padding  On

   Create table #Tmp_Objectos
   (Orden             SmallInt        Not Null,
    BaseDatos         Sysname         Default ' ',
    Objeto            Sysname         Default ' ',
    Tabla             Sysname         Default ' ',
    idcolumna         Integer         Null,
    Columna           Sysname         Default ' ',
    Tipo              Varchar(  250)  Default ' ',
    Longitud          Varchar   (20)  Default ' ',
    Decimales         Varchar(   20)  Default ' ',
    Descripcion       NVarchar(1500)  Default ' ',
    Dependencias      NVarchar(1500)  Default ' ')

   Insert Into #Tmp_Objectos
   (Orden, BaseDatos, Descripcion)
   Select 0, db_Name(), (Select Cast(Value As NVarchar(1550))
   From   fn_listextendedproperty('MS_Description', Null, Null, Null, Null,
              Null, Null))

   Open  C_tablas
   While @@Fetch_status < 1
   Begin
      Fetch C_tablas Into @w_tabla, @w_idTabla
      If @@Fetch_status <> 0
         Begin
            Break
         End

      Set @w_descripcion = ''

      Select @w_descripcion = Cast(Value As NVarchar(1550))
      From   fn_listextendedproperty('MS_Description', 'Schema', 'dbo', 'table', @w_tabla,
              Null, Null)

      Select @w_dependencias = Stuff
      (
       (
        Select ', ' +
        Iif(t.referenced_server_name Is Null,'',  t.referenced_server_name+'.')   +
        Iif(t.referenced_database_name Is Null,'',t.referenced_database_name+'.') +
        Iif(t.referenced_schema_name Is Null,'',  t.referenced_schema_name+'.')   +
        t.referenced_entity_name
        From sys.sql_expression_dependencies As t
        Where t.referencing_id = @w_idTabla
        For XML Path (''), Type
       ).value('.', 'varchar(max)'), 1, 1, '')

      Insert Into #Tmp_Objectos
      (Orden, Objeto, tabla, Descripcion, Dependencias)
      Values (1, @w_tabla, @w_tabla, @w_descripcion, @w_dependencias)

      Declare
         C_columnas Cursor For
           Select Name, Column_id
           From   sys.columns
           Where  Object_id = @w_idTabla
           Order  By Column_id

      Begin
         Open   C_columnas
         While  @@Fetch_Status < 1
         Begin
            Fetch C_columnas Into @w_columna, @w_column_id
            If @@Fetch_status <> 0
               Begin
                  Break
               End

            Set @w_descripcion = ' '

            Select @w_de]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsVista" type="nvarchar"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spc_Lista_Param_Procedimientos" type="PROCEDURE">
         <comment><![CDATA[Procedimiento que Consulta los procedimientos y sus parámetros, declarados en la base de datos.]]></comment>
         <definition language="SQL"><![CDATA[/*
Declare
   @PsProc       Sysname      = 'Gener',
   @PnEstatus    Integer      = 0,
   @PsMensaje    Varchar(250) = ' ';
Begin
   Execute dbo.Spc_Lista_Param_Procedimientos @PsProc    = @PsProc,
                                              @PnEstatus = @PnEstatus Output,
                                              @PsMensaje = @PsMensaje Output;
   If @PnEstatus != 0
      Begin
         Select @PnEstatus, @PsMensaje;
      End

   Return

End
Go
*/

Create   Procedure dbo.Spc_Lista_Param_Procedimientos
  (@PsProc       Sysname      = Null,
   @PnEstatus    Integer      = 0    Output,
   @PsMensaje    Varchar(250) = ' '  Output)
-- With Encryption
As
Begin
   Set Nocount       On
   Set Xact_Abort    On

   Create Table #tempSps(
    Id                   Integer Identity(1,1) Primary Key,
    Procedimiento        Varchar(150),
    Parametro_Orden      Smallint,
    Nombre_Parametro     Varchar(100),
    Tipo_Dato            Varchar(30),
    Longitud_Caracter    Integer,
    Precision_Numerica   Integer,
    Escala               Integer,
    Collation            Varchar(150),
    Set_Caracteres       Varchar(50),
    Tipo_Parametro       Varchar(10));

   Insert Into #tempSps
       (Procedimiento,            Parametro_Orden,        Nombre_Parametro,
        Tipo_Dato,   Longitud_Caracter,    Precision_Numerica,     Escala,
        Collation,   Set_Caracteres,       Tipo_Parametro)
   Select a.name,              b.ordinal_position,    b.parameter_name,
          b.data_type,         b.character_maximum_length,   b.numeric_precision,   b.numeric_scale,
          b.collation_name,    b.character_set_name,         b.parameter_modE
   From  sys.procedures a
   Join  INFORMATION_SCHEMA.PARAMETERS b
   On    b.specific_name = a.name
   Where a.type      = 'P'
--    And   a.name not in ('sp_alterdiagram','sp_creatediagram','sp_dropdiagram','sp_helpdiagramdefinition','sp_helpdiagrams','sp_renamediagram','sp_upgraddiagrams')
   Order by a.name, b.ORDINAL_POSITION

   If @PsProc Is Not Null
      Begin
         Delete #Tempsps
         Where  Procedimiento Not Like Concat('%', @PsProc, '%');
      End

   Update #tempSps
   Set    Procedimiento = ''
   Where  Parametro_Orden > 1

   Select Procedimiento,               Parametro_Orden,
          Nombre_Parametro,                                                       Tipo_Dato,
          Case When IsNull(Cast(Longitud_Caracter As Varchar),'') = '-1'
               Then 'Max'
               Else IsNull(Cast(Longitud_Caracter As Varchar),'')
          End As Longitud_Caracter,
          IsNull(Cast(Precision_Numerica As Varchar),'') Precision_Numerica,      IsNull(Cast(Escala As Varchar),'') Escala,
          IsNull(Cast(Collation As Varchar),'')          Collation,
          IsNull(Cast( Set_Caracteres As Varchar),'')    Set_Caracteres,          Tipo_Parametro
   From #tempSps;

   Return
End]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsProc" type="nvarchar"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spc_catCaracterEspecTbl" type="PROCEDURE">
         <comment><![CDATA[Procedimiento de Consulta los datos de La tabla de Caracteres Especiales.]]></comment>
         <definition language="SQL"><![CDATA[/*
Declare
   @PsCaracter       Char(1)         = Null,
   @PnChrAscii       Smallint        = Null,
   @PnEstatus        Integer         = 0,
   @PsMensaje        Varchar(  250)  = ' ';
Begin
   Execute dbo.Spc_catCaracterEspecTbl @PsCaracter      = @PsCaracter,
                                       @PnChrAscii      = @PnChrAscii,
                                       @PnEstatus       = @PnEstatus      Output,
                                       @PsMensaje       = @PsMensaje      Output;

   If @PnEstatus != 0
      Begin
         Select @PnEstatus, @PsMensaje
      End

   Return

End
Go
*/

Create   Procedure dbo.Spc_catCaracterEspecTbl
  (@PsCaracter       Char(1)         = Null,
   @PnChrAscii       Smallint        = Null,
   @PnEstatus        Integer         = 0   Output,
   @PsMensaje        Varchar(  250)  = ' ' Output)
As
Declare
   @w_desc_error        Varchar( 250),
   @w_Error             Integer,
   @w_sql               Varchar(Max),
   @w_primero           Bit,
   @w_registros         Integer,
   @w_comilla           Char(1)

Begin
/*
Objetivo: Consulta los datos de La tabla de Caracteres Especiales.
Versión:  1
*/

   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    On
   Set Ansi_Warnings On
   Set Ansi_Padding  On
   
   Select @PnEstatus  = 0,
          @PsMensaje  = ' ',
          @w_primero  = 0,
          @w_comilla  = Char(39)

    Set @w_sql = 'Select a.caracter,                         a.chrAscii
                  From dbo.catCaracterEspecTbl a ' 

   If @PsCaracter Is Not Null
      Begin
         If @w_primero = 0
            Begin
               Select @w_primero = 1,
                      @w_sql = @w_sql + ' Where '
            End
         Else
            Begin
               Set @w_sql = @w_sql + ' And '
            End

         Set @w_sql = @w_sql + ' a.caracter Like ' + @w_comilla + '%' + @PsCaracter + '%' + @w_comilla
      End

   If @PnChrAscii Is Not Null
      Begin
         If @w_primero = 0
            Begin
               Select @w_primero = 1,
                      @w_sql = @w_sql + ' Where '
            End
         Else
            Begin
               Set @w_sql = @w_sql + ' And '
            End

         Set @w_sql = @w_sql + ' a.chrAscii = ' + Cast(@PnChrAscii As Varchar)
      End
      
      
   Begin Try
      Execute (@w_sql)
      Set @w_registros = @@Rowcount
   End Try

   Begin Catch
      Select  @w_Error      = @@Error,
              @w_desc_error = Substring (Error_Message(), 1, 230)
   End   Catch

   If Isnull(@w_Error, 0) <> 0
      Begin
         Select @PnEstatus = @w_Error,
                @PsMensaje = 'Error.: ' + Rtrim(Ltrim(Cast(@w_Error As Varchar))) + ' ' + @w_desc_error
         Set Xact_Abort Off
         Return
      End

   If @w_registros = 0
      Begin
         Select @PnEstatus = 4, 
                @PsMensaje = dbo.Fn_Busca_MensajeError(@PnEstatus)
         Set Xact_Abort Off
         Return      
      End 

   Set Xact_Abort Off
   Return

End]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsCaracter" type="char"/>
            <parameter mode="IN" name="@PnChrAscii" type="smallint"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spc_catCriteriosTbl" type="PROCEDURE">
         <comment><![CDATA[Procedimiento que Consulta la tabla de Criterios Valores.]]></comment>
         <definition language="SQL"><![CDATA[/*
Declare
   @PsCriterio                Char   (  25) = Null,
   @PnValor                   Smallint      = Null,
   @PsDescripcion             Varchar(  60) = Null,
   @PsValorAdicional          Varchar( 250) = Null,
   @PnEstatus                 Integer       = 0,
   @PsMensaje                 Varchar( 250) = ' ';

Begin
   Execute dbo.Spc_catCriteriosTbl  @PsCriterio       = @PsCriterio,
                                    @PnValor          = @PnValor,
                                    @PsDescripcion    = @PsDescripcion,
                                    @PsValorAdicional = @PsValorAdicional,
                                    @PnEstatus        = @PnEstatus Output,
                                    @PsMensaje        = @PsMensaje Output;
   If @PnEstatus != 0
      Begin
         Select @PnEstatus, @PsDescripcion
      End

   Return
End
Go

*/

Create   Procedure dbo.Spc_catCriteriosTbl  
  (@PsCriterio                Char   (  25) = Null,
   @PnValor                   Smallint      = Null,
   @PsDescripcion             Varchar(  60) = Null,
   @PsValorAdicional          Varchar( 250) = Null,
   @PnEstatus                 Integer       = 0   Output,
   @PsMensaje                 Varchar( 250) = ' ' Output)  
  
As
Declare
    @w_sql               Varchar(Max),
    @w_desc_error        Varchar( 250),
    @w_Error             Integer,
    @w_primero           Bit,
    @w_comilla           Char(1)

Begin
/*
Objetivo: Consulta la tabla de criterios.
Versión:  1
*/
   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    On
   Set Ansi_Warnings On
   Set Ansi_Padding  On
   
   Select @PnEstatus  = 0,
          @PsMensaje  = Null,
          @w_primero  = 0,
          @w_comilla  = Char(39)

   Set @w_sql = 'Select criterio, valor, descripcion, valorAdicional
                 From   dbo.catCriteriosTbl a
                 Where  1 = 1'

   If Isnull(Rtrim(Ltrim(@PsCriterio)), ' ') != ' '
      Begin
         Set @w_sql     = @w_sql + ' And  criterio Like ' + @w_comilla + '%' + Rtrim(Ltrim(@PsCriterio)) + '%' + @w_comilla
      End

   If @PnValor Is Not Null
      Begin
         Set @w_sql = @w_sql + ' And valor = ' + Cast(@PnValor As Varchar)
      End

   If Isnull(Rtrim(Ltrim(@PsDescripcion)), ' ') != ' ' 
      Begin
         Set @w_sql = @w_sql + ' And descripcion like ' + @w_comilla + '%' + @PsDescripcion + '%' + @w_comilla
      End

   If @PsValorAdicional Is Not Null
      Begin
         Set @w_sql = @w_sql + ' And valorAdicional like ' + @w_comilla + '%' + @PsDescripcion + '%' + @w_comilla
      End

   Set @w_sql = @w_sql + ' Order By a.descripcion'

   Begin Try
      Execute (@w_sql)
   End Try

   Begin Catch
      Select  @w_Error      = @@Error,
              @w_desc_error = Substring (Error_Message(), 1, 230)
   End   Catch

   If Isnull(@w_Error, 0) <> 0
      Begin
         Select @PnEstatus = @w_Error,
                @PsMensaje = 'Error.: ' + Rtrim(Ltrim(Cast(@w_Error As Varchar))) + ' ' + @w_desc_error
         Set Xact_Abort Off
         Return
      End

   Set Xact_Abort Off
   Return
End]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsCriterio" type="char"/>
            <parameter mode="IN" name="@PnValor" type="smallint"/>
            <parameter mode="IN" name="@PsDescripcion" type="varchar"/>
            <parameter mode="IN" name="@PsValorAdicional" type="varchar"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spc_catGeneralesTbl" type="PROCEDURE">
         <comment><![CDATA[Procedimiento que lista los Valores de lla Tabla de Catalogos Generales.]]></comment>
         <definition language="SQL"><![CDATA[/*

Procedimiento que lista los valores de la tabla de Catalogos Generales.

Declare
   @PsTabla              Varchar(  90)   = Null,  
   @PsColumna            Varchar(  90)   = Null,  
   @PnValor              Smallint        = Null,  
   @PsDescripcion        Varchar(  60)   = Null,
   @PnEstatus            Integer         = 0,   
   @PsMensaje            Varchar( 250)   = ' '

Begin
   Execute  dbo.Spc_catGeneralesTbl @PsTabla        = @PsTabla,
                                    @PsColumna      = @PsColumna,
                                    @PnValor        = @PnValor,
                                    @PsDescripcion  = @PsDescripcion,
                                    @PnEstatus      = @PnEstatus Output,
                                    @PsMensaje      = @PsMensaje Output

   If @PnEstatus != 0
      Begin
         Select @PnEstatus, @PsMensaje
      End

   Return

End
Go

*/

Create   Procedure dbo.Spc_catGeneralesTbl
   (@PsTabla                   Sysname       = Null,  
    @PsColumna                 Sysname       = Null,  
    @PnValor                   Smallint      = Null,  
    @PsDescripcion             Varchar(  60) = Null,  
    @PnEstatus                 Integer       = 0   Output,  
    @PsMensaje                 Varchar( 250) = ' ' Output)    
  
As  
Declare  
    @w_sql               Varchar(Max),  
    @w_desc_error        Varchar( 250),  
    @w_Error             Integer,  
    @w_primero           Bit,  
    @w_comilla           Char(1)  
  
Begin
/*
Objetivo: Listar los valores de la tabla de Catalogos Generales.
Verión:   1
*/

   Set Nocount       On  
   Set Xact_Abort    On  
   Set Ansi_Nulls    On  
   Set Ansi_Warnings On  
   Set Ansi_Padding  On  
     
   Select @PnEstatus  = 0,  
          @PsMensaje  = Null,  
          @w_primero  = 0,  
          @w_comilla  = Char(39)  
  
   Set @w_sql = 'Select tabla, columna, valor, descripcion
                 From   dbo.catGeneralesTbl 
                 Where  1 = 1'  
  
   If Isnull(Rtrim(Ltrim(@PsTabla)), ' ') != ' '  
      Begin  
         Set @w_sql     = @w_sql + ' And Tabla Like ' + @w_comilla + '%' + @PsTabla + '%' + @w_comilla  
      End  
  
   If Isnull(Rtrim(Ltrim(@PsColumna)), ' ') != ' '  
      Begin  
         Set @w_sql = @w_sql + ' And  Columna Like ' + @w_comilla + '%' + @PsColumna + '%' + @w_comilla  
      End  
  
   If Isnull(@PnValor, -1) != -1  
      Begin  
         Set @w_sql = @w_sql + ' And Valor = ' + Cast(@PnValor As Varchar)  
      End  
  
   If Isnull(Rtrim(Ltrim(@PsDescripcion)), ' ') != ' '  
      Begin  
         Set @w_sql = @w_sql + ' And Descripcion Like ' + @w_comilla + '%' + @PsDescripcion + '%' + @w_comilla  
      End  
  
   Set @w_sql = @w_sql + ' Order by Descripcion '  
  
   Begin Try  

   PRINT @w_sql

      Execute (@w_sql)  
   End Try  
  
   Begin Catch  
      Select  @w_Error      = @@Error,  
              @w_desc_error = Substring (Error_Message(), 1, 230)  
   End   Catch  
  
   If Isnull(@w_Error, 0) <> 0  
      Begin  
         Select @PnEstatus = @w_Error,  
                @PsMensaje = 'Error.: ' + Rtrim(Ltrim(Cast(@w_Error As Varchar))) + ' ' + @w_desc_error  
         Set Xact_Abort Off  
         Return  
      End  
  
   Set Xact_Abort Off  
   Return  
End]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsTabla" type="nvarchar"/>
            <parameter mode="IN" name="@PsColumna" type="nvarchar"/>
            <parameter mode="IN" name="@PnValor" type="smallint"/>
            <parameter mode="IN" name="@PsDescripcion" type="varchar"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spc_catMensajesErroresTbl" type="PROCEDURE">
         <comment><![CDATA[Procedimiento que Consulta la tabla de Catálogos de Errores.]]></comment>
         <definition language="SQL"><![CDATA[/*

Procedimiento que lista los valores de la tabla de Catalogos Generales.

Declare
   @PnIdError            Varchar(  90)   = Null,
   @PsMensaje            Varchar( 250)   = Null,
   @PnIdUsuarioAct       Integer         = 1,
   @PdFechaAct           Date            = Null,
   @PsIpAct              Varchar(30)     = Null,
   @PsMacAddressAct      Varchar(30)     = Null,
   @PnEstatus            Integer         = 0,
   @PsMensajeR           Varchar( 250)   = ' '

Begin
   Execute  dbo.Spc_catMensajesErroresTbl @PnIdError       = @PnIdError,
                                          @PsMensaje       = @PsMensaje,
                                          @PnIdUsuarioAct  = @PnIdUsuarioAct,
                                          @PdFechaAct      = @PdFechaAct,
                                          @PsIpAct         = @PsIpAct,
                                          @PsMacAddressAct = @PsMacAddressAct,
                                          @PnEstatus       = @PnEstatus Output,
                                          @PsMensajeR      = @PsMensajeR Output

   If @PnEstatus != 0
      Begin
         Select @PnEstatus, @PsMensajeR
      End

   Return

End
Go

*/

Create   Procedure dbo.Spc_catMensajesErroresTbl
    (@PnIdError       Smallint      = Null,
     @PsMensaje       Varchar( 250) = Null,
     @PnIdUsuarioAct  Integer,
     @PdFechaAct      Date          = Null,
     @PsIpAct         Varchar(30)   = Null,
     @PsMacAddressAct Varchar(30)   = Null,
     @PnEstatus       Integer       = 0   Output,
     @PsMensajeR      Varchar( 250) = ' ' Output)
As
Declare
    @w_sql               Varchar(Max),
    @w_desc_error        Varchar( 250),
    @w_Error             Integer,
    @w_primero           Bit,
    @w_comilla           Char(1),
    @w_registros         Integer

Begin
/*
Objetivo: Consulta el Catálogo de Errores.
Version:  1
*/

   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    On
   Set Ansi_Warnings On
   Set Ansi_Padding  On

   Select @PnEstatus   = 0,
          @PsMensajeR  = Null,
          @w_primero   = 0,
          @w_comilla   = Char(39)


--

   Set @PnEstatus = dbo.Fn_ValidaUsuario(@PnIdUsuarioAct)

   If @PnEstatus <> 0
      Begin
         Set @PsMensajeR =  dbo.Fn_Busca_MensajeError(@PnEstatus)

         Set Xact_Abort Off
         Return
      End
--

   Set @w_sql = 'Select a.idError,   a.mensaje,  a.idUsuarioAct,   b.nombre usuario,
                        a.fechaAct,   a.ipAct,    a.macAddressAct
                From    dbo.catMensajesErroresTbl a
                Join    dbo.segUsuariosTbl b
                On      b.idUsuario = a.idUsuarioAct
                Where   1 = 1 '

   If @PnIdError Is Not Null
      Begin
         Set @w_sql = @w_sql + ' And a.idError = ' + Cast(@PnIdError As Varchar)
      End

   If @PsMensaje Is Not Null
      Begin
         Set @w_sql = @w_sql + ' And a.mensaje Like ' + @w_comilla + '%' + @PsMensaje + '%' + @w_comilla
      End

   If @PdFechaAct Is Not Null
      Begin
         Set @w_sql = @w_sql + ' And Cast(a.fechaAct As Date) = ' + @w_comilla + Cast(@PdFechaAct As Varchar) + @w_comilla

      End

   If @PsIpAct Is Not Null
      Begin

         Set @w_sql = @w_sql + ' And a.ipAct Like ' + @w_comilla + '%' + @PsipAct + '%' + @w_comilla

      End

   If @PsMacAddressAct Is Not Null
      Begin
         Set @w_sql = @w_sql + ' And a.macAddressAct Like ' + @w_comilla + '%' + @PsMacAddressAct + '%' + @w_comilla

      End

   Set  @w_sql = @w_sql + ' Order by 1'

   Begin Try
      Execute (@w_sql)
      Set  @w_registros = @@Rowcount
   End Try

   Begin Catch
      Select  @w_Error      = @@Error,
              @w_desc_error = Substring (Error_Message(), 1, 230)
   End   Catch

   If Isnull(@w_Error, 0) <> 0
      Begin
         Select @PnEstatus  = @w_Error,
                @PsMensajeR = 'Error.: ']]></definition>
         <parameters>
            <parameter mode="IN" name="@PnIdError" type="smallint"/>
            <parameter mode="IN" name="@PsMensaje" type="varchar"/>
            <parameter mode="IN" name="@PnIdUsuarioAct" type="int"/>
            <parameter mode="IN" name="@PdFechaAct" type="date"/>
            <parameter mode="IN" name="@PsIpAct" type="varchar"/>
            <parameter mode="IN" name="@PsMacAddressAct" type="varchar"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensajeR" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spc_conParametrosGralesTbl" type="PROCEDURE">
         <comment><![CDATA[Procedimiento que Consulta la tabla de Catálogos de Parámetros Generales.]]></comment>
         <definition language="SQL"><![CDATA[/*

Procedimiento que lista los valores de la tabla de Catalogos Parámetros Generales.

Declare
   @PnIdParametroGral    Smallint         = Null,
   @PsDescripcion        Varchar( 250)    = Null,
   @PnParametroNumber    Integer          = Null,
   @PsParametroChar      Varchar(  120)   = Null,
   @PdParametroFecha     Date             = Null,
   @PnIdUsuarioAct       Integer          = 1,
   @PdFechaAct           Date             = Null,
   @PsIpAct              Varchar(30)      = Null,
   @PsMacAddressAct      Varchar(30)      = Null,
   @PnEstatus            Integer          = 0,
   @PsMensaje            Varchar( 250)    = Null;

Begin
   Execute  dbo.Spc_conParametrosGralesTbl @PnIdParametroGral  = @PnIdParametroGral,
                                           @PsDescripcion      = @PsDescripcion,
                                           @PnParametroNumber  = @PnParametroNumber,
                                           @PsParametroChar    = @PsParametroChar,
                                           @PdParametroFecha   = @PdParametroFecha,
                                           @PnIdUsuarioAct     = @PnIdUsuarioAct,
                                           @PdFechaAct         = @PdFechaAct,
                                           @PsIpAct            = @PsIpAct,
                                           @PsMacAddressAct    = @PsMacAddressAct,
                                           @PnEstatus          = @PnEstatus Output,
                                           @PsMensaje          = @PsMensaje Output;

   If @PnEstatus != 0
      Begin
         Select @PnEstatus, @PsMensaje
      End

   Return

End
Go

*/

Create   Procedure dbo.Spc_conParametrosGralesTbl
  (@PnIdParametroGral        Smallint         = Null,
   @PsDescripcion            Varchar(  100)   = Null,
   @PnParametroNumber        Integer          = Null,
   @PsParametroChar          Varchar( 1000)   = Null,
   @PdParametroFecha         Date             = Null,
   @PnIdUsuarioAct           Integer,
   @PdFechaAct               Date             = Null,
   @PsIpAct                  Varchar(   30)   = Null,
   @PsMacAddressAct          Varchar(   30)   = Null,
   @PnEstatus                Integer          = 0    Output,
   @PsMensaje                Varchar(  250)   = ' '  Output)
As

Declare
   @w_desc_error          Varchar( 250),
   @w_Error               Integer,
   @w_sql                 Varchar(Max),
   @w_comilla             Char(1),
   @w_primero             Bit,
   @w_idEstatus           Bit,
   @w_idTipoUsuario       Bit,
   @w_registros           Integer;

Begin
/*
Objetivo: lista los valores de la tabla de Catalogos Parámetros Generales.'
Versión:  1
*/


   Set Quoted_identifier Off
   Set Nocount            On
   Set Xact_Abort         On
   Set Ansi_Nulls         On
   Set Ansi_Warnings      On
   Set Ansi_Padding       On

   Select @PnEstatus      = 0,
          @PsMensaje      = Null,
          @w_comilla      = Char(39),
          @w_primero      = 0

   Select @PnEstatus = dbo.Fn_ValidaUsuarioAdmin(@PnIdUsuarioAct)
   If @PnEstatus != 0
      Begin
         Set @PsMensaje = Dbo.Fn_Busca_MensajeError(@PnEstatus)

         Set Xact_Abort Off
         Return
      End

   Set @w_sql = 'Select a.idParametroGral,  a.descripcion,  a.parametroNumber, a.parametroChar,
                        a.parametroFecha,   a.idUsuarioAct, b.nombre usuario,
                        a.fechaAct,         a.ipAct,        a.macAddressAct
                 From   dbo.conParametrosGralesTbl a
                 Join   dbo.segUsuariosTbl b
                 On     b.idUsuario = a.idUsuarioAct
                 Where  1 = 1'

   If @PnIdParametroGral Is Not Null
      Begin
         Set @w_sql     = @w_sql + ' And a.idParametroGral = ' + Cast(@PnIdParametroGral As Varchar)
      End

   If @PsDescripcion Is Not Null
      Begin
         Set @w_sql = @w_sql]]></definition>
         <parameters>
            <parameter mode="IN" name="@PnIdParametroGral" type="smallint"/>
            <parameter mode="IN" name="@PsDescripcion" type="varchar"/>
            <parameter mode="IN" name="@PnParametroNumber" type="int"/>
            <parameter mode="IN" name="@PsParametroChar" type="varchar"/>
            <parameter mode="IN" name="@PdParametroFecha" type="date"/>
            <parameter mode="IN" name="@PnIdUsuarioAct" type="int"/>
            <parameter mode="IN" name="@PdFechaAct" type="date"/>
            <parameter mode="IN" name="@PsIpAct" type="varchar"/>
            <parameter mode="IN" name="@PsMacAddressAct" type="varchar"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spc_conProcesosTbl" type="PROCEDURE">
         <comment/>
         <definition language="SQL"><![CDATA[Create Procedure [dbo].[Spc_conProcesosTbl]
  (@PnIdEstatus           Tinyint      = Null,
   @PnIdUsuarioAct        Smallint,
   @PnEstatus             Integer      = 0     Output,   
   @PsMensaje             Varchar(250) = Null  Output)
As

Declare
   @w_desc_error                   Varchar( 250),
   @w_Error                        Integer
  

Begin
   Set Nocount       On  
   Set Xact_Abort    On  
   Set Ansi_Nulls    On  
   Set Ansi_Warnings On  
   Set Ansi_Padding  On  
     
   Select @PnEstatus        = dbo.Fn_ValidaUsuario(@PnIdUsuarioAct),  
          @PsMensaje        = Null

   If @PnEstatus != 0
      Begin
         Set  @PsMensaje =  Dbo.Fn_Busca_MensajeError(@PnEstatus)  

         Set Xact_Abort Off  
         Return  
      End

   Begin Try
      Select a.idProceso,          a.idMotivoCorreo,    b.descripcion     motivoCorreo,
             a.idTipoNotificacion, d.descripcion        tipoNotificacion, parametros,
             Convert(Char(10), fechaProgramada, 103)    diaProceso,
             Substring(Cast(Convert(Time, fechaProgramada) As Varchar), 1, 8) horaProceso,
             fechaInicio,      fechaTermino,            tiempoProceso,    registrosProcesados,
             urlArchivoSalida, mensajeProc,             tablaSalida,      idSession,
             a.idEstatus,      c.descripcion
      From   conProcesosTbl a
      Join   conMotivosCorreoTbl b
      On     b.idMotivo = a.idMotivoCorreo
      Join   catGeneralesTbl c
      On     c.tabla     = 'conProcesosTbl'
      And    c.columna   = 'idEstatus'
      And    c.valor     = a.idEstatus
      Join   catCriteriosTbl d
      On     d.criterio  = 'idTipoNotificacion'
      And    d.valor     = idTipoNotificacion
      Where  a.idEstatus = Case When @PnIdEstatus Is Null
                                Then a.idEstatus
                                Else @PnIdEstatus
                           End
      Order  By 1

   End Try

   Begin Catch
      Select  @w_Error      = @@Error,
              @w_desc_error = Substring (Error_Message(), 1, 230)
   End   Catch

   If Isnull(@w_Error, 0) <> 0
      Begin
         Select @PnEstatus = @w_Error,
                @PsMensaje = 'Error.: ' + Rtrim(Ltrim(Cast(@w_Error As Varchar))) + ' ' + @w_desc_error
         Set Xact_Abort Off
         Return
      End

   Set Xact_Abort Off  
   Return  
End]]></definition>
         <parameters>
            <parameter mode="IN" name="@PnIdEstatus" type="tinyint"/>
            <parameter mode="IN" name="@PnIdUsuarioAct" type="smallint"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spc_lista_dim_tablas" type="PROCEDURE">
         <comment><![CDATA[Procedimiento que Consulta el detalle de las tablas declaradas en la base de datos.]]></comment>
         <definition language="SQL"><![CDATA[/*
Declare
   @PsTabla      Varchar( 60) = Null,
   @PnFilas      Integer      = 0,
   @PnEstatus    Integer      = 0,
   @PsMensaje    Varchar(250) = ' ';
Begin
   Execute dbo.Spc_lista_dim_tablas @PsTabla   = @PsTabla,
                                    @PnFilas   = @PnFilas,
                                    @PnEstatus = @PnEstatus Output,
                                    @PsMensaje = @PsMensaje Output;

   If @PnEstatus != 0
      Begin
         Select @PnEstatus, @PsMensaje;
      End

   Return

End
*/

Create   Procedure dbo.Spc_lista_dim_tablas
  (@PsTabla             Sysname        = Null,
   @PnFilas             Integer        = 0,
   @PnEstatus           Integer        = 0    Output,
   @PsMensaje           Varchar(250)   = ' '  Output)
As

Declare
   @w_Error                  Integer,
   @w_operacion              Integer,
   @w_desc_error             Varchar ( 250),
   @w_tabla                  Sysname,
   @w_id                     Integer,
   @w_pages                  Integer,
   @w_sql                    Varchar(Max),
   @w_comilla                Char(1),
   @w_linea                  Integer;

Begin
   Set Quoted_identifier Off
   Set Nocount            On
   Set Xact_Abort         On
   Set Ansi_Nulls         Off
   Set Ansi_Warnings      On
   Set Ansi_Padding       On

   Select @PnEstatus    = 0,
          @PsMensaje    = Null,
          @w_operacion  = 9999,
          @w_comilla    = Char(39)

   Set @w_sql = 'Declare '                                    +
                    'C_tablas Cursor Fast_Forward For '       +
                    'Select Name, id '                        +
                    'From   sysobjects a '                    +
                    'Where  Uid        = 1 '                  +
                    'And    Type       = ' + @w_comilla + 'U' + @w_comilla

   If @PsTabla Is Not Null
      Begin
         Set @w_sql = @w_sql + ' And    Name = ' + @w_comilla + @PsTabla + @w_comilla

      End

   Set @w_sql = @w_sql + ' Order by 1'

   Begin Try
      Execute (@w_sql)
   End Try

   Begin Catch
      Select  @w_Error      = @@Error,
              @w_desc_error = Substring (Error_Message(), 1, 230)
   End   Catch

   If Isnull(@w_Error, 0) <> 0
      Begin
         Select @PnEstatus = @w_error,
                @PsMensaje = 'Error.: ' + dbo.Fn_Busca_MensajeError(@PnEstatus)

         Set Xact_Abort Off
         Return
      End

   Begin Try
      Create Table #TempDimTablas
     (Filas          Integer         Null ,
      Reservado      numeric (18, 0) Null ,
      Usado_Data     numeric (18, 0) Null ,
      Usado_Index    numeric (18, 0) Null ,
      Sin_Uso        numeric (18, 0) Null)
   End Try

   Begin Catch
      Select  @w_Error      = @@Error,
              @w_desc_error = Substring (Error_Message(), 1, 230)
   End   Catch

   If Isnull(@w_Error, 0) <> 0
      Begin
         Select @PnEstatus = @w_error,
                @PsMensaje = 'Error.: ' + dbo.Fn_Busca_MensajeError(@PnEstatus)

         Set Xact_Abort Off
         Return
      End

   Begin Try
      Create Table #TempDimensionamientoTablas
     (Tabla          Sysname         Not Null,
      Filas          Integer             Null ,
      Reservado      numeric (18, 0)     Null ,
      Usado_Data     numeric (18, 0)     Null ,
      Usado_Index    numeric (18, 0)     Null ,
      Sin_Uso        numeric (18, 0)     Null)
   End Try

   Begin Catch
      Select  @w_Error      = @@Error,
              @w_desc_error = Substring (Error_Message(), 1, 230)
   End   Catch

   If Isnull(@w_Error, 0) <> 0
      Begin
         Select @PnEstatus = @w_error,
                @PsMensaje = 'Error.: ' + dbo.Fn_Busca_MensajeError(@PnEstatus)

         Set Xact_Abort Off
         Return
      End

   Open  C_tablas
   While @@fetch_Status < 1
   Begin
      Fetch C_tablas Into @w_tabla, @w_id]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsTabla" type="nvarchar"/>
            <parameter mode="IN" name="@PnFilas" type="int"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spc_validaTabla" type="PROCEDURE">
         <comment><![CDATA[Procedimiento que Valida la Existencia de una Tabla en la Base de Datos en el esquema dbo.]]></comment>
         <definition language="SQL"><![CDATA[/*
  Procedimiento de Consulta que nos valida si existe una tabla 

Declare
   @PsNombreTabla            Sysname        = 'catgeneralestbl',
   @PnIdUsuarioAct           Smallint       = 1,
   @PnEstatus                Integer        = 0,  
   @PsMensaje                Varchar( 250)  = ' '
   

Begin
   Execute Spc_validaTabla  @PsNombreTabla  =  @PsNombreTabla     ,
                            @PnIdUsuarioAct =  @PnIdUsuarioAct    ,
                            @PnEstatus      =  @PnEstatus  Output ,   
                            @PsMensaje      =  @PsMensaje  Output    
   
   If @PnEstatus > 0
      Begin
         Select @PnEstatus, @PsMensaje
      End

End
Go
*/

Create   Procedure [dbo].[Spc_validaTabla]
  (@PsNombreTabla            Sysname,
   @PnIdUsuarioAct           Integer,
   @PnEstatus                Integer        = 0   Output,
   @PsMensaje                Varchar( 250)  = ' ' Output)  
As

Declare
   @w_desc_error              Varchar( 250),
   @w_Error                   Integer,
   @w_idEstatus               Tinyint,
   @w_sql                     Varchar(Max),
   @w_comilla                 Char(1)

Begin
/*
Objetivo: Validar la Existencia de una Tabla en la Base de Datos en el esquema dbo.
Versión: 1

*/
   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    Off
   Set Ansi_Warnings On
   Set Ansi_Padding  On
   
   Select @PnEstatus       = 0,
          @PsMensaje       = ' ',
          @w_comilla       = Char(39)

   Select @PnEstatus = dbo.Fn_ValidaUsuario(@PnIdUsuarioAct)
   If @PnEstatus != 0
      Begin
         Set @PsMensaje = Dbo.Fn_Busca_MensajeError(@PnEstatus)

         Set Xact_Abort Off
         Return
      End

   Set @w_sql = 'Select Count(1) existe '                                         +
                'From   Sysobjects '                                              +
                'Where  Uid  = 1 '                                                +
                'And    Type = ' + @w_comilla + 'U'            + @w_comilla + ' ' +
                'And    Name = ' + @w_comilla + @PsNombreTabla + @w_comilla
                
   Begin Try
      Execute (@w_sql)
   End   Try
    
   Begin Catch
      Select  @w_Error      = @@Error,
              @w_desc_error = Substring (Error_Message(), 1, 230)
   End   Catch

   If Isnull(@w_Error, 0) <> 0
      Begin
         Select @PnEstatus = @w_Error,
                @PsMensaje = 'Error.: ' + Rtrim(Ltrim(Cast(@w_Error As Varchar(10)))) + ' ' + @w_desc_error

         Set Xact_Abort    Off
         Return

      End

   Set Xact_Abort Off
   Return

End]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsNombreTabla" type="nvarchar"/>
            <parameter mode="IN" name="@PnIdUsuarioAct" type="int"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spc_valida_longitud" type="PROCEDURE">
         <comment><![CDATA[Procedimiento que consulta la longitud de los campos de una tabla específica.]]></comment>
         <definition language="SQL"><![CDATA[Create   Procedure dbo.Spc_valida_longitud
   (@PsTabla             Sysname,
    @PsColumna           Sysname,
    @PbAplica            Bit          = 0    Output,
    @PsTipoCampo         Varchar(250) = ' '  Output,
    @PnLogitud           Smallint     = ' '  Output,
    @PnDecimales         Smallint     = 0    Output,
    @PsRequerido         Char(2)      = 'No' Output,
    @PnEstatus           Integer      = 0    Output,
    @PsMensaje           Varchar(250) = ' '  Output)

As

Declare
    @w_longitud          Integer = 0,
    @w_system_type_id    Integer,
    @w_scale             Tinyint,
    @w_desc_error        Varchar( 250),
    @w_Error             Integer,
    @w_Precision         Smallint

Begin
   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    On
   Set Ansi_Warnings On
   Set Ansi_Padding  On

   Select @PnEstatus  = 0,
          @PsMensaje  = Null;

   Begin Try
      Select @w_system_type_id = a.system_type_id,
             @w_longitud       = a.max_length,
             @w_Precision      = a.precision,
             @w_scale          = a.scale,
             @PsTipoCampo      = Cast(b.name As Varchar(250)),
             @PsRequerido      = Case When a.Is_nullable = 0
                                      Then 'Si'
                                      Else 'No'
                                 End
      From   sys.columns a
      Join   sys.types b on b.system_type_id = a.system_type_id
      Where  a.name   = @PsColumna
      And    Exists   ( Select Top 1 1
                        From   sys.tables c
                        Where  c.object_id = a.object_id
                        And    c.name      = @PsTabla)
   End Try

   Begin Catch
      Select  @w_Error      = @@Error,
              @w_desc_error = Substring (Error_Message(), 1, 230)
   End   Catch

   If Isnull(@w_Error, 0) <> 0
      Begin
         Select @PnEstatus = @w_Error,
                @PsMensaje = 'Error.: ' + Rtrim(Ltrim(Cast(@w_Error As Varchar))) + ' ' + @w_desc_error
         Set Xact_Abort Off
         Return
      End

   If @w_system_type_id not in (34, 35, 58, 59, 60, 61, 62, 104, 189)
      Begin
         Set @PbAplica = 1
         If @w_Precision = 0
            Begin
               Set @w_Precision = @w_longitud
            End

         Select @PnLogitud    = @w_Precision,
                @PnDecimales  = @w_scale
      End


   Set Xact_Abort Off
   Return
End]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsTabla" type="nvarchar"/>
            <parameter mode="IN" name="@PsColumna" type="nvarchar"/>
            <parameter mode="INOUT" name="@PbAplica" type="bit"/>
            <parameter mode="INOUT" name="@PsTipoCampo" type="varchar"/>
            <parameter mode="INOUT" name="@PnLogitud" type="smallint"/>
            <parameter mode="INOUT" name="@PnDecimales" type="smallint"/>
            <parameter mode="INOUT" name="@PsRequerido" type="char"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spd_catGeneralesTbl" type="PROCEDURE">
         <comment><![CDATA[Procedimiento que procesa la Baja de Registros en la tabla de catalogos generales.]]></comment>
         <definition language="SQL"><![CDATA[/*
  Procedimiento de Bajas de Registros en la tabla de catalogos generales.

Declare
   @PsTabla                  Sysname,
   @PsColumna                Sysname,
   @PnValor                  Integer,
   @PnIdUsuarioAct           Integer        = 1,
   @PnEstatus                Integer        = 0,  
   @PsMensaje                Varchar( 250)  = ' '
   

Begin
   Execute dbo.Spd_catGeneralesTbl  @PsTabla        = @PsTabla,
                                    @PsColumna      = @PsColumna,
                                    @PnValor        = @PnValor,
                                    @PnIdUsuarioAct = @PnIdUsuarioAct,
                                    @PnEstatus      = @PnEstatus  Output ,   
                                    @PsMensaje      = @PsMensaje  Output    
   
   If @PnEstatus > 0
      Begin
         Select @PnEstatus, @PsMensaje
      End

End
Go
*/

Create   Procedure dbo.Spd_catGeneralesTbl
   (@PsTabla                   Sysname,
    @PsColumna                 Sysname,
    @PnValor                   Integer,
    @PnIdUsuarioAct            Integer,
    @PnEstatus                 Integer       = 0   Output,
    @PsMensaje                 Varchar( 250) = ' ' Output)  

As
Declare
    @w_sql               Varchar(Max),
    @w_desc_error        Varchar( 250),
    @w_Error             Integer

Begin

/*
Objetivo: Procesar la Baja de Registros en la tabla de catalogos generales.
Versión:  1
*/

   Set Nocount       On
   Set Xact_Abort    Off
   Set Ansi_Nulls    On
   Set Ansi_Warnings On
   Set Ansi_Padding  On
   
   Select @PnEstatus  = dbo.Fn_ValidaUsuario(@PnIdUsuarioAct),
          @PsMensaje  = ''

   If @PnEstatus != 0
      Begin
         Set @PsMensaje = Dbo.Fn_Busca_MensajeError(@PnEstatus)

         Set Xact_Abort On
         Return
      End

   If Not Exists (Select Top 1 1
                  From   catGeneralesTbl
                  Where  tabla   = @PsTabla
                  And    columna = @PsColumna
                  And    valor   = @PnValor)
      Begin
         Select @PnEstatus = 3,
                @PsMensaje = dbo.Fn_Busca_MensajeError(@PnEstatus)

         Set Xact_Abort On
         Return
      End

   Begin Try
      Delete catGeneralesTbl
      Where  tabla   = @PsTabla
      And    columna = @PsColumna
      And    valor   = @PnValor
   End Try

   Begin Catch
      Select  @w_Error      = @@Error,
              @w_desc_error = Substring (Error_Message(), 1, 230)
   End   Catch

   If Isnull(@w_Error, 0) <> 0
      Begin
         Select @PnEstatus = @w_Error,
                @PsMensaje = 'Error.: ' + Rtrim(Ltrim(Cast(@w_Error As Varchar))) + ' ' + @w_desc_error
         Set Xact_Abort Off
         Return
      End

   Set Xact_Abort Off
   Return
End]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsTabla" type="nvarchar"/>
            <parameter mode="IN" name="@PsColumna" type="nvarchar"/>
            <parameter mode="IN" name="@PnValor" type="int"/>
            <parameter mode="IN" name="@PnIdUsuarioAct" type="int"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spd_conParametrosGralesTbl" type="PROCEDURE">
         <comment><![CDATA[Procedimiento que procesa la baja de registros de la tabla de Parámetros Generales..]]></comment>
         <definition language="SQL"><![CDATA[/*
  Procedimiento que procesa la baja de registros de la tabla de Parámetros Generales.

Declare
   @PnIdParametroGral        Smallint       = 88,
   @PnIdUsuarioAct           Integer        = 1,
   @PnEstatus                Integer        = 0,  
   @PsMensaje                Varchar( 250)  = ' '

Begin
   Execute dbo.Spd_conParametrosGralesTbl  @PnIdParametroGral  =  @PnIdParametroGral,
                                           @PnIdUsuarioAct     =  @PnIdUsuarioAct,
                                           @PnEstatus          =  @PnEstatus  Output,
                                           @PsMensaje          =  @PsMensaje  Output
   
   If @PnEstatus > 0
      Begin
         Select @PnEstatus, @PsMensaje
      End

End
Go
*/

Create   Procedure Spd_conParametrosGralesTbl
  (@PnIdParametroGral    Smallint,
   @PnIdUsuarioAct       Integer,
   @PnEstatus            Integer          = 0    Output,
   @PsMensaje            Varchar(  250)   = ' '  Output)
As

Declare
   @w_desc_error          Varchar( 250),
   @w_Error               Integer,
   @w_idEstatus           Bit,
   @w_idTipoUsuario       Bit

Begin
/*
Objetivo: Procesa la baja de registros de la tabla de Parámetros Generales.
Versión: 1

*/
   Set Nocount            On
   Set Xact_Abort         On
   Set Ansi_Nulls         Off
   Set Ansi_Warnings      On
   Set Ansi_Padding       On
   
   Select @PnEstatus      = dbo.Fn_ValidaUsuarioAdmin(@PnIdUsuarioAct),
          @PsMensaje      = Null

  If @PnEstatus != 0
      Begin
         Set @PsMensaje = Dbo.Fn_Busca_MensajeError(@PnEstatus)

         Set Xact_Abort Off
         Return
      End

   If Not Exists ( Select Top 1 1
                   From   conParametrosGralesTbl
                   Where  idParametroGral = @PnIdParametroGral)
      Begin
         Select @PnEstatus = 2026,
                @PsMensaje = Dbo.Fn_Busca_MensajeError(@PnEstatus)

         Set Xact_Abort Off
         Return
      End
   
 
   Begin Try
      Delete conParametrosGralesTbl
      Where  idParametroGral = @PnIdParametroGral
   End Try

   Begin Catch
      Select  @w_Error      = @@Error,
              @w_desc_error = Substring (Error_Message(), 1, 230)
   End   Catch
        
   If Isnull(@w_Error, 0) <> 0
      Begin
         Select @PnEstatus = @w_Error,
                @PsMensaje = Case When @PnEstatus = 547
                                  Then dbo.Fn_Busca_MensajeError(@PnEstatus)
                                  Else 'Error.: ' + Rtrim(Ltrim(Cast(@w_Error As Varchar))) + ' ' + @w_desc_error
                             End

         Set Xact_Abort Off
         Return
      End

   Set Xact_Abort Off
   Return

End]]></definition>
         <parameters>
            <parameter mode="IN" name="@PnIdParametroGral" type="smallint"/>
            <parameter mode="IN" name="@PnIdUsuarioAct" type="int"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spp_AnalisisJobsNoEjecutados" type="PROCEDURE">
         <comment><![CDATA[Procedimiento de Validación de Jobs No Ejecutados.]]></comment>
         <definition language="SQL"><![CDATA[/*
Declare
   @w_idProceso    Integer,
   @PnEstatus      Integer      = Null,
   @PsMensaje      Varchar(250) = Null;

Begin
   Select @w_idProceso = Max(idProceso)
   From   SCMBD.dbo.logAnalisisJobsTbl

   Execute dbo.Spp_AnalisisJobsNoEjecutados @PnEstatus = @PnEstatus Output,
                                            @PsMensaje = @PsMensaje Output;

   If @PnEstatus != 0
      Begin
         Select @PnEstatus, @PsMensaje
      End

   Select *
   From   SCMBD.dbo.logAnalisisJobsTbl
   Where  idProceso > Isnull(@w_idProceso, 0);

   Return
End
Go


*/

Create   Procedure dbo.Spp_AnalisisJobsNoEjecutados
  (@PnEstatus                  Integer      = Null Output,
   @PsMensaje                  Varchar(250) = Null Output)
As

Declare
   @w_error                    Integer,
   @w_fecha                    Integer,
   @w_registros                Integer,
   @w_linea                    Integer,
   @w_secuencia                Integer,
]]>&#22;<![CDATA[   @w_idGrupo                  Integer,
   @w_idMotivoCorreo           Integer,
   @w_idUsuarioAct             Integer,
   @w_idAplicacion             Integer,
   @w_idEstatus                Tinyint,
   @w_idTipoNotificacion       Tinyint,
   @w_idProceso                Integer,
   @w_fechaAct                 Datetime,
   @w_desc_error               Varchar( 220),
   @w_parametros               Varchar( Max),
   @w_usuario                  Varchar( Max),
   @w_mensaje                  Varchar( Max),
   @w_idSession                Varchar(  64),
   @w_proceso                  Varchar(  100),
   @w_ip                       Varchar(  30),
   @w_grupoCorreo              Varchar(  20),
   @w_sql                      NVarchar(1500),
   @w_param                    NVarchar( 750),
   @w_comilla                  Char(1),
   @w_account_name             Sysname,
   @w_basedatos                Sysname,
   @w_tablaLog                 Sysname,
   @w_servidor                 Sysname,
   @w_instancia                Sysname,
   @w_ambiente                 Sysname;

Begin

-- Objetivo:    Procedimiento de Validación de Jobs No Ejecutados.
-- Programador: Pedro Felipe Zambrano
-- Fecha:       06/05/2025

   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    On

--
-- Inicializamos Variables
--

   Select @PnEstatus            = 0,
          @PsMensaje            = '',
          @w_secuencia          = 0,
          @w_idMotivoCorreo     = 105,
          @w_comilla            = Char(39),
          @w_baseDatos          = Db_name(),
          @w_fechaAct           = Getdate(),
          @w_fecha              = Cast(Convert(Char(10), @w_fechaAct, 112) As Integer),
          @w_servidor           = @@ServerName,
          @w_instancia          = @@servicename,
          @w_idAplicacion       = 27,
          @w_ip                 = dbo.Fn_buscaDireccionIP();

   Select @w_ip = Replace(@w_ip, '(', ''),
          @w_ip = Replace(@w_ip, ')', '');

   If @w_servidor like '%'+ Char(92) + '%'
      Begin
         Set @w_servidor = dbo.Fn_splitStringColumna(@w_servidor, Char(92), 1)
      End

--
-- Creación de Tablas Temporales.
--

  Create Table #TempJobs
  ( secuencia          Integer          Not Null Identity(1, 1) Primary Key,
    instance_id        Integer              Null,
    job_id             Uniqueidentifier     Null,
    job_name           Sysname              Null,
    step_id            Integer              Null,
    step_name          Sysname              Null,
    sql_message_id     Integer              Null,
    sql_severity       Integer              Null,
    message            Nvarchar(4000)       Null,
    run_status         Integer              Null,
    run_date           Integer              Null,
    run_time           Integer              Null,
    run_duration       Integer              Null,
    operator_emailed   Sysname              Null,
    operator_netsent]]></definition>
         <parameters>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spp_AnalisisLinkServer" type="PROCEDURE">
         <comment><![CDATA[Proceso de Análisis y Validación de Link Server.]]></comment>
         <definition language="SQL"><![CDATA[/*
Declare
   @PnEstatus      Integer      = Null,
   @PsMensaje      Varchar(250) = Null;

Begin

   Execute dbo.Spp_AnalisisLinkServer @PnEstatus = @PnEstatus Output,
                                      @PsMensaje = @PsMensaje Output;

   If @PnEstatus != 0
      Begin
         Select @PnEstatus As Estatus, @PsMensaje As Mensaje
      End

   Return
End
Go

*/

Create   Procedure dbo.Spp_AnalisisLinkServer
  (@PnEstatus               Integer      = Null Output,
   @PsMensaje               Varchar(250) = Null Output)
As

Declare
   @w_DbLink                Sysname,
   @w_baseDatos             Sysname,
   @w_sql                   Nvarchar(1500),
   @w_param                 Nvarchar( 750),
   @w_error                 Integer,
   @w_desc_error            Varchar(  250),
   @w_registros             Integer,
   @w_insert                Integer,
   @w_minutosEspera         Integer,
   @w_salida                Integer,
   @w_idProceso             Integer,
   @w_secuencia             Integer,
   @w_idMotivoCorreo        Integer,
   @w_idUsuarioAct          Integer,
   @w_linea                 Integer,
   @w_tabla                 Sysname,
   @w_tablaLog              Sysname,
   @w_dbname                Sysname,
   @w_instancia             Sysname,
   @w_base                  Sysname,
   @w_objeto                Sysname,
   @w_periodicidad          Varchar(   60),
   @w_server                Varchar(  100),
   @w_usuario               Varchar(  Max),
   @w_idAplicacion          Smallint,
   @w_idTipoNotificacion    Tinyint,
   @w_grupoCorreo           Varchar(   20),
   @w_ambiente              Varchar(  250),
   @w_incidencia            Varchar(  850),
   @w_parametros            Varchar(  Max),
   @w_proceso               Varchar(  100),
   @w_ip                    Varchar(   30),
   @w_query                 Varchar( 1000),
   @w_fechaAct              Datetime,
   @w_idEstatus             Tinyint;

Begin
/*

Objetivo:    Análiza y Valida los Link Server.
Programador: Pedro Felipe Zambrano
Fecha:       05/05/2025


*/

   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    On

   Select @PnEstatus            = 0,
          @w_registros          = 0,
          @w_secuencia          = 0,
          @w_insert             = 0,
          @PsMensaje            = Null,
          @w_tabla              = 'sysobjects',
          @w_baseDatos          = 'tempdb',
          @w_server             = @@ServerName,
          @w_instancia          = @@servicename,
          @w_idMotivoCorreo     = 108,
          @w_idAplicacion       = 27,
          @w_tablaLog           = 'logAnalisisLSTbl',
          @w_fechaAct           = Getdate(),
          @w_dbname             = Db_name(),
          @w_ip                 = dbo.Fn_BuscaDireccionIP();

   Select @w_ip = Replace(@w_ip, '(', ''),
          @w_ip = Replace(@w_ip, ')', '');

   If @w_server like '%'+ Char(92) + '%'
      Begin
         Set @w_server = dbo.Fn_splitStringColumna(@w_server, Char(92), 1)
      End

--
-- Búsqueda de Parámetros.
--

   Select @w_ambiente = Upper(parametroChar)
   From   dbo.conParametrosGralesTbl
   Where  idParametroGral = 24
   If @@Rowcount = 0
      Begin
         Set @w_ambiente = ''
      End

   Select @w_usuario = parametroChar
   From   dbo.conParametrosGralesTbl
   Where  idParametroGral = 8

   Select @w_sql   = 'Select @o_usuario = dbo.Fn_Desencripta_cadena(' + @w_usuario + ') ',
          @w_param = '@o_usuario Varchar(Max) Output '

   Execute Sp_ExecuteSQL @w_sql, @w_param, @o_usuario = @w_usuario Output

   Set @w_idUsuarioAct = Cast(@w_usuario As Smallint)

   Select @w_minutosEspera = ParametroNumber
   From   dbo.conParametrosGralesTbl
   Where  idParametroGral = 15

   Select @w_grupoCorreo        = codigoGrupoCorreo,
          @w_idTipoNotificacion = idTipoNotificacion,
          @w_tablalOG           =]]></definition>
         <parameters>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spp_AnalisisObjetosNoValidos" type="PROCEDURE">
         <comment><![CDATA[Consulta y Reporta los Objetos no válidos de la BD Seleecionada.]]></comment>
         <definition language="SQL"><![CDATA[/*
Declare
   @PsDbName              Sysname      = 'SCMBD',
   @PnImprimeResultado    Bit          = 0,
   @PnEstatus             Integer      = 0,
   @PsMensaje             Varchar(250) = Null

Begin
   Execute dbo.Spp_AnalisisObjetosNoValidos @PsDbName           = @PsDbName,
                                            @PnImprimeResultado = @PnImprimeResultado,
                                            @PnEstatus          = @PnEstatus Output,
                                            @PsMensaje          = @PsMensaje Output


   If @PnEstatus != 0
      Begin
         Select @PnEstatus, @PsMensaje
      End

   Return

End
Go
*/

Create   Procedure dbo.Spp_AnalisisObjetosNoValidos
   @PsDbName              Sysname      = Null,
   @PnImprimeResultado    Bit          = 0,
   @PnEstatus             Integer      = 0    Output,
   @PsMensaje             Varchar(250) = Null Output
As

Declare
   @w_dbName                Sysname,
   @w_servidor              Sysname,
   @w_tabla                 Sysname,
   @w_instancia             Sysname,
   @w_comilla               Char(1),
   @w_sql                   NVarchar(1500),
   @w_param                 NVarchar( 750),
   @w_state_desc            Nvarchar( 120),
   @w_desc_error            Varchar ( 250),
   @w_ambiente              Varchar ( 250),
   @w_actividad             Varchar (  80),
   @w_grupoCorreo           Varchar (  20),
   @w_ipAct                 Varchar (  30),
   @w_proceso               Varchar ( 200),
   @w_parametros            Varchar (2000),
   @w_usuario               Varchar ( Max),
   @w_existe                Tinyint,
   @w_idMotivoCorreo        Integer,
   @w_idAplicacion          Integer,
   @w_error                 Integer,
   @w_linea                 Integer,
   @w_registros             Integer,
   @w_idTipoNotificacion    Integer,
   @w_idUsuarioAct          Integer,
   @w_idProceso             BigInt,
   @w_fechaAct              Datetime;

Begin
   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    Off

--
-- Incializamos Variables
--

   Select @PnEstatus            = 0,
          @PsMensaje            = Null,
          @w_servidor           = @@ServerName,
          @w_instancia          = @@servicename,
          @w_idMotivoCorreo     = 111,
          @w_idAplicacion       = 27,
          @w_comilla            = Char(39),
          @w_ipAct              = dbo.Fn_BuscaDireccionIP();

   Select @w_dbName     = name,
          @w_state_desc = state_desc
   From   sys.databases a
   Where  name       = @PsDbName;
   If @@Rowcount = 0
      Begin
         Select @PnEstatus = 8200,
                @PsMensaje = 'Error.: ' + dbo.Fn_Busca_MensajeError(@PnEstatus);

         Set Xact_Abort Off
         Return

      End

   If @w_state_desc != 'ONLINE'
      Begin
         Select @PnEstatus = 8201,
                @PsMensaje = 'Error.: ' + dbo.Fn_Busca_MensajeError(@PnEstatus);

         Set Xact_Abort Off
         Return

      End

   Select top 1 @w_usuario = parametroChar
   From   dbo.conParametrosGralesTbl
   Where  idParametroGral = 8;

   Select @w_sql   = 'Select @o_usuario = dbo.Fn_Desencripta_cadena(' + @w_usuario + ') ',
          @w_param = '@o_usuario Varchar(Max) Output '

   Execute Sp_ExecuteSQL @w_sql, @w_param, @o_usuario = @w_usuario Output

   Set @w_idUsuarioAct = Cast(@w_usuario As Smallint)

   Select top 1 @w_ambiente = parametroChar
   From   dbo.conParametrosGralesTbl
   Where  idParametroGral = 24;


--
-- Inicio de Proceso.
--

   Select @w_grupoCorreo        = codigoGrupoCorreo,
          @w_idTipoNotificacion = idTipoNotificacion,
          @w_tabla              = tablaLog,
          @w_proceso            = descripcion
   From   dbo.catControlProcesosTbl
   Where  idProceso = 5
   If @@Rowcount = 0
      Begin
         Select @PnEstatus = 3000,
                @PsMensaje = Dbo.Fn_Busca_]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsDbName" type="nvarchar"/>
            <parameter mode="IN" name="@PnImprimeResultado" type="bit"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spp_EjecutaMantenBD_1" type="PROCEDURE">
         <comment><![CDATA[Análiza, Valida y ejecuta Mantenimiento a las BD online en la instancia.]]></comment>
         <definition language="SQL"><![CDATA[/*
Declare
   @w_idProceso           Integer      = 0,
   @PnEstatus             Integer      = 0,  
   @PsMensaje             Varchar(250) = Null;

Begin
   Select @w_idProceso = Max(idProceso)
   From   SMBDTI.dbo.logMantenimientoBDTbl

   Execute Spp_EjecutaMantenBD_1 @PnEstatus = @PnEstatus Output,
                                 @PsMensaje = @PsMensaje Output

   If @PnEstatus != 0
      Begin
         Select @PnEstatus, @PsMensaje
      End

   Select *
   From   SMBDTI.dbo.logMantenimientoBDTbl
   Where  idProceso > @w_idProceso

   Return

End
Go 
                
*/

Create   Procedure Spp_EjecutaMantenBD_1
  (@PnEstatus             Integer      = 0     Output,  
   @PsMensaje             Varchar(250) = Null  Output)                
As

Declare
   @w_error          Integer,
   @w_desc_error     Varchar(250),
   @w_dbName         Sysname,
   @w_procedure      Sysname,
   @w_sql            NVarchar(1500),
   @w_param          NVarchar( 750),
   @w_Existe         Tinyint,
   @w_comilla        Char(1),
   @w_servidor       Sysname;
   
Declare
   C_BaseIni Cursor For
   Select name
   From   sys.databases
   Where  state_desc = 'ONLINE'
   And    name   Not In ('master', 'tempdb', 'model', 'msdb');

Begin
/*

Objetivo:    Análiza, Valida y ejecuta Mantenimiento a las BD online en la instancia.
Programador: Pedro Felipe Zambrano
Fecha:       06/05/2022

*/ 

   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    Off  

--
-- Incializamos Variables
--
                         
   Select @PnEstatus        = 0,
          @PsMensaje        = Null,
          @w_comilla        = Char(39);

   Begin Try 
      Update catControlProcesosTbl
      Set    ultFechaEjecucion = Getdate()
      Where  idProceso         = 1;
   End Try

   Begin Catch    
      Select  @w_Error      = @@Error,    
              @w_desc_error = Substring (Error_Message(), 1, 230)
  
   End   Catch    
 
   If IsNull(@w_Error, 0) <> 0    
      Begin    
         Select @PnEstatus = @w_Error,    
                @PsMensaje = 'Error.: ' + Rtrim(Ltrim(Cast(@w_Error As Varchar))) + ' ' + @w_desc_error  

      End

   Open  C_BaseIni
   While @@Fetch_status < 1
   Begin
      Fetch C_BaseIni Into @w_dbName
      If @@Fetch_status != 0
         Begin
            Break
         End

      Select @w_sql    = 'Select @o_existe = Count(Distinct 1) 
                          From   ' + @w_dbName + '.dbo.Sysobjects 
                          Where  Uid  = 1 
                          And    Type = ' + @w_comilla + 'P' + @w_comilla + '
                          And    Name = ' + @w_comilla + 'Spp_MantenimientoBD_1' + @w_comilla,
             @w_param  = '@o_existe   Tinyint Output',
             @w_Existe = 0;

     Execute Sp_ExecuteSQL @w_sql, @w_param, @o_existe = @w_existe Output

     If Isnull(@w_existe, 0) = 1
        Begin
           Set @w_procedure = @w_dbName + '.dbo.Spp_MantenimientoBD_1 '
           Execute @w_procedure @PsDbName   = @w_dbName,
                                @PnEstatus  = @PnEstatus Output,
                                @PsMensaje  = @PsMensaje Output

           If @PnEstatus != 0
              Begin
                 Select @PnEstatus, @PsMensaje
              End

        End
 
   End

   Close      C_BaseIni
   Deallocate C_BaseIni

   Set Xact_Abort Off
   Return

End]]></definition>
         <parameters>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spp_EjecutaMantenIndices" type="PROCEDURE">
         <comment><![CDATA[Procedimiento de Mantenimiento de Índices.]]></comment>
         <definition language="SQL"><![CDATA[/*
Declare
   @PsDbName              Sysname      = 'SCMBD',
   @PnEstatus             Integer      = 0,
   @PsMensaje             Varchar(250) = Null

Begin
   Execute dbo.Spp_EjecutaMantenIndices @PsDbName  = @PsDbName,
                                        @PnEstatus = @PnEstatus Output,
                                        @PsMensaje = @PsMensaje Output

   Select @PnEstatus, @PsMensaje

   Return

End
Go

*/

Create   Procedure dbo.Spp_EjecutaMantenIndices
  (@PsDbName              Sysname      = Null,
   @PnEstatus             Integer      = 0     Output,
   @PsMensaje             Varchar(250) = Null  Output)
As

Declare
   @w_error               Integer,
   @w_registros           Integer,
   @w_registro2           Integer,
   @w_secuencia           Integer,
   @w_secuencia2          Integer,
   @w_secuencia3          Integer,
   @w_idProceso           Integer,
   @w_idProceso2          Integer,
   @w_object_id           Integer,
   @w_linea               Integer,
   @w_idUsuarioAct        Integer,
   @w_idAplicacion        Smallint,
   @w_fragmentacion       Decimal(10, 3),
   @w_desc_error          Varchar ( 250),
   @w_proceso             Varchar ( 100),
   @w_actividad           Varchar (  80),
   @w_ip                  Varchar (  30),
   @w_grupoCorreo         Varchar (  20),
   @w_usuario             Varchar ( Max),
   @w_mensaje             Varchar ( Max),
   @w_sql                 NVarchar(1500),
   @w_param               NVarchar( 750),
   @w_existe              Tinyint,
   @w_existeError         Tinyint,
   @w_idEstatus           Tinyint,
   @w_idMotivoCorreo      Smallint,
   @w_idTipoNotificacion  Smallint,
   @w_comilla             Char(1),
   @w_dbName              Sysname,
   @w_servidor            Sysname,
   @w_esquema             Sysname,
   @w_tabla               Sysname,
   @w_tablalOG            Sysname,
   @w_indice              Sysname,
   @w_ambiente            Sysname;

Begin

-- Objetivo:    Realiza el mantenimiento de índices de la Base de Datos Seleccionada.
-- Programador: Pedro Felipe Zambrano
-- Fecha:       06/05/2025


   Set Nocount         On
   Set Xact_Abort      On
   Set Ansi_Nulls      Off
   Set Ansi_Warnings   OFF

--
-- Incializamos Variables
--

   Select @PnEstatus            = 0,
          @PsMensaje            = Char(32),
          @w_comilla            = Char(39),
          @w_servidor           = @@ServerName,
          @w_secuencia          = 0,
          @w_idAplicacion       = 27,
          @w_ip                 = dbo.Fn_buscaDireccionIP();

   Select @w_ip = Replace(@w_ip, '(', ''),
          @w_ip = Replace(@w_ip, ')', '');

   If @w_servidor like '%'+ Char(92) + '%'
      Begin
         Set @w_servidor = dbo.Fn_splitStringColumna(@w_servidor, Char(92), 1)
      End

--
-- Validaciones.
--

   If @PsDbName Is Not Null
      Begin
         Select @w_idEstatus = state
         From   sys.databases a
         Where  name       = @PsDbName;
         If @@Rowcount = 0
            Begin
               Select @PnEstatus = 8200,
                      @PsMensaje = dbo.Fn_Busca_MensajeError (@PnEstatus);
               Goto Salida;
            End
 
         If @w_idEstatus != 0
            Begin
               Select @PnEstatus = 8201,
                      @PsMensaje = dbo.Fn_Busca_MensajeError (@PnEstatus);
               Goto Salida;
            End        
         
      End

   If Cursor_status('global', 'C_BaseD') >= -1
      Begin
         Close      C_BaseD
         Deallocate C_BaseD
      End
      
--
-- Definición de CURSOR
--
   Declare
      C_BaseD Cursor For
      Select name
      From   sys.databases a
      Where  state_desc = 'ONLINE'
      And    name  Not In ('master', 'tempdb', 'model', 'msdb')
      And    name       = Isnull(@PsDbName, a.name)
      Order  By 1;
      
--
-- Creación de Tablas Temporales.
-]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsDbName" type="nvarchar"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spp_EjecutaMantenTablas" type="PROCEDURE">
         <comment><![CDATA[Procedimiento de Mantenimiento de Índices.]]></comment>
         <definition language="SQL"><![CDATA[/*
Declare
   @PsDbName              Sysname      = 'SCMBD',
   @PnEstatus             Integer      = 0,
   @PsMensaje             Varchar(250) = Null

Begin
   Execute dbo.Spp_EjecutaMantenTablas @PsDbName  = @PsDbName,
                                        @PnEstatus = @PnEstatus Output,
                                        @PsMensaje = @PsMensaje Output

   Select @PnEstatus, @PsMensaje

   Return

End
Go

*/

Create   Procedure dbo.Spp_EjecutaMantenTablas
  (@PsDbName              Sysname      = Null,
   @PnEstatus             Integer      = 0     Output,
   @PsMensaje             Varchar(250) = Null  Output)
As

Declare
   @w_error             Integer,
   @w_desc_error        Varchar ( 250),
   @w_actividad         Varchar (  80),
   @w_sql               NVarchar(1500),
   @w_param             NVarchar( 750),
   @w_existe            Tinyint,
   @w_existeError       Tinyint,
   @w_comilla           Char(1),
   @w_registros         Integer,
   @w_registro2         Integer,
   @w_secuencia         Integer,
   @w_secuencia2        Integer,
   @w_idProceso         Integer,
   @w_idProceso2        Integer,
   @w_object_id         Integer,
   @w_fragmentacion     Decimal(10, 3),
   @w_dbName            Sysname,
   @w_servidor          Sysname,
   @w_esquema           Sysname,
   @w_tabla             Sysname,
   @w_indice            Sysname;

Declare
   C_BaseD Cursor For
   Select name
   From   sys.databases a
   Where  state_desc = 'ONLINE'
   And    name  Not In ('master', 'tempdb', 'model', 'msdb')
   And    name       = Isnull(@PsDbName, a.name);

Begin

/*

Objetivo:    Realiza el mantenimiento de índices de la Base de Datos Seleccionada.
Programador: Pedro Felipe Zambrano
Fecha:       06/05/2022

*/

   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    Off

--
-- Incializamos Variables
--

   Select @PnEstatus        = 0,
          @PsMensaje        = Null,
          @w_comilla        = Char(39),
          @w_servidor       = @@ServerName,
          @w_secuencia      = 0;

   Begin Try
      Update catControlProcesosTbl
      Set    ultFechaEjecucion = Getdate()
      Where  idProceso         = 2;
   End Try

   Begin Catch
      Select  @w_Error      = @@Error,
              @w_desc_error = Substring (Error_Message(), 1, 230)

   End   Catch

   If IsNull(@w_Error, 0) <> 0
      Begin
         Select @PnEstatus = @w_Error,
                @PsMensaje = 'Error.: ' + Rtrim(Ltrim(Cast(@w_Error As Varchar))) + ' ' + @w_desc_error

      End

   Create Table #tempObj1
   (secuencia       Integer Identity (1, 1) Not Null Primary Key,
    baseDatos       Sysname                 Not Null,
    fragmentacion   Decimal(10, 3)              Null,
    object_id       Integer                 Not Null);

   Create Table #tempObj2
   (secuencia       Integer Identity (1, 1) Not Null Primary Key,
    esquema         Sysname                 Not Null,
    tabla           Sysname                 Not Null,
    indice          Sysname                     Null);

   Open  C_BaseD
   While @@Fetch_status < 1
   Begin
      Fetch C_BaseD Into @w_dbName
      If @@Fetch_status != 0
         Begin
            Break
         End

      Select @w_registro2   = 0,
             @w_secuencia   = 0,
             @PnEstatus     = 0,
             @PsMensaje     = '',
             @w_Error       = 0;

      Insert Into dbo.logMantenIndicesTbl
      (servidor, baseDatos, actividad)
      Select @w_servidor, @w_dbName, 'Proceso de Mantenimiento de Índices'
      Set @w_idProceso = @@Identity

      Truncate Table #tempObj1

      Set @w_sql = 'Select ' + @w_comilla  + @w_dbName + @w_comilla + ', avg_fragmentation_in_percent , object_id
                    From  sys.dm_db_index_physical_stats
                    (DB_ID(N'+ @w_comilla  + @w_dbName + @w_comilla +'), Null, NULL, NULL , Null)]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsDbName" type="nvarchar"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spp_GeneraUserBD" type="PROCEDURE">
         <comment><![CDATA[Procedimiento que Genera nuevos Usuarios en la Base de Datos.]]></comment>
         <definition language="SQL"><![CDATA[Create   Procedure Spp_GeneraUserBD
  (@PsIdUsuarioBD           Sysname,
   @PsPasswordBD            Sysname,
   @PsBaseDatos             Sysname,
   @PnEstatus               Integer        = 0     Output,
   @PsMensaje               Varchar( 250)  = Null  Output)
As

Declare
    @w_desc_error              Varchar( 250),  
    @w_Error                   Integer,  
    @w_IdEstatus               Tinyint,  
    @w_sql                     NVarchar(1500),
    @w_param                   NVarchar( 750),
    @w_comilla                 Char(1),
    @w_registros               Smallint

Begin  
/*
Objetivo: Generar usuario de Base de Datos.
Vsersión: 1
*/

   Set Nocount       On  
   Set Xact_Abort    On  
   Set Ansi_Nulls    Off 
   Set Ansi_Warnings On  
   Set Ansi_Padding  On  

   Select @PnEstatus  = 0,
          @PsMensaje  = '',
          @w_comilla = Char(39)

   Select @w_idEstatus = is_disabled
   From   master.sys.sql_logins
   Where  type = 'S'
   And    name = @PsIdUsuarioBD
   If @@Rowcount = 0
      Begin
         Set @w_sql = 'Create Login ' + @PsIdUsuarioBD + ' With  Password = ' + @w_comilla + @PsIdUsuarioBD + @w_comilla + ', ' +
                      'Default_database = ' + @PsBaseDatos                                                               + ', ' +  
                      'Default_Language = English '                                                                      + ', ' +
                      'Check_Expiration = Off '                                                                          + ', ' +
                      'Check_Policy     = Off'
         Begin Try
            Execute (@w_sql)
         End   Try
      
         Begin Catch
            Select  @w_Error      = @@Error,
                    @w_desc_error = Substring (Error_Message(), 1, 230)
         End   Catch
      
         If Isnull(@w_Error, 0) <> 0
            Begin
               Select @PnEstatus = @w_Error,
                      @PsMensaje = 'Error.: ' + Rtrim(Ltrim(Cast(@w_Error As Varchar))) + ' ' + @w_desc_error

               Set Xact_Abort Off
               Return
            End
      End

   Select @w_sql   = 'Select @o_idEstatus = Count(1) '                           +
                     'From   ' + @PsBaseDatos + '.sys.sysusers '                 +
                     'Where  name = ' + @w_comilla + @PsIdUsuarioBD + @w_comilla,
          @w_param = '@o_idEstatus  Tinyint Output'

   Begin Try
      Execute Sp_executeSQL @w_sql, @w_param, @o_idEstatus = @w_IdEstatus Output
   End   Try

   Begin Catch
      Select  @w_Error      = @@Error,
              @w_desc_error = Substring (Error_Message(), 1, 230)
   End   Catch

   If Isnull(@w_Error, 0) <> 0
      Begin
         Select @PnEstatus = @w_Error,
                @PsMensaje = 'Error.: ' + Rtrim(Ltrim(Cast(@w_Error As Varchar))) + ' ' + @w_desc_error
         Set Xact_Abort Off
         Return
      End


   If Isnull(@w_IdEstatus, 0) = 0
      Begin
         Set @w_sql = 'Use '         + @PsBaseDatos   + '; ' + Char(13) +
                      'Create User ' + @PsIdUsuarioBD + ' For Login ' + @PsIdUsuarioBD + ' ' +
                      'With Default_schema = ' + @PsIdUsuarioBD
         Begin Try
            Execute (@w_sql)
         End   Try
      
         Begin Catch
            Select  @w_Error      = @@Error,
                    @w_desc_error = Substring (Error_Message(), 1, 230)
         End   Catch
      
         If Isnull(@w_Error, 0) <> 0
            Begin
               Select @PnEstatus = @w_Error,
                      @PsMensaje = 'Error.: ' + Rtrim(Ltrim(Cast(@w_Error As Varchar))) + ' ' + @w_desc_error
               Set Xact_Abort Off
               Return
            End
      End

   Set @w_sql =  'Use '         + @PsBaseDatos   + '; ' + Char(13) +
                'Execute sp_addrolemember ' + @w_comilla + 'db_datareader'  + @w_comilla]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsIdUsuarioBD" type="nvarchar"/>
            <parameter mode="IN" name="@PsPasswordBD" type="nvarchar"/>
            <parameter mode="IN" name="@PsBaseDatos" type="nvarchar"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spp_MantenimientoBD_1" type="PROCEDURE">
         <comment><![CDATA[Análiza, Valida y ejecuta Mantenimiento a la BD.]]></comment>
         <definition language="SQL"><![CDATA[/*
Declare
   @PsDbName              Varchar(250) = 'SMBDTI',
   @w_idProceso           Integer      = 0,
   @PnEstatus             Integer      = 0,  
   @PsMensaje             Varchar(250) = Null;

Begin
   Select @w_idProceso = Max(idProceso)
   From   dbo.logMantenimientoBDTbl

   Execute Spp_MantenimientoBD_1 @PsDbName  = @PsDbName,
                                 @PnEstatus = @PnEstatus Output,
                                 @PsMensaje = @PsMensaje Output

   If @PnEstatus != 0
      Begin
         Select @PnEstatus, @PsMensaje
      End

   Select *
   From   dbo.logMantenimientoBDTbl
   Where  idProceso > @w_idProceso

   Return

End
Go 
                
*/

Create   Procedure dbo.Spp_MantenimientoBD_1
  (@PsDbName              Varchar(250),
   @PnEstatus             Integer      = 0     Output,  
   @PsMensaje             Varchar(250) = Null  Output)                
As

Declare
   @w_error          Integer,
   @w_desc_error     Varchar(250),
   @w_dbName         Sysname,
   @w_tipoRecovery   Varchar(100),
   @w_dbFile         Sysname,
   @w_sql            Varchar(Max),
   @w_comilla        Char(1),
   @w_fechaInicio    Datetime,
   @w_servidor       Sysname,
   @w_database_id    Integer,
   @w_idProceso      Integer,
   @w_idProcesoF     Integer;

Declare
   C_base Cursor For
   Select database_id, name, recovery_model_desc
   From   sys.databases
   Where  name       = @PsDbName
   And    state_desc = 'ONLINE';

Begin
/*

Objetivo:    Análiza, Valida y ejecuta Mantenimiento a la BD.
Programador: Pedro Felipe Zambrano
Fecha:       06/05/2022

*/ 

   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    Off  

--
-- Incializamos Variables
--
                         
   Select @PnEstatus        = 0,
          @PsMensaje        = Null,
          @w_comilla        = Char(39),
          @w_servidor       = @@ServerName;

   Open  C_Base
   While @@Fetch_status < 1
   Begin
      Fetch C_Base Into @w_database_id, @w_dbName, @w_tipoRecovery
      If @@Fetch_status != 0
         Begin
            Break
         End

      Set @w_fechaInicio = Getdate()

      Begin Try
         Insert Into dbo.logMantenimientoBDTbl
         (servidor, baseDatos, actividad, fechaInicio)
         Select @w_servidor, @w_dbName, 'Comprobación de la integridad lógica y física de la base de datos', @w_fechaInicio

         Set @w_idProceso = @@Identity
      End Try

      Begin Catch
         Select  @w_Error      = @@Error,    
                 @w_desc_error = Substring (Error_Message(), 1, 230)
      End   Catch
                     
      If Isnull(@w_Error, 0)  <> 0
         Begin                  
            Select @PnEstatus  = @w_Error,    
                   @PsMensaje  = 'Error.: ' + Rtrim(Ltrim(Cast(@w_Error As Varchar))) + ' ' + @w_desc_error

            Set Xact_Abort Off                      
            Return
         End

      If @w_tipoRecovery != 'SIMPLE'
         Begin
            Set @w_sql = 'Alter Database ' + @w_dbName + ' Set Recovery Simple';
         End

      Begin Try
         Execute (@w_sql)
      End   Try

      Begin Catch
         Select  @w_Error      = @@Error,    
                 @w_desc_error = Substring (Error_Message(), 1, 230)
      End   Catch
                     
      If Isnull(@w_Error, 0)  <> 0
         Begin                  
            Select @PnEstatus  = @w_Error,    
                   @PsMensaje  = 'Error.: ' + Rtrim(Ltrim(Cast(@w_Error As Varchar))) + ' ' + @w_desc_error

            Update  dbo.logMantenimientoBDTbl
            Set     fechaTermino = @w_fechaInicio,
                    Error        = @PnEstatus,
                    mensajeError = @PsMensaje
            Where   idProceso = @w_idProceso
            
            Break

         End
		 
      Set @w_sql = Concat('Dbcc Checkdb (', @w_comilla, @w_dbName, @w_comilla, ',]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsDbName" type="varchar"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spp_MantenimientoDepuraTablas" type="PROCEDURE">
         <comment><![CDATA[Procedimiento de Depuración de datos en tablas incluidas en la entidad catMantenimentoTablasTbl.]]></comment>
         <definition language="SQL"><![CDATA[/*
Declare
   @w_idProceso           Integer      = 0,
   @PnEstatus             Integer      = 0,
   @PsMensaje             Varchar(250) = Null;

Begin
   Select @w_idProceso = Max(idProceso)
   From   dbo.logMantenimientoDepTablaTbl

   Execute Spp_MantenimientoDepuraTablas @PnEstatus = @PnEstatus Output,
                                         @PsMensaje = @PsMensaje Output

   If @PnEstatus != 0
      Begin
         Select @PnEstatus, @PsMensaje
      End

   Select *
   From   dbo.logMantenimientoDepTablaTbl
   Where  idProceso > Isnull(@w_idProceso, 0)

   Return

End
Go

*/

Create   Procedure dbo.Spp_MantenimientoDepuraTablas
  (@PnEstatus              Integer      = 0     Output,
   @PsMensaje              Varchar(250) = Null  Output)
As

Declare
   @w_error                Integer,
   @w_desc_error           Varchar(  250),
   @w_ambiente             Varchar(  250),
   @w_incidencia           Varchar(  850),
   @w_proceso              Varchar(  100),
   @w_ip                   Varchar(   30),
   @w_grupoCorreo          Varchar(   20),
   @w_usuario              Varchar(  Max),
   @w_parametros           Varchar(  Max),
   @w_dbname               Sysname,
   @w_baseDatos            Sysname,
   @w_tabla                Sysname,
   @w_tablalOG             Sysname,
   @w_campo                Sysname,
   @w_procedimiento        Sysname,
   @w_servidor             Sysname,
   @w_instancia            Sysname,
   @w_query                Nvarchar( Max),
   @w_sql                  NVarchar(1500),
   @w_param                NVarchar( 750),
   @w_comilla              Char(1),
   @w_fechaInicio          Datetime,
   @w_fechaAct             Datetime,
   @w_fechaComp            Date,
   @w_fechaProc            Date,
   @w_idTipoNotificacion   Tinyint,
   @w_idEstatus            Tinyint,
   @w_secuencia            Integer,
   @w_idAplicacion         Integer,
   @w_idMotivoCorreo       Integer,
   @w_dias                 Integer,
   @w_registros            Integer,
   @w_idProceso            Integer,
   @w_idProcesoLog         Integer,
   @w_idUsuarioAct         Integer;

Declare
   C_DepPaso1 Cursor For
   Select idProceso, baseDatos, tabla, campo, dias
   From   dbo.catMantenimentoTablasTbl a
   Where  servidor  = @@ServerName
   And    idTipoDep = 1
   And    idEstatus = 1
   And    Exists    ( Select Top 1 1
                      From   sys.databases
                      Where  state_desc = 'ONLINE'
                      And    name       = a.baseDatos);

Declare
   C_DepPaso2 Cursor For
   Select idProceso, baseDatos, tabla, Concat(a.baseDatos, '.dbo.', a.procedimiento), dias
   From   dbo.catMantenimentoTablasTbl a
   Where  servidor  = @@ServerName
   And    idTipoDep = 2
   And    idEstatus = 1
   And    Exists    ( Select Top 1 1
                      From   sys.databases
                      Where  state_desc = 'ONLINE'
                      And    name       = a.baseDatos);

Begin
/*

Objetivo:    Procedimiento de Depuración de datos en tablas incluidas en la entidad catMantenimentoTablasTbl.
Programador: Pedro Felipe Zambrano
Fecha:       06/05/2025

*/

   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    Off

--
-- Incializamos Variables
--

   Select @PnEstatus            = 0,
          @PsMensaje            = Null,
          @w_comilla            = Char(39),
          @w_servidor           = @@ServerName,
          @w_instancia          = @@servicename,
          @w_idMotivoCorreo     = 112,
          @w_idAplicacion       = 27,
          @w_secuencia          = 0,
          @w_fechaAct           = Getdate(),
          @w_fechaProc          = @w_fechaAct,
          @w_dbname             = Db_name(),
          @w_ip                 = dbo.Fn_buscaDireccionIP();

   Select @w_ip = Replace(@w_ip, '(', ''),
          @w_ip = Replace(@w_ip, ')', '');

   If @w_servidor like '%'+]]></definition>
         <parameters>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spp_ProcesaConsultaHtmlTable" type="PROCEDURE">
         <comment><![CDATA[Construye una tabla XML desde una consulta SQL para presentarla en HTML.]]></comment>
         <definition language="SQL"><![CDATA[/*
Declare
   @PsConsulta           NVarchar(Max) = '',
   @PsOrdenPres          NVarchar(Max) = Null,
   @PsHTML               NVarchar(Max) = Null Output,
   @PnEstatus            Integer       = 0    Output,
   @PsMensaje            Varchar(250)  = Null Output)
Begin
   Execute dbo.Spp_ProcesaConsultaHtmlTable @PsConsulta  = @PsConsulta,
                                            @PsOrdenPres = @PsOrdenPres,
                                            @PsHTML      = @PsHTML    Output,
                                            @PnEstatus   = @PnEstatus Output,
                                            @PsMensaje   = @PsMensaje Output;
   If @PnEstatus != 0
      Begin
         Select @PnEstatus As Error, @PsMensaje As Mensaje;
      End

   Return

End;
Go
*/

Create   Procedure dbo.Spp_ProcesaConsultaHtmlTable
  (@PsConsulta           NVarchar(Max),
   @PsOrdenPres          NVarchar(Max) = Null,
   @PsHTML               NVarchar(Max) = Null Output,
   @PnEstatus            Integer       = 0    Output,
   @PsMensaje            Varchar(250)  = Null Output)
As

Declare
   @w_desc_error        Varchar( 250),
   @w_error             Integer,
   @w_consulta          NVarchar(Max),
   @w_sql               Varchar(Max),
   @w_comilla           Char(1),
   @w_tabla             Sysname,
   @w_registros         Integer,
   @w_secuencia         Integer,
   @w_columna           Sysname,
   @w_titcol            Sysname,
   @w_columnas          NVarchar(Max),
   @w_param             NVarchar(750),
   @w_titulosCol        NVarchar(Max),
   @w_idTipo            Integer;

Declare
   @w_table             Table
   (secuencia           Integer  Not Null Identity (1, 1) Primary Key,
    nombre              Sysname,
    idTipo              Integer);

Begin

/*

Objetivo:    Construye una tabla XML desde una consulta SQL para presentarla en HTML.
Programador: Pedro Felipe Zambrano
Fecha:       11/11/2025
Versión:     1

*/

   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    Off

--
-- Inicializamos Variables
--

   Select @PnEstatus    = 0,
          @PsMensaje    = '',
          @w_comilla    = Char(39),
          @w_secuencia  = 0,
          @PsOrdenPres  = Isnull(@PsOrdenPres, ''),
          @w_tabla      = 'TmpHtml_' + Substring(Replace(Cast(newid() As Varchar(100)), '-', ''), 1, 30);

   If Exists ( Select Top 1 1
               From   sys.objects
               Where  name = @w_tabla)
      Begin
         Set @w_sql = 'Drop Table ' + @w_tabla
         Execute(@w_sql)
      End

   Set @w_sql = 'Select *
                 Into   ' + @w_tabla + '
                 From ('  + @PsConsulta + ') sub;';

   Execute(@w_sql);

   Set @w_sql = 'Alter Table ' + @w_tabla + ' Add secuencia Integer Not Null Identity (1, 1) Primary Key'
   Execute(@w_sql)

   Set @w_sql = 'Select name, system_type_id
                 From   sys.columns
                 Where  object_id = object_id(' + @w_comilla + @w_tabla + @w_comilla + ')
                 And    name     != ' + @w_comilla + 'secuencia' + @w_comilla + '
                 Order  By column_id'

   Insert Into @w_table
   (nombre, idTipo)
   Execute (@w_sql)

   Select @w_registros = @@Identity

   While @w_secuencia < @w_registros
   Begin
      Set @w_secuencia = @w_secuencia + 1
      Select @w_columna = Concat('[', nombre, '] As ', @w_comilla, 'td', @w_comilla),
             @w_titcol  = nombre,
             @w_idTipo  = idTipo
      From   @w_table
      Where  secuencia = @w_secuencia;
      If @@Rowcount = 0
         Begin
            Break
         End

      If @w_secuencia = 1
         Begin
            Select @w_columnas   = @w_columna,
                   @w_titulosCol = @w_titcol
         End
      Else
         Begin
            Set @w_titulosCol = Concat(@w_titulosCol, '<th>', @w_titcol, '</th>')

            If @w_idTipo In (56, 52, 48)]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsConsulta" type="nvarchar"/>
            <parameter mode="IN" name="@PsOrdenPres" type="nvarchar"/>
            <parameter mode="INOUT" name="@PsHTML" type="nvarchar"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spp_SolicitaCorreoMantBD" type="PROCEDURE">
         <comment><![CDATA[Genera la Solicitud de Notificación de Monitoreo de Base de Datos (Altos tiempos de Ejecución y Bloqueos).]]></comment>
         <definition language="SQL"><![CDATA[/*
Declare
   @PdFechaProceso        Date          = Getdate(),
   @PsIdProceso           Varchar(1000) = '3, 4',
   @PnEstatus             Integer       = 0,
   @PsMensaje             Varchar(250)  = Null;

Begin
   Execute Spp_SolicitaCorreoMantBD @PdFechaProceso = @PdFechaProceso,
                                    @PsIdProceso    = @PsIdProceso,
                                    @PnEstatus      = @PnEstatus Output,
                                    @PsMensaje      = @PsMensaje Output

   Select @PnEstatus, @PsMensaje

   Return

End
Go

*/

Create    Procedure Spp_SolicitaCorreoMantBD
  (@PdFechaProceso        Date           = Null,
   @PsIdProceso           Varchar(1000),
   @PnEstatus             Integer        = 0     Output,
   @PsMensaje             Varchar(250)   = Null  Output)
As

Declare
   @w_error                 Integer,
   @w_desc_error            Varchar( 250),
   @w_parametros            Varchar( Max),
   @w_incidencia            Varchar( 850),
   @w_mensaje               Varchar( 250),
   @w_mensajeError          Varchar( 250),
   @w_servidor              Varchar( 100),
   @w_grupoCorreo           Varchar(  20),
   @w_correo                Varchar( 250),
   @w_descripcion           Varchar( 100),
   @w_link                  Varchar( 512),
   @w_ambiente              Varchar(  80),
   @w_fechaProceso          Date,
   @w_fechaAct              Datetime,
   @w_usuario               Varchar( Max),
   @w_sql                   NVarchar(1500),
   @w_param                 NVarchar( 750),
   @w_idAplicacion          Smallint,
   @w_idMotivoCorreo        Smallint,
   @w_idTipoNotificacion    Tinyint,
   @w_idUsuarioAct          Integer,
   @w_registros             Integer,
   @w_secuencia             Integer,
   @w_registros2            Integer,
   @w_secuencia2            Integer,
   @w_tabla                 Sysname,
   @w_existe                Tinyint,
   @w_enviaNotificacion     Tinyint,
   @w_idFiltraError         Bit,
   @w_comilla               Char(1),
--
   @w_idProceso             Integer,
   @w_proceso               Varchar(100),
   @w_idError               Integer;

Begin
/*

Objetivo:    Genera la Solicitud de Notificación de Monitoreo de Base de Datos (Altos tiempos de Ejecución y Bloqueos).
Programador: Pedro Felipe Zambrano
Fecha:       31/08/2022
Version:     2

*/

   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    Off

--
-- Incializamos Variables
--

   Select @PnEstatus            = 0,
          @PsMensaje            = Null,
          @w_fechaProceso       = Getdate(),
          @PdFechaProceso       = Isnull(@PdFechaProceso, @w_fechaProceso),
          @w_servidor           = @@ServerName,
          @w_idMotivoCorreo     = 106,
          @w_idTipoNotificacion = 2,
          @w_idAplicacion       = 27,
          @w_registros          = 0,
          @w_secuencia          = 0,
          @w_registros2         = 0,
          @w_secuencia2         = 0,
          @w_fechaAct           = Getdate(),
          @w_comilla            = Char(39);

--
-- Generación de Tabla Temporal
--

   Create Table #TempControlProcesos
   (secuencia              Integer        Not Null Identity(1, 1)  Primary key,
    descripcion            Varchar(100)   Not Null,
    tablaLog               Sysname            Null,
    mensaje                Varchar(Max)       Null,
    mensajeError           Varchar(Max)       Null,
    idTipoNotificacion     Tinyint            Null,
    enviaNotificacion      Tinyint            Null,
    idFiltraError          Bit            Not Null,
    link                   Varchar(512)       Null,
    codigoGrupoCorreo      Varchar( 30)       Null)

   Create Table #TempProcesos
   (secuencia    Integer       Not Null Identity(1, 1) Primary Key,
    idProceso    Integer       Not Null,
    proceso      Varchar(100)  Not Null)

--
-- Busqueda de Parámetros]]></definition>
         <parameters>
            <parameter mode="IN" name="@PdFechaProceso" type="date"/>
            <parameter mode="IN" name="@PsIdProceso" type="varchar"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spp_SolicitaCorreoMantBDV2" type="PROCEDURE">
         <comment><![CDATA[Genera la Solicitud de Notificación de Monitoreo de Base de Datos (link Server, Jobs).]]></comment>
         <definition language="SQL"><![CDATA[/*
Declare
   @PsIdProceso           Varchar(1000) = '11, 12, 14,15, 16',
   @PnEstatus             Integer       = 0,
   @PsMensaje             Varchar(250)  = Null;

Begin
   Execute Spp_SolicitaCorreoMantBDV2 @PsIdProceso    = @PsIdProceso,
                                      @PnEstatus      = @PnEstatus Output,
                                      @PsMensaje      = @PsMensaje Output

   Select @PnEstatus, @PsMensaje

   Return

End
Go

*/

Create    Procedure Spp_SolicitaCorreoMantBDV2
  (@PsIdProceso           Varchar(1000),
   @PnEstatus             Integer        = 0     Output,
   @PsMensaje             Varchar(250)   = Null  Output)
As

Declare
   @w_error                 Integer,
   @w_desc_error            Varchar ( 250),
   @w_usuario               Varchar ( Max),
   @w_sql                   NVarchar(1500),
   @w_param                 Nvarchar( 750),
   @w_fechaAct              Datetime,
   @w_procedimiento         Sysname,
   @w_existe                Tinyint,
   @w_registros             Integer,
   @w_registros2            Integer,
   @w_linea                 Integer,
   @w_secuencia             Integer,
   @w_comilla               Char(1),
--
   @w_idProceso             Integer,
   @w_idError               Integer,
   @w_idUsuarioAct          Integer;

Begin
/*

Objetivo:    Genera la Solicitud de Notificación de Monitoreo de Base de Datos (link Server, Jobs).
Programador: Pedro Felipe Zambrano
Fecha:       02/08/2025

*/

   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    Off

--
-- Incializamos Variables
--

   Select @PnEstatus            = 0,
          @PsMensaje            = '',
          @w_registros          = 0,
          @w_registros2         = 0,
          @w_secuencia          = 0,
          @w_fechaAct           = Getdate(),
          @w_comilla            = Char(39);


--
-- Busqueda de Parámetros y Validación
--

   Select @w_usuario = parametroChar
   From   dbo.conParametrosGralesTbl
   Where  idParametroGral = 8
   If @@Rowcount = 0
      Begin
         Set @w_usuario = dbo.Fn_Encripta_cadena(1)
      End

   Select @w_sql      = 'Select @o_cadena = dbo.Fn_Desencripta_cadena(' + @w_usuario + ')  ',
          @w_param    = '@o_cadena Varchar(Max) Output '

   Execute Sp_ExecuteSQL @w_sql, @w_param, @o_cadena = @w_usuario Output

   Set @w_idUsuarioAct = Cast(@w_usuario As Integer)

   Set @PnEstatus = dbo.Fn_ValidaUsuario (18)

   If @PnEstatus != 0
      Begin
         Set @PsMensaje = dbo.Fn_Busca_MensajeError(@PnEstatus)

         Set Xact_Abort Off
         Return

      End

--
-- Generación de Tabla Temporal
--


   Create Table #TempProcesos
   (secuencia     Integer       Not Null Identity(1, 1) Primary Key,
    procedimiento Sysname       Not Null)

--
-- Inicio de Proceso
--

   Set @w_sql = 'Select Procedimiento
                 From   dbo.catControlProcesosTbl
                 Where  idProceso In (' + @PsIdProceso + ')
                 And    idEstatus = 1';

   Begin Try
      Insert Into #TempProcesos
      (procedimiento)
     Execute(@w_sql)
     Set @w_registros2 = @@Rowcount
   End Try

   Begin Catch
      Select  @w_Error      = @@Error,
              @w_desc_error = Substring (Error_Message(), 1, 230),
              @w_linea      = error_line()
   End   Catch

   If Isnull(@w_Error, 0)  <> 0
      Begin
         Select @PnEstatus  = @w_Error,
                @PsMensaje  = Concat('Error.: ', @w_Error, ' ', + @w_desc_error,
                                     ', en linea ', @w_linea);

         Set Xact_Abort Off
         Return
      End

   If @w_registros2 = 0
      Begin
         Select @PnEstatus = 3000,
                @PsMensaje = Dbo.Fn_Busca_MensajeError(@PnEstatus)

         Set Xact_Abort    Off
         Return
      End

   While @w_secuencia < @w_registros2
   Begin
      Set @w_secuencia =]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsIdProceso" type="varchar"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spp_SolicitaCorreoMasivoMantBD" type="PROCEDURE">
         <comment><![CDATA[Procedimiento de Solicitud de Notificaciones por Proceso Mantenimiento de Base de Datos.]]></comment>
         <definition language="SQL"><![CDATA[/*    
Declare    
   @PdFechaProceso        Date         = Null,    
   @PsIdProceso           Varchar(250) = '3, 4',    
   @PnEstatus             Integer      = 0,    
   @PsMensaje             Varchar(250) = Null;    
    
Begin    
   Execute dbo.Spp_SolicitaCorreoMasivoMantBD @PdFechaProceso = @PdFechaProceso,    
                                              @PsIdProceso    = @PsIdProceso,    
                                              @PnEstatus      = @PnEstatus Output,    
                                              @PsMensaje      = @PsMensaje Output    
    
   Select @PnEstatus, @PsMensaje    
    
   Return    
    
End    
Go    
    
*/    
    
CREATE   Procedure dbo.Spp_SolicitaCorreoMasivoMantBD    
  (@PdFechaProceso        Date         = Null,    
   @PsIdProceso           Varchar(250),    
   @PnEstatus             Integer      = 0     Output,    
   @PsMensaje             Varchar(250) = Null  Output)    
As    
    
Declare    
   @w_error                 Integer,    
   @w_desc_error            Varchar( 250),    
   @w_parametros            Varchar( Max),    
   @w_incidencia            Varchar( 250),    
   @w_mensaje               Varchar( 250),    
   @w_mensajeError          Varchar( 250),    
   @w_servidor              Varchar( 100),    
   @w_grupoCorreo           Varchar(  20),    
   @w_correo                Varchar( 250),    
   @w_descripcion           Varchar( 100),    
   @w_link                  Varchar( 512),    
   @w_ambiente              Varchar(  80),    
   @w_fechaProceso          Date,    
   @w_fechaAct              Datetime,    
   @w_usuario               Varchar( Max),    
   @w_sql                   NVarchar(1500),    
   @w_param                 NVarchar( 750),    
   @w_idAplicacion          Smallint,    
   @w_idMotivoCorreo        Smallint,    
   @w_idTipoNotificacion    Tinyint,    
   @w_idUsuarioAct          Integer,    
   @w_registros             Integer,    
   @w_registros2            Integer,    
   @w_secuencia             Integer,    
   @w_tabla                 Sysname,    
   @w_existe                Tinyint,    
   @w_enviaNotificacion     Tinyint,    
   @w_idFiltraError         Bit,    
   @w_comilla               Char(1),    
   @w_idProceso             Integer,    
   @w_mensajeProc           Varchar(250);    
    
Begin    
/*    
    
Objetivo:    Generación de Solicitud de Notificaciones por Incidencias.    
Programador: Pedro Felipe Zambrano    
Fecha:       06/05/2025  
    
*/    
   Set Nocount       On    
   Set Xact_Abort    On    
   Set Ansi_Nulls    Off    
    
--    
-- Inicializamos Variables    
--    
    
   Select @PnEstatus            = 0,    
          @PsMensaje            = '',    
          @w_fechaProceso       = Getdate(),    
          @PdFechaProceso       = Isnull(@PdFechaProceso, @w_fechaProceso),    
          @w_servidor           = @@ServerName,    
          @w_idMotivoCorreo     = 106,    
          @w_idTipoNotificacion = 1,    
          @w_idAplicacion       = 27,    
          @w_registros          = 0,    
          @w_secuencia          = 0,    
          @w_fechaAct           = Getdate(),    
          @w_comilla            = Char(39);    
    
--    
-- Generación de Tabla Temporal    
--    
    
   Create Table #TempControlProcesos    
   (secuencia              Integer        Not Null Identity(1, 1)  Primary key,    
    idProceso              Integer        Not Null,    
    descripcion            Varchar(100)   Not Null,    
    tablaLog               Sysname            Null,    
    mensaje                Varchar(Max)       Null,    
    mensajeError           Varchar(Max)       Null,    
    idTipoNotificacion     Tinyint            Null,    
    enviaNotificacion      Tinyint            Null,    
    idFiltraError          Bit            Not Null,    
    link                   Varcha]]></definition>
         <parameters>
            <parameter mode="IN" name="@PdFechaProceso" type="date"/>
            <parameter mode="IN" name="@PsIdProceso" type="varchar"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spp_SolicitaNotificacionControlEnvios" type="PROCEDURE">
         <comment><![CDATA[Procedimiento de Solicitación de Notificacionesd de Control de Envios.]]></comment>
         <definition language="SQL"><![CDATA[/*

Declare
   @PdFechaProc       Date         = Null,
   @PnIdAccion        Tinyint      = 1,
   @PnTipoConsulta    Tinyint      = 1,
   @PnEstatus         Integer      = 0,
   @PsMensaje         Varchar(250) = Null
Begin
   Execute dbo.Spp_SolicitaNotificacionControlEnvios @PdFechaProc    = @PdFechaProc,
                                                     @PnIdAccion     = @PnIdAccion,
                                                     @PnTipoConsulta = @PnTipoConsulta,
                                                     @PnEstatus      = @PnEstatus    Output,
                                                     @PsMensaje      = @PsMensaje    Output;
  If @PnEstatus != 0
     Begin
        Select @PnEstatus, @PsMensaje
     End

  Return;
End
Go
*/

Create   Procedure dbo.Spp_SolicitaNotificacionControlEnvios
  (@PdFechaProc       Date         = Null,
   @PnIdAccion        Tinyint      = 1,                -- 1 = Solicita Correo,    2 = Emite Reporte
   @PnTipoConsulta    Tinyint      = 1,                -- 1 = Consulta Acumulada, 2 = Consulta del Día
   @PnEstatus         Integer      = 0    Output,
   @PsMensaje         Varchar(250) = Null Output)
As

Declare
   @w_error             Integer,
   @w_desc_error        Varchar ( 250),
   @w_registros         Integer,
   @w_secuencia         Integer,
   @w_idAplicacion      Integer,
   @w_cantidad          Integer,
   @w_tope              Integer,
   @w_topeDiario        Integer,
   @w_fechaProc         Date,
   @w_fechaInicio       Date,
   @w_diaInicioCorte    Tinyint,
   @w_sql               Varchar(4000),
   @w_comilla           Char(1);

Declare
   @w_tablaResultado    Table
   (idAplicacion   Smallint     Not Null Primary Key,
    cantidad       Integer      Not Null);

Begin

/*

Objetivo:    Valida la cantidad de Correos enviados en el día y el período, solicita correo y emite reporte.
Programador: Pedro Felipe Zambrano
Fecha:       01/12/2022

*/

   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    Off

--
-- Incializamos Variables
--

   Select @PnEstatus        = 0,
          @PsMensaje        = Null,
          @w_secuencia      = 0,
          @w_comilla        = Char(39),
          @w_fechaProc      = Isnull(@PdFechaProc, Getdate());

--
-- Incializamos Validaciones
--

   If Not Exists ( Select Top 1 1
                   From   sys.databases a
                   Where  state_desc = 'ONLINE'
                   And    name       = 'SCMBD')
      Begin
         Set Xact_Abort    Off
         Return
      End

--
-- Búsqueda de Parámetros.
--

   Select @w_diaInicioCorte = parametroNumber
   From   dbo.conParametrosGralesTbl
   Where  idParametroGral= 21;
   If @@Rowcount = 0
      Begin
         Set @w_diaInicioCorte = 1
      End

   Set @w_fechaInicio = Convert(Date, Concat(Format(@w_diaInicioCorte, '00'), Substring(Convert(Char(10), @w_fechaProc, 103), 3, 8)), 103)

   If @w_fechaInicio > @w_fechaProc
      Begin
         Set @w_fechaInicio = DateAdd(mm, -1, @w_fechaInicio)
      End

   Select @w_tope = parametroNumber
   From   dbo.conParametrosGralesTbl
   Where  idParametroGral = 20

   Select @w_topeDiario = @w_tope * parametroNumber / 100
   From   dbo.conParametrosGralesTbl
   Where  idParametroGral = 22

   Set @w_tope = @w_tope * 0.9

   Set @w_sql = 'Select a.idAplicacion, Count(1)
                 From   dbo.movEnvioCorreosTbl a
                 Join   dbo.conProcesosTbl b
                 On     b.idProceso = a.idProceso 
                 Where  1  = 1
                 And    Cast(fechaEnvio As Date)'
                
   If @PnTipoConsulta = 1
      Begin
         Set @w_sql = @w_sql + ' Between ' + @w_comilla + Cast(@w_fechaInicio As Varchar) + @w_comilla 
                             + ' And '     + @w_comilla + Cast(@w_fechaProc   As Varchar) + @w_comilla
      End 
   Else
      Begin
         Set]]></definition>
         <parameters>
            <parameter mode="IN" name="@PdFechaProc" type="date"/>
            <parameter mode="IN" name="@PnIdAccion" type="tinyint"/>
            <parameter mode="IN" name="@PnTipoConsulta" type="tinyint"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spp_ValidaArchivo" type="PROCEDURE">
         <comment><![CDATA[Procedimiento de Consulta de la Existencia física de un archivo en el DD.]]></comment>
         <definition language="SQL"><![CDATA[/*
Declare
   @PsArchivo     Varchar(255) = 'RepTiempoProc_0C8C63A3C81148B2.txt',
   @PsRuta        Varchar(255) = 'C:\Sitios\ApiSeguridad\ApiSeguridad-QA\LogsDba\',
   @PsSalida      Integer      = 0,
   @PnEstatus     Integer      = 0,
   @PsMensaje     Varchar(250) = Null
Begin
   Execute dbo.Spp_ValidaArchivo @PsArchivo = @PsArchivo,
                                 @PsRuta    = @PsRuta,
                                 @PsSalida  = @PsSalida  Output,
                                 @PnEstatus = @PnEstatus Output,
                                 @PsMensaje = @PsMensaje Output;

   If @PnEstatus != 0
      Begin
         Select @PnEstatus, @PsMensaje, @PsSalida
      End
   Else
      Begin
         Select @PsSalida
      End

   Return

End
Go

*/

Create   Procedure dbo.Spp_ValidaArchivo
  (@PsArchivo           Varchar(255),
   @PsRuta              Varchar(255),
   @PsSalida            Integer      = 0    Output,
   @PnEstatus           Integer      = 0    Output,
   @PsMensaje           Varchar(250) = Null Output)
As

Declare
   @w_desc_error      Varchar( 250),  
   @w_Error           Integer,
   @w_existe          Integer,
   @w_secuencia       Integer,
   @w_rutaArchivo     Varchar(510)
 
Begin
 
/*
Objetivo: Valida la Existencia física de un archivo en el DD.
Versión: 1

*/

   Set Nocount       On  
   Set Xact_Abort    On  
   Set Ansi_Nulls    Off 
   Set Ansi_Warnings On  
   Set Ansi_Padding  On  

   Select @PnEstatus  = 0,
          @PsMensaje  = '',
          @PsSalida   = 0;

--
--
--

   Create table #TempDatosArch
  (secuencia         Integer Not Null Identity Primary Key,
   existeArchivo     Integer,
   esDirectorio      Integer,
   existeDirectorio  Integer)

   Set @w_rutaArchivo =  @PsRuta + @PsArchivo 

   Begin Try
      Insert into #TempDatosArch
      (existeArchivo, esDirectorio, existeDirectorio)
      Execute sys.xp_fileexist  @w_rutaArchivo
      Set @w_secuencia = @@Identity
   End Try

   Begin Catch
      Select  @w_Error      = @@Error,
              @w_desc_error = Substring (Error_Message(), 1, 230)
   End   Catch

   If Isnull(@w_Error, 0) <> 0
      Begin
         Select @PnEstatus = @w_Error,
                @PsMensaje = 'Error.: ' + Rtrim(Ltrim(Cast(@w_Error As Varchar))) + ' ' + @w_desc_error
         Set Xact_Abort Off
         Return
      End

   Select @PsSalida = existeArchivo 
   From   #TempDatosArch 
   Where  Secuencia = @w_secuencia

   Set Xact_Abort Off
   Return

End]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsArchivo" type="varchar"/>
            <parameter mode="IN" name="@PsRuta" type="varchar"/>
            <parameter mode="INOUT" name="@PsSalida" type="int"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spp_ValidaServicioCorreos" type="PROCEDURE">
         <comment><![CDATA[Proceso de Validación Estatus del Servicio de Correos.]]></comment>
         <definition language="SQL"><![CDATA[/*
Declare
   @w_idProceso           Integer      = 0,
   @PnEstatus             Integer      = 0,
   @PsMensaje             Varchar(250) = Null;

Begin
   Select @w_idProceso = Max(idProceso)
   From   SMBDTI.dbo.logServiciosNotificaCorreosTbl

   Execute Spp_ValidaServicioCorreos @PnEstatus = @PnEstatus Output,
                                     @PsMensaje = @PsMensaje Output

   Select @PnEstatus, @PsMensaje

   Select *
   From   SMBDTI.dbo.logServiciosNotificaCorreosTbl
   Where  idProceso > Isnull(@w_idProceso, 0)

   Return

End
Go

*/

Create   Procedure Spp_ValidaServicioCorreos
  (@PnEstatus             Integer      = 0     Output,
   @PsMensaje             Varchar(250) = Null  Output)
As

Declare
   @w_error             Integer,
   @w_desc_error        Varchar(250),
   @w_usuario           Varchar(Max),
   @w_baseDatos         Sysname,
   @w_sql               NVarchar(1500),
   @w_param             NVarchar( 750),
   @w_comilla           Char(1),
   @w_fechaInicio       Datetime,
   @w_fechaComp         Date,
   @w_servidor          Sysname,
   @w_minutos           Integer,
   @w_registros         Integer,
   @w_idProceso         Integer,
   @w_idUsuarioAct      Integer,
   @w_idEstatus         Tinyint;

Begin
   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    Off
/*

Objetivo:    Proceso de Validación del Servicio de Correos.
Programador: Pedro Felipe Zambrano
Fecha:       06/05/2022

*/


--
-- Incializamos Variables
--

   Select @PnEstatus        = 0,
          @PsMensaje        = Null,
          @w_comilla        = Char(39),
          @w_minutos        = 10,
          @w_servidor       = @@ServerName;

   If Not Exists (Select Top 1 1
                  From   catControlProcesosTbl
                  Where  idProceso         = 15
                  And    idEstatus         = 1)
      Begin
         Set Xact_Abort    Off
         Return
      End

   Select @w_idEstatus = state
   From   sys.databases
   Where  name       = 'NCTI'
   If @@Rowcount = 0
      Begin
         Set Xact_Abort    Off
         Return
      End

   If @w_idEstatus != 0
      Begin
         Set Xact_Abort    Off
         Return
      End

   Select @w_minutos = ParametroNumber
   From   dbo.conParametrosGralesTbl
   Where  idParametroGral = 15

   Select @w_usuario = parametroChar
   From   dbo.conParametrosGralesTbl
   Where  idParametroGral = 9

      Select @w_sql      = 'Select @o_cadena = idUsuarioAct
                            From Openquery(Scsti, ''Select dbo.Fn_Desencripta_cadena(' + @w_usuario + ') idUsuarioAct '')',
             @w_param    = '@o_cadena Varchar(Max) Output '

   Execute Sp_ExecuteSQL @w_sql, @w_param, @o_cadena = @w_usuario Output

   Set @w_idUsuarioAct = Cast(@w_usuario As Integer)

   Begin Try
      Update dbo.catControlProcesosTbl
      Set    ultFechaEjecucion = Getdate()
      Where  idProceso         = 15;
   End Try

   Begin Catch
      Select  @w_Error      = @@Error,
              @w_desc_error = Substring (Error_Message(), 1, 230)

   End   Catch

   If IsNull(@w_Error, 0) <> 0
      Begin
         Select @PnEstatus = @w_Error,
                @PsMensaje = 'Error.: ' + Rtrim(Ltrim(Cast(@w_Error As Varchar))) + ' ' + @w_desc_error

      End

   Create Table #TempMotivosCorreos
   (profile_id       Integer       Not Null,
    descripcion      NVarchar(510) Not Null,
    fechaProgramada  Datetime          Null)

   Insert Into #TempMotivosCorreos
   Select a.profile_id,
          b.description,
          Min(send_request_date)
   From   msdb.dbo.sysmail_allitems a
   Join   msdb.dbo.sysmail_profile b
   On     b.profile_id = a.profile_id
   Where  sent_status != 'sent'
   Group  By a.profile_id, b.description
   Having DateDiff(mi, Min(send_request_date), Getdate()) >= @w_minutos
   If @@Rowcount = 0
      Begin
         Set Xact_Abort]]></definition>
         <parameters>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spp_ValidaServicioNotPush" type="PROCEDURE">
         <comment><![CDATA[Procedimiento de Validación del Servicio de Notificaciones Push.]]></comment>
         <definition language="SQL"><![CDATA[/*
Declare
   @w_idProceso           Integer      = 0,
   @PnEstatus             Integer      = 0,  
   @PsMensaje             Varchar(250) = Null;

Begin
   Select @w_idProceso = Max(idProceso)
   From   SMBDTI.dbo.logServiciosNotificacionesPushTbl

   Execute Spp_ValidaServicioNotPush @PnEstatus = @PnEstatus Output,
                                     @PsMensaje = @PsMensaje Output

   If @PnEstatus != 0
      Begin
         Select @PnEstatus, @PsMensaje
      End

   Select *
   From   SMBDTI.dbo.logServiciosNotificacionesPushTbl
   Where  idProceso > Isnull(@w_idProceso, 0)

   Return

End
Go 
                
*/

Create   Procedure Spp_ValidaServicioNotPush
  (@PnEstatus             Integer      = 0     Output,  
   @PsMensaje             Varchar(250) = Null  Output)                
As

Declare
   @w_error             Integer,
   @w_desc_error        Varchar(250),
   @w_usuario           Varchar(Max),
   @w_baseDatos         Sysname,
   @w_sql               NVarchar(1500),
   @w_param             NVarchar( 750),
   @w_comilla           Char(1),
   @w_fechaInicio       Datetime,
   @w_fechaComp         Date,
   @w_servidor          Sysname,
   @w_minutos           Integer,
   @w_registros         Integer,
   @w_idProceso         Integer,
   @w_idUsuarioAct      Integer,
   @w_idEstatus         Tinyint;

Begin
/*

Objetivo:    Proceso de Validación del Servicio de Notificaciones Push.
Programador: Pedro Felipe Zambrano
Fecha:       06/10/2025

*/
                   
   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    Off  

--
-- Incializamos Variables
--
                         
   Select @PnEstatus        = 0,
          @PsMensaje        = Null,
          @w_comilla        = Char(39),
          @w_servidor       = @@ServerName;

   Select @w_idEstatus = state
   From   sys.databases
   Where  name       = 'NCTI'
   If @@Rowcount = 0
      Begin
         Set Xact_Abort    Off
         Return
      End

   If @w_idEstatus != 0
      Begin
         Set Xact_Abort    Off
         Return
      End

   If Not Exists (Select Top 1 1 
                  From   dbo.catControlProcesosTbl
                  Where  idProceso         = 16
                  And    idEstatus         = 1)
      Begin
         Set Xact_Abort    Off
         Return
      End

   Select @w_minutos = ParametroNumber
   From   dbo.conParametrosGralesTbl
   Where  idParametroGral = 15
   
   Select @w_usuario = parametroChar        
   From   dbo.conParametrosGralesTbl        
   Where  idParametroGral = 9       
   
   Select @w_sql   = 'Select @o_usuario = dbo.Fn_Desencripta_cadena(' + @w_usuario + ') ',        
          @w_param = '@o_usuario Varchar(Max) Output '        
   
   Execute Sp_ExecuteSQL @w_sql, @w_param, @o_usuario = @w_usuario Output        
   
   Set @w_idUsuarioAct = Cast(@w_usuario As Integer) 

   Begin Try 
      Update dbo.catControlProcesosTbl
      Set    ultFechaEjecucion = Getdate()
      Where  idProceso         = 16;
   End Try

   Begin Catch    
      Select  @w_Error      = @@Error,    
              @w_desc_error = Substring (Error_Message(), 1, 230)
  
   End   Catch    
 
   If IsNull(@w_Error, 0) <> 0    
      Begin    
         Select @PnEstatus = @w_Error,    
                @PsMensaje = 'Error.: ' + Rtrim(Ltrim(Cast(@w_Error As Varchar))) + ' ' + @w_desc_error  

      End

   Select @w_idEstatus = state
   From   sys.databases
   Where  name       = Db_name()
   If @@Rowcount = 0
      Begin
         Set Xact_Abort    Off
         Return
      End

   If @w_idEstatus != 0
      Begin
         Set Xact_Abort    Off
         Return
      End

   Create Table #TempMotivosCorreos
   (idAplicacion     Integer      Not Null,
    idMotivoCorreo   Integer      Not Null,
    fechaProgramada  Datetime         Null,
    actividad        Varchar(100)     Null]]></definition>
         <parameters>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spp_analizaEjecucionProcedimientos" type="PROCEDURE">
         <comment><![CDATA[Anális de Ejecuciones de Procedimientos Compilados en Base de Datos Seleccionada.]]></comment>
         <definition language="SQL"><![CDATA[/*

Declare
   @PsBaseDatos                Sysname      = 'SCMBD',
   @PbSolicictaNotificacion    Bit          = 0,
   @PnEstatus                  Integer      = 0,
   @PsMensaje                  Varchar(250);

Begin
   Execute dbo.Spp_analizaEjecucionProcedimientos @PsBaseDatos             = @PsBaseDatos,
                                                  @PbSolicictaNotificacion = @PbSolicictaNotificacion,
                                                  @PnEstatus               = @PnEstatus Output,
                                                  @PsMensaje               = @PsMensaje Output;

   If @PnEstatus != 0
      Begin
         Select @PnEstatus As Estatus, @PsMensaje As Mensaje
     End

   Return

End
Go
*/

Create   Procedure dbo.Spp_analizaEjecucionProcedimientos
  (@PsBaseDatos                Sysname      = Null,
   @PbSolicictaNotificacion    Bit          = 0,
   @PnEstatus                  Integer      = 0    Output,
   @PsMensaje                  Varchar(250) = Null Output)
As

Declare
   @w_error                 Integer,
   @w_desc_error            Varchar(  250),
   @w_usuario               Varchar(  250),
   @w_codigoGrupoCorreo     Varchar(   20),
   @w_grupoCorreo           Varchar(   20),
   @w_ip                    Varchar(   30),
   @w_proceso               Varchar(  100),
   @w_incidencia            Varchar(  100),
   @w_parametros            Varchar(  Max),
   @w_object                Sysname,
   @w_baseDatos             Sysname,
   @w_servidor              Sysname,
   @w_instancia             Sysname,
   @w_ambiente              Sysname,
   @w_tablaLog              Sysname,
   @w_idAplicacion          Integer,
   @w_registros             Integer,
   @w_idUsuarioAct          Integer,
   @w_secuencia             Integer,
   @w_dias                  Integer,
   @w_idProceso             Integer,
   @w_linea                 Integer,
   @w_idMotivoCorreo        Smallint,
   @w_idTipoNotificacion    Tinyint,
   @w_idEstatus             Tinyint,
   @w_fechaProc             Date,
   @w_fechaAct              Datetime,
   @w_fechaProcesoAnt       Datetime,
   @w_sql                   NVarchar( 1500),
   @w_param                 NVarchar(  750),
   @w_estado                NVarchar(  120),
   @w_comilla               Char(1);

Declare
   @w_tempObjetos  Table
   (secuencia        Integer        Not Null Identity (1, 1) Primary Key,
    baseDatos        Sysname        Not Null,
    procedimiento    Sysname        Not Null,
    ultimaEjecucion  Datetime       Not Null,
    cantidad         Integer        Not Null,
    tiempoMinimo     Decimal(18, 2) Not Null Default 0.00,
    tiempoMaximo     Decimal(18, 2) Not Null Default 0.00)

Begin

/*

Objetivo:    Análisis de Ejecuciones de Procedimientos Compilados en Base de Datos.
Programador: Pedro Felipe Zambrano
Fecha:       28/09/2025
Versión:     1

*/

   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    Off


--
-- Inicializamos Variables
--

   Select @PnEstatus            = 0,
          @PsMensaje            = '',
          @w_secuencia          = 0,
          @w_idMotivoCorreo     = 107,
          @w_comilla            = Char(39),
          @w_baseDatos          = Db_name(),
          @PsBaseDatos          = Isnull(@PsBaseDatos, @w_baseDatos),
          @w_fechaAct           = Getdate(),
          @w_servidor           = @@ServerName,
          @w_instancia          = @@servicename,
          @w_idAplicacion       = 27,
          @w_ip                 = dbo.Fn_buscaDireccionIP();

   Select @w_ip = Replace(@w_ip, '(', ''),
          @w_ip = Replace(@w_ip, ')', '');

   If @w_servidor like '%'+ Char(92) + '%'
      Begin
         Set @w_servidor = dbo.Fn_splitStringColumna(@w_servidor, Char(92), 1)
      End

--
-- Validación.
--

   Select @w_estado = state_desc
   From   sys.databases
   Where  name       = @PsBaseDato]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsBaseDatos" type="nvarchar"/>
            <parameter mode="IN" name="@PbSolicictaNotificacion" type="bit"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spp_calculaEspacioDD" type="PROCEDURE">
         <comment><![CDATA[Consulta el Espacio de DD en el servidor de BD.]]></comment>
         <definition language="SQL"><![CDATA[/*
Declare
   @PnEstatus               Integer      = 0,
   @PsMensaje               Varchar(250) = Null

Begin
   Execute dbo.Spp_calculaEspacioDD @PnEstatus = @PnEstatus     Output,
                                    @PsMensaje = @PsMensaje     Output;

   Select @PnEstatus, @PsMensaje

   Return

End
Go
*/

Create   Procedure dbo.Spp_calculaEspacioDD
  (@PnEstatus               Integer      = 0    Output,
   @PsMensaje               Varchar(250) = Null Output)
As

Declare
   @w_error                 Integer,
   @w_desc_error            Varchar(  250),
   @w_indice                Varchar(  100),
   @w_server                Varchar(  100),
   @w_usuario               Varchar(  Max),
   @w_idMotivoCorreo        Smallint,
   @w_idAplicacion          Smallint,
   @w_idTipoNotificacion    Tinyint,
   @w_idEstatus             Tinyint,
   @w_tiempo                Integer,
   @w_idUsuarioAct          Integer,
   @w_grupoCorreo           Varchar(   20),
   @w_ambiente              Varchar(  250),
   @w_incidencia            Varchar(  850),
   @w_parametros            Varchar(  Max),
   @w_proceso               Varchar(  100),
   @w_ip                    Varchar(   20),
   @w_query                 Varchar( 1000),
   @w_sql                   NVarchar(4000),
   @w_param                 NVarchar( 750),
   @w_servidor              Sysname,
   @w_tablaLog              Sysname,
   @w_dbname                Sysname,
   @w_instancia             Sysname,
   @w_base                  Sysname,
   @w_objeto                Sysname,
   @w_fechaAct              Datetime,
   @w_idProceso             Integer,
   @w_secuencia             Integer,
   @w_minimoDispo           Decimal(18, 2),
   @w_totaldisponible       Varchar(20),
   @w_porcentajeLibre       Varchar(20),
   @w_minutosEspera         Integer;

Declare
   @w_tabla          Table
   (totalEspacio     Decimal(18, 2),
    totaldisponible  Decimal(18, 2),
    porcentajeLibre  Decimal(18, 2) Default 0)

Begin
/*

Objetivo:    Validación espacio disponible en disco duro.
Programador: Pedro Felipe Zambrano
Fecha:       08/09/2025
Versión:     1

*/

   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    Off

--
-- Inicializamos Variables
--

   Select @PnEstatus            = 0,
          @PsMensaje            = '',
          @w_server             = @@ServerName,
          @w_servidor           = @@ServerName,
          @w_instancia          = @@servicename,
          @w_idMotivoCorreo     = 110,
          @w_idAplicacion       = 27,
          @w_secuencia          = 0,
          @w_fechaAct           = Getdate(),
          @w_dbname             = Db_name(),
          @w_ip                 = dbo.Fn_buscaDireccionIP(),
          @w_indice             = Substring('IDX_' + Replace(Cast(newid() As Varchar(100)), '-', ''), 1, 30);


   Select @w_ip = Replace(@w_ip, '(', ''),
          @w_ip = Replace(@w_ip, ')', '');

   If @w_server like '%'+ Char(92) + '%'
      Begin
         Set @w_server = dbo.Fn_splitStringColumna(@w_server, Char(92), 1)
      End

--
-- Búsqueda de Parámetros.
--

   Select @w_ambiente = Upper(parametroChar)
   From   dbo.conParametrosGralesTbl
   Where  idParametroGral = 24
   If @@Rowcount = 0
      Begin
         Set @w_ambiente = ''
      End


   Select @w_usuario = parametroChar
   From   dbo.conParametrosGralesTbl
   Where  idParametroGral = 8

   Select @w_sql   = 'Select @o_usuario = dbo.Fn_Desencripta_cadena(' + @w_usuario + ') ',
          @w_param = '@o_usuario Varchar(Max) Output '

   Execute Sp_ExecuteSQL @w_sql, @w_param, @o_usuario = @w_usuario Output

   Set @w_idUsuarioAct = Cast(@w_usuario As Smallint)

   Select @w_minutosEspera = ParametroNumber
   From   dbo.conParametrosGralesTbl
   Where  idParametroGral = 15

   Select @w_minimoDispo = parametroNumber
   From   dbo.conParametrosGralesTbl
   Where  idParametr]]></definition>
         <parameters>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spp_conProcesosTbl" type="PROCEDURE">
         <comment/>
         <definition language="SQL"><![CDATA[CREATE Procedure [dbo].[Spp_conProcesosTbl]        
  (@PnIdProceso               Integer,            
   @PnIdUsuarioAct            Smallint,            
   @PnEstatus                 Integer       = 0   Output,            
   @PsMensaje                 Varchar( 250) = ' ' Output)            
As            
            
Declare            
   @w_desc_error              Varchar( 250), 
   @w_Error                   Integer,
   @w_idEstatus               Bit,
   @w_fecha                   Datetime,
   @w_fechaProgramada         Datetime,
   @w_procedimiento           NVarchar( 250),
   @w_idMotivoCorreo          Integer,
   @w_idUsuario               Smallint,
   @w_parametros              Varchar( 8000)

Begin
   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    On
   Set Ansi_Warnings On
   Set Ansi_Padding  On

   Select @PnEstatus         = 0,
          @w_idEstatus       = 1,
          @PsMensaje         = Null,
          @w_fecha           = Getdate()

--

   Select @w_idMotivoCorreo  = idMotivoCorreo,
          @w_idEstatus       = idEstatus,
          @w_parametros      = parametros, 
          @w_idUsuario       = idUsuario,
          @w_fechaProgramada = fechaProgramada
   From   dbo.conProcesosTbl            
   Where  idProceso = @PnIdProceso
   If @@Rowcount = 0            
      Begin            
         Select @PnEstatus = 2007,            
                @PsMensaje = 'Error.: El Proceso Seleccionado no es Válido'            
            
         Goto Salida            
      End           
          
   Select @w_procedimiento = procedimiento            
   From   dbo.conProcedimientosCorreoTbl            
   Where  idMotivoCorreo = @w_idMotivoCorreo            
   If @@Rowcount = 0            
      Begin            
         Select @PnEstatus = 2007,            
                @PsMensaje = 'Error.: El Motivo de Correo no Tiene Procedimiento Relacionado.'            
            
         Goto Salida            
      End            
  
   If Not Exists (Select Top 1 1         
                  From   Sysobjects            
                  Where  Uid  = 1            
                  And    Type = 'P'            
                  And    Name = @w_procedimiento)            
      Begin            
         Select @PnEstatus = 2007,            
                @PsMensaje = 'Error.: Procedimiento Relacionado al Motivo de Correo no Existe en la Base de Datos.'            
            
         Goto Salida            
      End

    Execute @w_procedimiento @PnIdProceso    = @PnIdProceso,             
                             @PnIdUsuarioAct = @w_idUsuario,            
                             @PnEstatus      = @PnEstatus Output,            
                             @PsMensaje      = @PsMensaje Output            
          
 Salida:            
            
   If @PnEstatus != 0            
      Begin
         Set @w_fecha = Getdate()            
         Update conProcesosTbl            
         Set    idEstatus   = 4,            
                mensajeProc = @PsMensaje,            
                fechaAct    = @w_fecha            
         Where  idProceso   = @PnIdProceso            
            
         Set Xact_Abort Off            
         Return            
      End            
            
   Set Xact_Abort Off            
   Return            
                      
            
   Set Xact_Abort Off            
   Return            
End]]></definition>
         <parameters>
            <parameter mode="IN" name="@PnIdProceso" type="int"/>
            <parameter mode="IN" name="@PnIdUsuarioAct" type="smallint"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spp_enviaCorreoIncidencia" type="PROCEDURE">
         <comment><![CDATA[Proceso de Generación de Notificaciones por Incidencias.]]></comment>
         <definition language="SQL"><![CDATA[/*  
  
Declare  
   @PnIdProceso                   Integer       = 1217274,  
   @PnEstatus                     Integer       = 0,  
   @PsMensaje                     Varchar( 250) = '';  
  
Begin  
   Execute dbo.Spp_enviaCorreoIncidencia @PnIdProceso = @PnIdProceso,  
                                         @PnEstatus   = @PnEstatus Output,  
                                         @PsMensaje   = @PsMensaje Output;  
  
   Select @PnEstatus, @PsMensaje  
  
   Return  
  
End  
Go  
  
*/  
  
Create   Procedure  dbo.Spp_enviaCorreoIncidencia  
  (@PnIdProceso                   Integer       = 0,  
   @PnIdUsuarioAct                Integer       = Null,  
   @PnEstatus                     Integer       = 0  Output,  
   @PsMensaje                     Varchar( 250) = '' Output)  
  
As  
  
Declare  
   @w_Error                 Integer,  
   @w_desc_error            Varchar( 250),  
   @w_parametros            Varchar( Max),  
   @w_titulo                Varchar(1000),  
   @w_cuerpo                Varchar(1000),  
   @w_body                  Varchar(1000),  
   @w_body2                 Varchar(1000),  
   @w_body3                 Varchar(1000),  
   @w_html                  Varchar( Max),  
   @w_incidencia            Varchar( 250),  
   @w_servidor              Varchar( 100),  
   @w_grupoCorreo           Varchar(  20),  
   @w_correo                Varchar( 250),  
   @w_fechaProceso          Varchar(  10),  
   @w_saludo                Varchar( 100),  
   @w_nombre                Varchar( 100),  
   @w_idSession             Varchar(  30),  
   @w_url                   Varchar( 250),  
   @w_url2                  Varchar( 250),  
   @w_ambiente              Varchar(  80),  
   @w_usuario               Varchar( Max),  
   @w_sql                   NVarchar(1500),  
   @w_param                 NVarchar( 750),  
   @w_idUsuario             Integer,  
   @w_idGrupo               Integer,  
   @w_registros             Integer,  
   @w_registros2            Integer,  
   @w_secuencia             Integer,  
   @w_mailitem_id           Integer,  
   @w_idAplicacion          Integer,  
   @w_idProceso             Integer,  
   @w_idEstatus             Tinyint,  
   @w_idUsuarioAct          Integer,  
   @w_idTipoNotificacion    Smallint,  
   @w_idMotivoCorreo        Smallint,  
   @w_fechaAct              Datetime,  
   @w_tabla                 Sysname,  
   @w_account_name          Sysname;  
  
Begin  
/*  
  
Objetivo:    Generación y Envío de Notificaciones por Incidencias de Base de Datos.  
Programador: Pedro Felipe Zambrano  
Fecha:       31/08/2022  
Versión:     2  
  
*/  
   Set Nocount       On  
   Set Xact_Abort    On  
   Set Ansi_Nulls   Off  
  
   Select @PnEstatus   = 0,  
          @PsMensaje   = '',  
          @w_registros = 0,  
          @w_secuencia = 0,  
          @w_saludo    = dbo.Fn_calculaSaludo();  
  
   If @PnIdUsuarioAct Is Null  
      Begin  
         Select @w_usuario = parametroChar  
         From   dbo.conParametrosGralesTbl  
         Where  idParametroGral = 9  
  
         Select @w_sql   = 'Select @o_usuario = dbo.Fn_Desencripta_cadena(' + @w_usuario + ') ',  
                @w_param = '@o_usuario Varchar(Max) Output '  
  
         Execute Sp_ExecuteSQL @w_sql, @w_param, @o_usuario = @w_usuario Output  
  
         Set @w_idUsuarioAct = Cast(@w_usuario As Smallint)  
      End  
   Else  
      Begin  
         Set @w_idUsuarioAct = @PnIdUsuarioAct  
      End  
  
--  
-- Generación de Tabla Temporal  
--  
  
   Create Table #TempGrupoReceptorCorreoDet  
   (secuencia    Integer       Not Null Identity(1, 1) Primary Key,  
    idReceptor   Integer       Not Null)  
  
   Select @w_idSession          = idSession,  
          @w_idMotivoCorreo     = idMotivoCorreo,  
          @w_parametros         = parametros,  
          @w_idTipoNotificacion = idTipoNoti]]></definition>
         <parameters>
            <parameter mode="IN" name="@PnIdProceso" type="int"/>
            <parameter mode="IN" name="@PnIdUsuarioAct" type="int"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spp_notificaAnalisisEjecucionProc" type="PROCEDURE">
         <comment><![CDATA[Consulta a las Ejecuciones de Procedimientos de Base de Datos.]]></comment>
         <definition language="SQL"><![CDATA[/*

Declare
   @PnIdProceso             Integer      = 3518128,
   @PnIdUsuarioAct          Integer      = 18,
   @PnEstatus               Integer      = 0,
   @PsMensaje               Varchar(250);

Begin
   Execute Spp_notificaAnalisisEjecucionProc @PnIdProceso    = @PnIdProceso,
                                             @PnIdUsuarioAct = @PnIdUsuarioAct,
                                             @PnEstatus      = @PnEstatus Output,
                                             @PsMensaje      = @PsMensaje Output;

   If @PnEstatus != 0
      Begin
         Select @PnEstatus As Estatus, @PsMensaje As Mensaje
     End

   Return

End
Go
*/

Create   Procedure Spp_notificaAnalisisEjecucionProc
  (@PnIdProceso             Integer,
   @PnIdUsuarioAct          Integer,
   @PnEstatus               Integer      = 0    Output,
   @PsMensaje               Varchar(250) = Null Output)
As

Declare
   @w_error                    Integer,
   @w_desc_error               Varchar(  250),
   @w_registros                Integer,
   @w_secuencia                Integer,
   @w_sql                      NVarchar( 1500),
   @w_param                    NVarchar(  750),
   @w_comilla                  Char(1),
   @w_basedatos                Sysname,
   @w_tablaLog                 Sysname,
--
   @w_idSession                Varchar(  64),
   @w_idEstatus                Tinyint,
   @w_idGrupo                  Integer,
   @w_idMotivoCorreo           Integer,
   @w_parametros               Varchar( Max),
   @w_account_name             Sysname,
   @w_grupoCorreo              Varchar(  20),
   @w_idAplicacion             Integer,
   @w_fechaProc                Date,
   @w_fechaInicial             Date,
   @w_fechaTermino             Date,
--
   @w_comando                  Varchar(8000),
   @w_salida                   Varchar(8000),
   @w_consultaTexto            NVarchar(2048),
   @w_consultaEncriptada       NVarchar(4000),
   @w_html                     Nvarchar(MAX),
   @w_idObject                 Integer,
   @w_archivoXML               Xml,
   @w_cadenaEncriptada         Varchar(4000),
   @w_URL                      Varchar( 750),
--
   @w_procedimiento            Sysname,
   @w_ultimaEjecucion          Datetime,
   @w_cantidadEjecuciones      Integer,
   @w_tiempoMinimoEjecucion    Decimal(18, 2),
   @w_tiempoMaximoEjecucion    Decimal(18, 2),
--
   @w_idReceptor               Integer,
   @w_aplicacion               Varchar(100),
   @w_cuerpo                   Varchar(Max),
   @w_body                     Varchar(Max),
   @w_saludo                   Varchar(100),
   @w_nombre                   Varchar(100),
   @w_correo                   Varchar(100),
   @w_asunto                   Varchar(250),
   @w_ipOrigen                 Varchar( 20),
   @w_server                   Sysname,
   @w_instancia                Sysname,
   @w_ambiente                 Sysname,
   @w_linea                    Integer,
   @w_idCorreo                 Integer,
   @w_registrosUser            Integer,
   @w_idProceso                Integer;

Declare
   @w_UsuarioReceptorCorreo Table
   (secuencia    Integer       Not Null Identity(1, 1) Primary Key,
    idReceptor   Integer       Not Null);

Declare
   @w_GrupoReceptorCorreoDet Table
   (secuencia    Integer       Not Null Identity(1, 1) Primary Key,
    idReceptor   Integer       Not Null,
    correo       Varchar(250)      Null,
    nombre       Varchar(100)      Null);

Begin

-- Objetivo:    Genera Notificación de las Estadisticas de Ejecuciones de Procedimientos Compilados en Base de Datos en un Período.
-- Programador: Pedro Felipe Zambrano
-- Fecha:       31/10/2025
-- Versión:     1
--

   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    Off

--
-- Inicializamos Variables
--

   Select @PnEstatus            = 0,
          @PsMensaje            = '',
          @w_comilla            =]]></definition>
         <parameters>
            <parameter mode="IN" name="@PnIdProceso" type="int"/>
            <parameter mode="IN" name="@PnIdUsuarioAct" type="int"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spp_notificaAnalisisLinkedServers" type="PROCEDURE">
         <comment><![CDATA[Genera Notificación de Problemas de conexión de los Linked Server.]]></comment>
         <definition language="SQL"><![CDATA[/*

Declare
   @PnIdProceso             Integer      = 0,
   @PnEstatus               Integer      = 0,
   @PsMensaje               Varchar(250);

Begin
   Execute dbo.Spp_notificaAnalisisLinkedServers @PnIdProceso    = @PnIdProceso,
                                                 @PnEstatus      = @PnEstatus Output,
                                                 @PsMensaje      = @PsMensaje Output;

   If @PnEstatus != 0
      Begin
         Select @PnEstatus As Estatus, @PsMensaje As Mensaje
     End

   Return

End
Go
*/

Create   Procedure dbo.Spp_notificaAnalisisLinkedServers
  (@PnIdProceso             Integer,
   @PnEstatus               Integer      = 0    Output,
   @PsMensaje               Varchar(250) = Null Output)
As

Declare
   @w_error                    Integer,
   @w_desc_error               Varchar(  250),
   @w_registros                Integer,
   @w_secuencia                Integer,
   @w_sql                      NVarchar( 1500),
   @w_param                    NVarchar(  750),
   @w_comilla                  Char(1),
   @w_basedatos                Sysname,
   @w_tablaLog                 Sysname,
--
   @w_idSession                Varchar(  64),
   @w_idEstatus                Tinyint,
   @w_idGrupo                  Integer,
   @w_idMotivoCorreo           Integer,
   @w_parametros               Varchar( Max),
   @w_account_name             Sysname,
   @w_grupoCorreo              Varchar(  20),
   @w_idAplicacion             Integer,
   @w_fechaInicial             Date,
   @w_fechaTermino             Date,
--
   @w_comando                  Varchar(8000),
   @w_salida                   Varchar(8000),
   @w_consultaTexto            NVarchar(2048),
   @w_consultaEncriptada       NVarchar(4000),
   @w_html                     Nvarchar(Max),
   @w_idObject                 Integer,
   @w_archivoXML               Xml,
   @w_cadenaEncriptada         Varchar(4000),
   @w_URL                      Varchar( 750),
   @w_incidencia               Varchar( 250),
--
   @w_procedimiento            Sysname,
   @w_ultimaEjecucion          Datetime,
   @w_cantidadEjecuciones      Integer,
   @w_tiempoMinimoEjecucion    Decimal(18, 2),
   @w_tiempoMaximoEjecucion    Decimal(18, 2),
--
   @w_idReceptor               Integer,
   @w_aplicacion               Varchar(100),
   @w_cuerpo                   Varchar(Max),
   @w_body                     Varchar(Max),
   @w_usuario                  Varchar(Max),
   @w_saludo                   Varchar(100),
   @w_nombre                   Varchar(100),
   @w_correo                   Varchar(100),
   @w_asunto                   Varchar(250),
   @w_ipOrigen                 Varchar( 20),
   @w_server                   Sysname,
   @w_instancia                Sysname,
   @w_ambiente                 Sysname,
   @w_linea                    Integer,
   @w_idCorreo                 Integer,
   @w_registrosUser            Integer,
   @w_idProceso                Integer,
   @w_idUsuarioAct             Integer;

Declare
   @w_UsuarioReceptorCorreo Table
   (secuencia    Integer       Not Null Identity(1, 1) Primary Key,
    idReceptor   Integer       Not Null);

Declare
   @w_GrupoReceptorCorreoDet Table
   (secuencia    Integer       Not Null Identity(1, 1) Primary Key,
    idReceptor   Integer       Not Null,
    correo       Varchar(250)      Null,
    nombre       Varchar(100)      Null);

Begin

-- Objetivo:    Genera Notificación de Problemas de conexión de los Linked Server.
-- Programador: Pedro Felipe Zambrano
-- Fecha:       31/10/2025
-- Versión:     1
--

   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    Off

--
-- Inicializamos Variables
--

   Select @PnEstatus            = 0,
          @PsMensaje            = '',
          @w_comilla            = Char(39),
          @w_secuencia          = 0,
          @w_saludo             = dbo.Fn_calculaSaludo(),]]></definition>
         <parameters>
            <parameter mode="IN" name="@PnIdProceso" type="int"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spp_notificaJobsNoEjecutados" type="PROCEDURE">
         <comment><![CDATA[Genera Notificación de Problemas de conexión de los Linked Server.]]></comment>
         <definition language="SQL"><![CDATA[/*

Declare
   @PnIdProceso             Integer      = 0,
   @PnEstatus               Integer      = 0,
   @PsMensaje               Varchar(250) = Null;

Begin
   Execute dbo.Spp_notificaJobsNoEjecutados @PnIdProceso    = @PnIdProceso,
                                            @PnEstatus      = @PnEstatus Output,
                                            @PsMensaje      = @PsMensaje Output;

   If @PnEstatus != 0
      Begin
         Select @PnEstatus As Estatus, @PsMensaje As Mensaje
     End

   Return

End
Go
*/

Create   Procedure dbo.Spp_notificaJobsNoEjecutados
  (@PnIdProceso             Integer,
   @PnEstatus               Integer      = 0    Output,
   @PsMensaje               Varchar(250) = Null Output)
As

Declare
   @w_error                    Integer,
   @w_desc_error               Varchar(  250),
   @w_registros                Integer,
   @w_secuencia                Integer,
   @w_sql                      NVarchar( 1500),
   @w_param                    NVarchar(  750),
   @w_comilla                  Char(1),
   @w_basedatos                Sysname,
   @w_tablaLog                 Sysname,
--
   @w_idSession                Varchar(  64),
   @w_idEstatus                Tinyint,
   @w_idGrupo                  Integer,
   @w_idMotivoCorreo           Integer,
   @w_parametros               Varchar( Max),
   @w_account_name             Sysname,
   @w_grupoCorreo              Varchar(  20),
   @w_idAplicacion             Integer,
   @w_fechaInicial             Date,
   @w_fechaTermino             Date,
--
   @w_comando                  Varchar(8000),
   @w_salida                   Varchar(8000),
   @w_consultaTexto            NVarchar(2048),
   @w_consultaEncriptada       NVarchar(4000),
   @w_html                     Nvarchar(Max),
   @w_idObject                 Integer,
   @w_archivoXML               Xml,
   @w_cadenaEncriptada         Varchar(4000),
   @w_URL                      Varchar( 750),
   @w_incidencia               Varchar( 250),
--
   @w_procedimiento            Sysname,
   @w_ultimaEjecucion          Datetime,
   @w_cantidadEjecuciones      Integer,
   @w_tiempoMinimoEjecucion    Decimal(18, 2),
   @w_tiempoMaximoEjecucion    Decimal(18, 2),
--
   @w_idReceptor               Integer,
   @w_aplicacion               Varchar(100),
   @w_cuerpo                   Varchar(Max),
   @w_body                     Varchar(Max),
   @w_usuario                  Varchar(Max),
   @w_saludo                   Varchar(100),
   @w_nombre                   Varchar(100),
   @w_correo                   Varchar(100),
   @w_asunto                   Varchar(250),
   @w_ipOrigen                 Varchar( 20),
   @w_server                   Sysname,
   @w_instancia                Sysname,
   @w_ambiente                 Sysname,
   @w_linea                    Integer,
   @w_idCorreo                 Integer,
   @w_registrosUser            Integer,
   @w_idProceso                Integer,
   @w_idUsuarioAct             Integer;

Declare
   @w_UsuarioReceptorCorreo Table
   (secuencia    Integer       Not Null Identity(1, 1) Primary Key,
    idReceptor   Integer       Not Null);

Declare
   @w_GrupoReceptorCorreoDet Table
   (secuencia    Integer       Not Null Identity(1, 1) Primary Key,
    idReceptor   Integer       Not Null,
    correo       Varchar(250)      Null,
    nombre       Varchar(100)      Null);

Begin

-- Objetivo:    Genera Notificación de Problemas de conexión de los Linked Server.
-- Programador: Pedro Felipe Zambrano
-- Fecha:       31/10/2025
-- Versión:     1
--

   Set Nocount         On
   Set Xact_Abort      On
   Set Ansi_Nulls      Off
   Set Ansi_Warnings   OFF

--
-- Inicializamos Variables
--

   Select @PnEstatus            = 0,
          @PsMensaje            = '',
          @w_comilla            = Char(39),
          @w_secuencia          = 0,
          @w_saludo             = dbo.Fn]]></definition>
         <parameters>
            <parameter mode="IN" name="@PnIdProceso" type="int"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spp_notificaMantenimientoDepuraTablas" type="PROCEDURE">
         <comment><![CDATA[Genera Notifición del Proceso de Depuración de Datos.]]></comment>
         <definition language="SQL"><![CDATA[/*

Declare
   @PnIdProceso             Integer      = 0,
   @PnIdUsuarioAct          Integer      = 18,
   @PnEstatus               Integer      = 0,
   @PsMensaje               Varchar(250);

Begin
   Execute Spp_notificaMantenimientoDepuraTablas @PnIdProceso    = @PnIdProceso,
                                             @PnIdUsuarioAct = @PnIdUsuarioAct,
                                             @PnEstatus      = @PnEstatus Output,
                                             @PsMensaje      = @PsMensaje Output;

   If @PnEstatus != 0
      Begin
         Select @PnEstatus As Estatus, @PsMensaje As Mensaje
     End

   Return

End
Go
*/

Create   Procedure Spp_notificaMantenimientoDepuraTablas
  (@PnIdProceso                Integer,
   @PnIdUsuarioAct             Integer,
   @PnEstatus                  Integer      = 0    Output,
   @PsMensaje                  Varchar(250) = Null Output)
As

Declare
   @w_error                    Integer,
   @w_desc_error               Varchar(  250),
   @w_registros                Integer,
   @w_secuencia                Integer,
   @w_sql                      NVarchar( 1500),
   @w_param                    NVarchar(  750),
   @w_comilla                  Char(1),
   @w_basedatos                Sysname,
   @w_tablaLog                 Sysname,
   @w_idProceso                Bigint,
   @w_linea                    Integer,
--
   @w_idSession                Varchar(  64),
   @w_idEstatus                Tinyint,
   @w_idGrupo                  Integer,
   @w_idMotivoCorreo           Integer,
   @w_parametros               Varchar( Max),
   @w_account_name             Sysname,
   @w_grupoCorreo              Varchar(  20),
   @w_idAplicacion             Integer,
   @w_fechaProc                Date,
   @w_fechaInicial             Date,
   @w_ambiente                 Varchar(100),
   @w_instancia                Sysname,
--

   @w_html                     Nvarchar( Max),

--

   @w_idAplicacionBD           Integer,
   @w_idReceptor               Integer,
   @w_aplicacion               Varchar(100),
   @w_cuerpo                   Varchar(Max),
   @w_body                     Varchar(Max),
   @w_saludo                   Varchar(100),
   @w_nombre                   Varchar(100),
   @w_correo                   Varchar(100),
   @w_asunto                   Varchar(250),
   @w_ipOrigen                 Varchar( 30),
   @w_server                   Sysname,
   @w_servidorOrigen           Sysname,
   @w_idCorreo                 Integer,
   @w_registrosUser            Integer;


Begin

/*

Objetivo:    Genera Notificación de las Objetos de la Base de Datos no Válidos.
Programador: Pedro Felipe Zambrano
Fecha:       31/10/2022
Versión:     1


*/

   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    Off

--
-- Inicializamos Variables
--

   Select @PnEstatus            = 0,
          @PsMensaje            = '',
          @w_comilla            = Char(39),
          @w_secuencia          = 0,
          @w_saludo             = '<p>' + dbo.Fn_calculaSaludo(),
          @w_server             = @@Servername;

--
-- Búsqueda de Parámetros.
--

   Select @w_idSession          = idSession,
          @w_idMotivoCorreo     = idMotivoCorreo,
          @w_parametros         = parametros,
          @w_idEstatus          = idEstatus
   From   dbo.conProcesosTbl
   Where  idProceso = @PnIdProceso
   If @@Rowcount = 0
      Begin
         Select @PnEstatus = 3000,
                @PsMensaje = dbo.Fn_Busca_MensajeError(@PnEstatus);

         Set Xact_Abort Off
         Return
      End

   If @w_idEstatus != 1
      Begin
         Select @PnEstatus = Case When @w_idEstatus = 2
                                  Then 2999
                                  Else 3004
                             End,
                @PsMensaje = dbo.Fn_Busca_MensajeError(@PnEstatus);

         Set Xa]]></definition>
         <parameters>
            <parameter mode="IN" name="@PnIdProceso" type="int"/>
            <parameter mode="IN" name="@PnIdUsuarioAct" type="int"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spp_notificaValidacionBloqueos" type="PROCEDURE">
         <comment><![CDATA[Genera Notificación de Problemas de conexión de los Linked Server.]]></comment>
         <definition language="SQL"><![CDATA[/*

Declare
   @PnIdProceso             Integer      = 1,
   @PnEstatus               Integer      = 0,
   @PsMensaje               Varchar(250);

Begin
   Execute dbo.Spp_notificaValidacionBloqueos @PnIdProceso    = @PnIdProceso,
                                                 @PnEstatus      = @PnEstatus Output,
                                                 @PsMensaje      = @PsMensaje Output;

   If @PnEstatus != 0
      Begin
         Select @PnEstatus As Estatus, @PsMensaje As Mensaje
     End

   Return

End
Go
*/

Create   Procedure dbo.Spp_notificaValidacionBloqueos
  (@PnIdProceso             Integer,
   @PnEstatus               Integer      = 0    Output,
   @PsMensaje               Varchar(250) = Null Output)
As

Declare
   @w_error                    Integer,
   @w_desc_error               Varchar(  250),
   @w_registros                Integer,
   @w_secuencia                Integer,
   @w_sql                      NVarchar( 1500),
   @w_param                    NVarchar(  750),
   @w_comilla                  Char(1),
   @w_basedatos                Sysname,
   @w_tablaLog                 Sysname,
--
   @w_idSession                Varchar(  64),
   @w_idEstatus                Tinyint,
   @w_idGrupo                  Integer,
   @w_idMotivoCorreo           Integer,
   @w_parametros               Varchar( Max),
   @w_account_name             Sysname,
   @w_grupoCorreo              Varchar(  20),
   @w_idAplicacion             Integer,
   @w_fechaInicial             Date,
   @w_fechaTermino             Date,
--
   @w_comando                  Varchar(8000),
   @w_salida                   Varchar(8000),
   @w_consultaTexto            NVarchar(2048),
   @w_consultaEncriptada       NVarchar(4000),
   @w_html                     Nvarchar(Max),
   @w_idObject                 Integer,
   @w_archivoXML               Xml,
   @w_cadenaEncriptada         Varchar(4000),
   @w_URL                      Varchar( 750),
   @w_incidencia               Varchar( 250),
--
   @w_procedimiento            Sysname,
   @w_ultimaEjecucion          Datetime,
   @w_cantidadEjecuciones      Integer,
   @w_tiempoMinimoEjecucion    Decimal(18, 2),
   @w_tiempoMaximoEjecucion    Decimal(18, 2),
--
   @w_idReceptor               Integer,
   @w_aplicacion               Varchar(100),
   @w_cuerpo                   Varchar(Max),
   @w_body                     Varchar(Max),
   @w_usuario                  Varchar(Max),
   @w_saludo                   Varchar(100),
   @w_nombre                   Varchar(100),
   @w_correo                   Varchar(100),
   @w_asunto                   Varchar(250),
   @w_ipOrigen                 Varchar( 20),
   @w_server                   Sysname,
   @w_instancia                Sysname,
   @w_ambiente                 Sysname,
   @w_linea                    Integer,
   @w_idCorreo                 Integer,
   @w_registrosUser            Integer,
   @w_idProceso                Integer,
   @w_idUsuarioAct             Integer;

Declare
   @w_UsuarioReceptorCorreo Table
   (secuencia    Integer       Not Null Identity(1, 1) Primary Key,
    idReceptor   Integer       Not Null);

Declare
   @w_GrupoReceptorCorreoDet Table
   (secuencia    Integer       Not Null Identity(1, 1) Primary Key,
    idReceptor   Integer       Not Null,
    correo       Varchar(250)      Null,
    nombre       Varchar(100)      Null);

Begin

-- Objetivo:    Genera Notificación de Consultas y Procesos Bloqueados.
-- Programador: Pedro Felipe Zambrano
-- Fecha:       31/10/2025
-- Versión:     1
--

   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    Off

--
-- Inicializamos Variables
--

   Select @PnEstatus            = 0,
          @PsMensaje            = '',
          @w_comilla            = Char(39),
          @w_secuencia          = 0,
          @w_saludo             = dbo.Fn_calculaSaludo(),
          @w_server]]></definition>
         <parameters>
            <parameter mode="IN" name="@PnIdProceso" type="int"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spp_reportaIncEspacioDD" type="PROCEDURE">
         <comment><![CDATA[Generación de Notificaciones por Incidencias de Disponibilidad de Espacio libre en DD.]]></comment>
         <definition language="SQL"><![CDATA[/*

Declare
   @PnIdProceso                   Integer       = 1,
   @PnEstatus                     Integer       = 0,
   @PsMensaje                     Varchar( 250) = '';

Begin
   Execute dbo.Spp_reportaIncEspacioDD @PnIdProceso = @PnIdProceso,
                                         @PnEstatus   = @PnEstatus Output,
                                         @PsMensaje   = @PsMensaje Output;

   Select @PnEstatus, @PsMensaje

   Return

End
Go

*/

Create   Procedure dbo.Spp_reportaIncEspacioDD
  (@PnIdProceso                   Integer       = 0,
   @PnIdUsuarioAct                Integer       = Null,
   @PnEstatus                     Integer       = 0  Output,
   @PsMensaje                     Varchar( 250) = '' Output)

As

Declare
   @w_Error                 Integer,
   @w_desc_error            Varchar( 250),
   @w_parametros            Varchar( Max),
   @w_titulo                Varchar( 200),
   @w_cuerpo                Varchar(1000),
   @w_body                  Varchar(1000),
   @w_body2                 Varchar(1000),
   @w_body3                 Varchar(1000),
   @w_html                  Varchar(8000),
   @w_html2                 Varchar(8000),
   @w_incidencia            Varchar( 250),
   @w_servidor              Varchar( 100),
   @w_grupoCorreo           Varchar(  20),
   @w_ip                    Varchar(  30),
   @w_correo                Varchar( 250),
   @w_fechaProceso          Varchar(  10),
   @w_saludo                Varchar( 100),
   @w_nombre                Varchar( 100),
   @w_idSession             Varchar(  30),
   @w_url                   Varchar( 250),
   @w_url2                  Varchar( 250),
   @w_nota                  Varchar( 100),
   @w_observacion1          Varchar( 250),
   @w_observacion2          Varchar( 250),
   @w_usuario               Varchar( Max),
   @w_query                 Varchar(1000),
   @w_ambiente              Varchar(  80),
   @w_instancia             Varchar(  80),
   @w_sql                   NVarchar(1500),
   @w_param                 NVarchar( 750),
   @w_idUsuario             Integer,
   @w_idGrupo               Integer,
   @w_registros             Integer,
   @w_secuencia             Integer,
   @w_mailitem_id           Integer,
   @w_idProceso             Integer,
   @w_idEstatus             Tinyint,
   @w_idUsuarioAct          Integer,
   @w_idTipoNotificacion    Smallint,
   @w_idMotivoCorreo        Smallint,
   @w_idAplicacion          Smallint,
   @w_fechaAct              Datetime,
   @w_account_name          Sysname,
   @w_tabla                 Sysname,
   @w_objeto                Sysname,
   @w_totaldisponible       Varchar(80),
   @w_porcentajeLibre       Varchar(80);

Begin
/*

Objetivo:    Generación de Notificaciones por Incidencias en Tiempos de Proceso.
Programador: Pedro Felipe Zambrano
Fecha:       05/05/2025


*/

   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    On
   Set Ansi_Warnings On
   Set Ansi_Padding  On

   Select @PnEstatus   = 0,
          @PsMensaje   = '',
          @w_registros = 0,
          @w_secuencia = 0,
          @w_saludo    = dbo.Fn_calculaSaludo();

   If @PnIdUsuarioAct Is Null
      Begin
         Select @w_usuario = parametroChar
         From   dbo.conParametrosGralesTbl
         Where  idParametroGral = 8

         Select @w_sql   = 'Select @o_usuario = dbo.Fn_Desencripta_cadena(' + @w_usuario + ') ',
                @w_param = '@o_usuario Varchar(Max) Output '

         Execute Sp_ExecuteSQL @w_sql, @w_param, @o_usuario = @w_usuario Output

         Set @w_idUsuarioAct = Cast(@w_usuario As Smallint)
      End
   Else
      Begin
         Set @w_idUsuarioAct = @PnIdUsuarioAct
      End

--
-- Generación de Tabla Temporal
--

   Create Table #TempGrupoReceptorCorreoDet
   (secuencia    Integer       Not Null Identity(1, 1) Primary Key,
    idReceptor   Integer       Not Null)

--
-- Búsqu]]></definition>
         <parameters>
            <parameter mode="IN" name="@PnIdProceso" type="int"/>
            <parameter mode="IN" name="@PnIdUsuarioAct" type="int"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spp_reportaIncTiempoProc" type="PROCEDURE">
         <comment><![CDATA[Proceso de Generación de Notificaciones por Incidencias de Tiempos de Proceso.]]></comment>
         <definition language="SQL"><![CDATA[/*

Declare
   @PnIdProceso                   Integer       = 2150801,
   @PnEstatus                     Integer       = 0,
   @PsMensaje                     Varchar( 250) = '';

Begin
   Execute dbo.Spp_reportaIncTiempoProc @PnIdProceso = @PnIdProceso,
                                         @PnEstatus   = @PnEstatus Output,
                                         @PsMensaje   = @PsMensaje Output;

   Select @PnEstatus, @PsMensaje

   Return

End
Go

*/

Create   Procedure dbo.Spp_reportaIncTiempoProc
  (@PnIdProceso                   Integer       = 0,
   @PnIdUsuarioAct                Integer       = Null,
   @PnEstatus                     Integer       = 0  Output,
   @PsMensaje                     Varchar( 250) = '' Output)

As

Declare
   @w_Error                 Integer,
   @w_desc_error            Varchar( 250),
   @w_parametros            Varchar( Max),
   @w_titulo                Varchar( 200),
   @w_cuerpo                Varchar(1000),
   @w_body                  Varchar(1000),
   @w_body2                 Varchar(1000),
   @w_body3                 Varchar(1000),
   @w_html                  Varchar(8000),
   @w_html2                 Varchar(8000),
   @w_incidencia            Varchar( 250),
   @w_servidor              Varchar( 100),
   @w_grupoCorreo           Varchar(  20),
   @w_ip                    Varchar(  30),
   @w_correo                Varchar( 250),
   @w_fechaProceso          Varchar(  10),
   @w_saludo                Varchar( 100),
   @w_nombre                Varchar( 100),
   @w_idSession             Varchar(  30),
   @w_url                   Varchar( 250),
   @w_url2                  Varchar( 250),
   @w_nota                  Varchar( 100),
   @w_observacion1          Varchar( 250),
   @w_observacion2          Varchar( 250),
   @w_usuario               Varchar( Max),
   @w_query                 Varchar(1000),
   @w_ambiente              Varchar(  80),
   @w_instancia             Varchar(  80),
   @w_sql                   NVarchar(1500),
   @w_param                 NVarchar( 750),
   @w_idUsuario             Integer,
   @w_idGrupo               Integer,
   @w_registros             Integer,
   @w_secuencia             Integer,
   @w_mailitem_id           Integer,
   @w_idProceso             Integer,
   @w_idEstatus             Tinyint,
   @w_idUsuarioAct          Integer,
   @w_idTipoNotificacion    Smallint,
   @w_idMotivoCorreo        Smallint,
   @w_idAplicacion          Smallint,
   @w_fechaAct              Datetime,
   @w_account_name          Sysname,
   @w_tabla                 Sysname,
   @w_objeto                Sysname;

Begin
/*

Objetivo:    Generación de Notificaciones por Incidencias en Tiempos de Proceso.
Programador: Pedro Felipe Zambrano
Fecha:       05/05/2025


*/

   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    On
   Set Ansi_Warnings On
   Set Ansi_Padding  On

   Select @PnEstatus   = 0,
          @PsMensaje   = '',
          @w_registros = 0,
          @w_secuencia = 0,
          @w_saludo    = dbo.Fn_calculaSaludo();

   If @PnIdUsuarioAct Is Null
      Begin
         Select @w_usuario = parametroChar
         From   dbo.conParametrosGralesTbl
         Where  idParametroGral = 8

         Select @w_sql   = 'Select @o_usuario = dbo.Fn_Desencripta_cadena(' + @w_usuario + ') ',
                @w_param = '@o_usuario Varchar(Max) Output '

         Execute Sp_ExecuteSQL @w_sql, @w_param, @o_usuario = @w_usuario Output

         Set @w_idUsuarioAct = Cast(@w_usuario As Smallint)
      End
   Else
      Begin
         Set @w_idUsuarioAct = @PnIdUsuarioAct
      End

--
-- Generación de Tabla Temporal
--

   Create Table #TempGrupoReceptorCorreoDet
   (secuencia    Integer       Not Null Identity(1, 1) Primary Key,
    idReceptor   Integer       Not Null)

--
-- Búsqueda de Parametros
--

   Select @w_idSession          = idSession,]]></definition>
         <parameters>
            <parameter mode="IN" name="@PnIdProceso" type="int"/>
            <parameter mode="IN" name="@PnIdUsuarioAct" type="int"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spp_validaBloqueos" type="PROCEDURE">
         <comment><![CDATA[Procedimiento de Validación de Procesos Bloqueados.]]></comment>
         <definition language="SQL"><![CDATA[/*
Declare
   @PnEstatus               Integer      = 0,
   @PsMensaje               Varchar(250) = Null

Begin
   Execute dbo.Spp_validaBloqueos @PnEstatus = @PnEstatus     Output,
                                  @PsMensaje = @PsMensaje     Output;

   Select @PnEstatus, @PsMensaje

   Return

End
Go
*/

Create   Procedure dbo.Spp_validaBloqueos
  (@PnEstatus               Integer      = 0    Output,
   @PsMensaje               Varchar(250) = Null Output)
As

Declare
   @w_error                 Integer,
   @w_desc_error            Varchar(  250),
   @w_indice                Varchar(  100),
   @w_server                Varchar(  100),
   @w_usuario               Varchar(  Max),
   @w_idMotivoCorreo        Smallint,
   @w_idAplicacion          Smallint,
   @w_idTipoNotificacion    Tinyint,
   @w_tiempo                Integer,
   @w_idUsuarioAct          Integer,
   @w_segundos              Integer,
   @w_registros             Integer,
   @w_idObjeto              Integer,
   @w_fechaProc             Datetime,
   @w_ruta                  Varchar(  150),
   @w_log                   Varchar(  150),
   @w_Archivo               Varchar(  150),
   @w_ArchivoSalida         Varchar(  150),
   @w_url                   Varchar(  250),
   @w_parametroURL          Varchar(  250),
   @w_grupoCorreo           Varchar(   20),
   @w_ambiente              Varchar(  250),
   @w_incidencia            Varchar(  850),
   @w_parametros            Varchar(  Max),
   @w_mensaje               Varchar(  Max),
   @w_proceso               Varchar(  100),
   @w_ip                    Varchar(   30),
   @w_query                 Varchar( 1000),
   @w_periodicidad          Varchar(   60),
   @w_sql                   NVarchar(4000),
   @w_param                 NVarchar( 750),
   @w_servidor              Sysname,
   @w_tabla                 Sysname,
   @w_dbname                Sysname,
   @w_instancia             Sysname,
   @w_base                  Sysname,
   @w_objeto                Sysname,
   @w_fechaAct              Datetime,
   @w_idProceso             Integer,
   @w_secuencia             Integer,
   @w_minutosEspera         Integer,
   @w_linea                 Integer,
   @w_idEstatus             Tinyint;

Begin
/*

Objetivo:    Validación de Consultas Bloquedas en la Base de Datos.
Programador: Pedro Felipe Zambrano
Fecha:       06/05/2025


*/
   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    Off

--
-- Inicializamos Variables
--

   Select @PnEstatus            = 0,
          @PsMensaje            = '',
          @w_server             = @@ServerName,
          @w_servidor           = @@ServerName,
          @w_instancia          = @@servicename,
          @w_idMotivoCorreo     = 109,
          @w_idAplicacion       = 27,
          @w_secuencia          = 0,
          @w_fechaAct           = Getdate(),
          @w_dbname             = Db_name(),
          @w_ip                 = dbo.Fn_BuscaDireccionIP(),
          @w_indice             = Substring('IDX_' + Replace(Cast(newid() As Varchar(100)), '-', ''), 1, 30);

   Select @w_ip = Replace(@w_ip, '(', ''),
          @w_ip = Replace(@w_ip, ')', '');

   If @w_servidor like '%'+ Char(92) + '%'
      Begin
         Set @w_servidor = dbo.Fn_splitStringColumna(@w_servidor, Char(92), 1)
      End

--
-- Creación de Tablas
--

   Create Table #TempBloqueosBD
   (secuencia              Integer         Not Null  Identity(1, 1) Primary Key,
    servidor               Sysname                   Collate SQL_Latin1_General_CP1_CI_AS,
    baseDatos              Sysname                   Collate SQL_Latin1_General_CP1_CI_AS,
    sessionID              Integer         Not Null,
    esource_type           Nvarchar(120)   Not Null,
    objectName             Sysname                   Collate SQL_Latin1_General_CP1_CI_AS,
    resource_description   Nvarchar(512)       Null,
    reque]]></definition>
         <parameters>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spp_validaTiempoProcesos" type="PROCEDURE">
         <comment><![CDATA[Procedimiento de Validación de Tiempos Excesivos de Proceso.]]></comment>
         <definition language="SQL"><![CDATA[/*
Declare
   @PnEstatus               Integer      = 0,
   @PsMensaje               Varchar(250) = Null

Begin
   Execute dbo.Spp_validaTiempoProcesos @PnEstatus      = @PnEstatus     Output,
                                        @PsMensaje      = @PsMensaje     Output;

   Select @PnEstatus, @PsMensaje

   Return

End
Go
*/

Create   Procedure dbo.Spp_validaTiempoProcesos
  (@PnEstatus               Integer      = 0    Output,
   @PsMensaje               Varchar(250) = Null Output)
As

Declare
   @w_error                 Integer,
   @w_desc_error            Varchar( 250),
   @w_indice                Varchar( 100),
   @w_ambiente              Varchar( 100),
   @w_usuario               Varchar(  Max),
   @w_idMotivoCorreo        Smallint,
   @w_idAplicacion          Smallint,
   @w_idTipoNotificacion    Tinyint,
   @w_tiempo                Integer,
   @w_idUsuarioAct          Integer,
   @w_segundos              Integer,
   @w_registros             Integer,
   @w_secuencia             Integer,
   @w_idObjeto              Integer,
   @w_sql                   NVarchar(1500),
   @w_param                 NVarchar( 750),
   @w_query                 Nvarchar( Max),
   @w_ruta                  Varchar(  150),
   @w_log                   Varchar(  250),
   @w_Archivo               Varchar(  250),
   @w_ArchivoSalida         Varchar(  250),
   @w_parametroURL          Varchar(  250),
   @w_url                   Varchar(  250),
   @w_grupoCorreo           Varchar(   20),
   @w_ip                    Varchar(   30),
   @w_incidencia            Varchar(  850),
   @w_parametros            Varchar(  Max),
   @w_proceso               Varchar(  100),
   @w_server                Varchar(  100),
   @w_servidor              Sysname,
   @w_tabla                 Sysname,
   @w_dbname                Sysname,
   @w_instancia             Sysname,
   @w_base                  Sysname,
   @w_objeto                Sysname,
   @w_fechaAct              Datetime,
   @w_fechaProc             Datetime,
   @w_idProceso             Integer;


Begin
/*

Objetivo:    Validación de Tiempos Excesivos de Proceso.
Programador: Pedro Felipe Zambrano
Fecha:       06/05/2025


*/
   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    Off

--
-- Inicializamos Variables
--

   Select @PnEstatus            = 0,
          @PsMensaje            = '',
          @w_server             = @@ServerName,
          @w_servidor           = @@ServerName,
          @w_instancia          = @@servicename,
          @w_idMotivoCorreo     = 110,
          @w_idAplicacion       = 27,
          @w_secuencia          = 0,
          @w_fechaAct           = Getdate(),
          @w_fechaProc          = @w_fechaAct,
          @w_dbname             = Db_name(),
          @w_ip                 = dbo.Fn_BuscaDireccionIP(),
          @w_indice             = Substring('IDX_' + Replace(Cast(newid()  As Varchar(100)), '-', ''), 1, 30);

   If @w_server like '%'+ Char(92) + '%'
      Begin
         Set @w_server = dbo.Fn_splitStringColumna(@w_server, Char(92), 1)
      End

--
-- Creación de Tablas
--

   Create Table #TiemposEjecucionTbl
   (secuencia                Integer        Not Null Identity (1, 1) Primary Key,
    sessionId                Integer        Not Null,
    servidor                 Sysname        Not Null,
    status                   Varchar (100)      Null,
    databaseName             Sysname        Not Null,
    individualQuery          Varchar (Max)      Null,
    parentQuery              Nvarchar(Max)      Null,
    programName              Sysname            Null,
    tiempoEjecucion          Integer        Not Null,
    fechaInicioProceso       Datetime       Not Null,
    idObjeto                 Integer        Not Null,
    objeto                   Sysname            Null);

   Set @w_sql = Concat('Create index ', @w_indice,  ' On #TiemposEjecu]]></definition>
         <parameters>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spu_catGeneralesTbl" type="PROCEDURE">
         <comment><![CDATA[Procedimiento de Actualización de Registros de la tabla de catálogos generales.]]></comment>
         <definition language="SQL"><![CDATA[/*
Declare
   @PsTabla                   Sysname       = 'test',
   @PsColumna                 Sysname       = 'test',
   @PnValor                   Smallint      = 1,
   @PsDescripcion             Varchar(  60) = 'Prueba',
   @PnEstatus                 Integer       = 0,
   @PsMensaje                 Varchar( 250) = ' '
Begin
   Execute dbo.Spu_catGeneralesTbl @PsTabla       = @PsTabla,
                                   @PsColumna     = @PsColumna,
                                   @PnValor       = @PnValor,
                                   @PsDescripcion = @PsDescripcion,
                                   @PnEstatus     = @PnEstatus Output,
                                   @PsMensaje     = @PsMensaje Output;
                                   
   Select @PnEstatus Error, @PsMensaje Mensaje

   Return

End
Go

*/

Create   Procedure dbo.Spu_catGeneralesTbl
  (@PsTabla                   Sysname,
   @PsColumna                 Sysname,
   @PnValor                   Smallint,
   @PsDescripcion             Varchar(  60),
   @PnEstatus                 Integer       = 0   Output,
   @PsMensaje                 Varchar( 250) = ' ' Output)

As
Declare
   @w_sql               Varchar(Max),
   @w_desc_error        Varchar( 250),
   @w_Error             Integer

Begin
/*
Objetivo: Actualización de Registros de la tabla de catálogos generales.
Versión:  1
*/

   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    On
   Set Ansi_Warnings On
   Set Ansi_Padding  On

   Select @PnEstatus  = 0,
          @PsMensaje  = Null

   If Not Exists (Select Top 1 1
                  From   catGeneralesTbl
                  Where  tabla   = @PsTabla
                  And    columna = @PsColumna
                  And    valor   = @PnValor)
      Begin
         Select @PnEstatus = 2022,
                @PsMensaje = dbo.Fn_Busca_MensajeError(@PnEstatus)
         Set Xact_Abort Off
         Return
     End

   Begin Try
      Update catGeneralesTbl
      Set    descripcion = @PsDescripcion
      Where  tabla   = @PsTabla
      And    columna = @PsColumna
      And    valor   = @PnValor
   End Try

   Begin Catch
      Select  @w_Error      = @@Error,
              @w_desc_error = Substring (Error_Message(), 1, 230)
   End   Catch

   If Isnull(@w_Error, 0) <> 0
      Begin
         Select @PnEstatus = @w_Error,
                @PsMensaje = 'Error.: ' + Rtrim(Ltrim(Cast(@w_Error As Varchar))) + ' ' + @w_desc_error

         Set Xact_Abort Off
         Return
      End

   Set Xact_Abort Off
   Return
End]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsTabla" type="nvarchar"/>
            <parameter mode="IN" name="@PsColumna" type="nvarchar"/>
            <parameter mode="IN" name="@PnValor" type="smallint"/>
            <parameter mode="IN" name="@PsDescripcion" type="varchar"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spu_catMensajesErroresTbl" type="PROCEDURE">
         <comment/>
         <definition language="SQL"><![CDATA[/*

Procedimiento que actualiza los valores de la tabla de Catalogos Mensajes de Errores.

Declare
   @PnIdError            Varchar(  90)   = Null,
   @PsMensaje            Varchar( 250)   = Null,
   @PnIdUsuarioAct       Integer         = 1,
   @PdFechaAct           Datetime        = Null,
   @PsIpAct              Varchar(30)     = Null,
   @PsMacAddressAct      Varchar(30)     = Null,
   @PnEstatus            Integer         = 0,
   @PsMensajeR           Varchar( 250)   = ' '

Begin
   Execute  dbo.Spu_catMensajesErroresTbl @PnIdError       = @PnIdError,
                                          @PsMensaje       = @PsMensaje,
                                          @PnIdUsuarioAct  = @PnIdUsuarioAct,
                                          @PdFechaAct      = @PdFechaAct,
                                          @PsIpAct         = @PsIpAct,
                                          @PsMacAddressAct = @PsMacAddressAct,
                                          @PnEstatus       = @PnEstatus Output,
                                          @PsMensajeR      = @PsMensajeR Output

   If @PnEstatus != 0
      Begin
         Select @PnEstatus, @PsMensajeR
      End

   Return

End
Go

*/

Create   Procedure dbo.Spu_catMensajesErroresTbl
    (@PnIdError         Integer       = Null,
     @PsMensaje         Varchar( 250) = Null,
     @PnIdUsuarioAct    Integer,
     @PdFechaAct        Datetime      = Null,
     @PsIpAct           Varchar(30)   = Null,
     @PsMacAddressAct   Varchar(30)   = Null,
     @PnEstatus         Integer       = 0   Output,
     @PsMensajeR        Varchar( 250) = ' ' Output)
As
Declare
    @w_sql               Varchar(Max),
    @w_desc_error        Varchar( 250),
    @w_Error             Integer,
    @w_comilla           Char(1),
    @w_registros         Integer,
    @w_fechaAct          Datetime,
    @w_ipAct             Varchar(30),
    @w_macAddressAct     Varchar(30);

Begin
/*
Objetivo: Actualizar el Catálogo de Errores.
Version:  1
*/

   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    On

   Select @PnEstatus       = 0,
          @PsMensajeR      = Null,
          @w_comilla       = Char(39),
          @w_fechaAct      = Isnull(@PdFechaAct, Getdate()),
          @w_ipAct         = Isnull(@PsipAct,            dbo.Fn_BuscaDireccionIP()),
          @w_macAddressAct = Isnull(@w_macAddressAct, dbo.Fn_Busca_DireccionMac());

--

   Set @PnEstatus = dbo.Fn_ValidaUsuario(@PnIdUsuarioAct)

   If @PnEstatus <> 0
      Begin
         Set @PsMensajeR =  dbo.Fn_Busca_MensajeError(@PnEstatus)

         Set Xact_Abort Off
         Return
      End
--

   If Not Exists ( Select top 1 1
                   From   dbo.catMensajesErroresTbl
                   Where  idError = @PnIdError)
      Begin
         Select @PnEstatus  = 6204,
                @PsMensajeR = dbo.Fn_Busca_MensajeError(@PnEstatus)

         Set Xact_Abort Off
         Return
      End

   Set @w_sql = 'Update dbo.catMensajesErroresTbl
                 Set    fechaAct      = ' + @w_comilla + Cast(@w_fechaAct As Varchar)  + @w_comilla + ',
                         ipAct         = ' + @w_comilla + @w_ipAct                     + @w_comilla + ',
                         macAddressAct = ' + @w_comilla + @w_macAddressAct             + @w_comilla

   If @PsMensaje Is Not Null
      Begin
         Set @w_sql = @w_sql + ' ,mensaje = ' + @w_comilla + trim(@PsMensaje) + @w_comilla
      End

   Set @w_sql = Concat(@w_sql, ' Where   idError = ', @PnIdError);

   Begin Try
      Execute (@w_sql)
      Set  @w_registros = @@Rowcount
   End Try

   Begin Catch
      Select  @w_Error      = @@Error,
              @w_desc_error = Substring (Error_Message(), 1, 230)
   End   Catch

   If Isnull(@w_Error, 0) <> 0
      Begin
         Select @PnEstatus  = @w_Error,
                @PsMensajeR = 'Error.: ' + Rtrim(Ltrim(Cast(@w_Er]]></definition>
         <parameters>
            <parameter mode="IN" name="@PnIdError" type="int"/>
            <parameter mode="IN" name="@PsMensaje" type="varchar"/>
            <parameter mode="IN" name="@PnIdUsuarioAct" type="int"/>
            <parameter mode="IN" name="@PdFechaAct" type="datetime"/>
            <parameter mode="IN" name="@PsIpAct" type="varchar"/>
            <parameter mode="IN" name="@PsMacAddressAct" type="varchar"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensajeR" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="Spu_conParametrosGralesTbl" type="PROCEDURE">
         <comment><![CDATA[Procedimiento de Actualización de Registros de la tabla de parámetros generales.]]></comment>
         <definition language="SQL"><![CDATA[/*
Declare
   @PnIdParametroGral    Smallint,
   @PsDescripcion        Varchar(  100),
   @PnParametroNumber    Numeric(24, 6),
   @PsParametroChar      Varchar(  150),
   @PdParametroFecha     Datetime,
   @PnIdUsuarioAct       Integer,
   @PsIpAct              Varchar(   30)   = Null,
   @PsMacAddressAct      Varchar(   30)   = Null,
   @PnEstatus            Integer          = 0,
   @PsMensaje            Varchar(  250)   = ' '

   Execute dbo.Spu_conParametrosGralesTbl @PnIdParametroGral = @PnIdParametroGral,
                                          @PsDescripcion     = @PsDescripcion,
                                          @PnParametroNumber = @PnParametroNumber,
                                          @PsParametroChar   = @PsParametroChar,
                                          @PdParametroFecha  = @PdParametroFecha,
                                          @PnIdUsuarioAct    = @PnIdUsuarioAct,
                                          @PsIpAct           = @PsIpAct,
                                          @PsMacAddressAct   = @PsMacAddressAct,
                                          @PnEstatus         = @PnEstatus     Output,
                                          @PsMensaje         = @PsMensaje     Output;



   Select @PnEstatus Error, @PsMensaje Mensaje

   Return

End
Go
*/

Create   Procedure dbo.Spu_conParametrosGralesTbl
  (@PnIdParametroGral    Smallint,
   @PsDescripcion        Varchar(  100),
   @PnParametroNumber    Numeric(24, 6),
   @PsParametroChar      Varchar(  150),
   @PdParametroFecha     Datetime,
   @PnIdUsuarioAct       Integer,
   @PsIpAct              Varchar(   30)   = Null,
   @PsMacAddressAct      Varchar(   30)   = Null,
   @PnEstatus            Integer          = 0    Output,
   @PsMensaje            Varchar(  250)   = ' '  Output)
As

Declare
   @w_desc_error          Varchar( 250),
   @w_Error               Integer,
   @w_fechaAct            Datetime,
   @w_sql                 Varchar(Max),
   @w_ipAct               Varchar(   30),
   @w_macAddressAct       Varchar(   30),
   @w_comilla             Char(1);

Begin
/*
Objetivo: Actualización de Registros de la tabla de Parámetros generales.
Versión:  1
*/

   Set Quoted_identifier Off
   Set Nocount            On
   Set Xact_Abort         On
   Set Ansi_Nulls        Off

   Select @PnEstatus       = 0,
          @PsMensaje       = Char(32),
          @w_fechaAct      = GetDate(),
          @w_comilla       = Char(39),
          @w_ipAct         = Isnull(@PsIpAct,         dbo.Fn_BuscaDireccionIP()),
          @w_macAddressAct = Isnull(@PsMacAddressAct, dbo.Fn_Busca_DireccionMac());


   If Not Exists ( Select Top 1 1
                   From   conParametrosGralesTbl
                   Where  idParametroGral = @PnIdParametroGral)
      Begin
         Select @PnEstatus = 2026,
                @PsMensaje = Dbo.Fn_Busca_MensajeError(@PnEstatus)
         Set Xact_Abort Off
         Return
      End

   Set @w_sql = Concat('Update dbo.conParametrosGralesTbl ',
                       'Set idUsuarioAct      = ', @PnIdUsuarioAct, ', ',
                           'fechaAct          = ', @w_comilla, @w_fechaAct,      @w_comilla,  ', ',
                           'ipAct             = ', @w_comilla, @w_ipAct,         @w_comilla, ', ',
                           'macAddressAct     = ', @w_comilla, @w_macAddressAct, @w_comilla);

   If @PsDescripcion Is Not Null
      Begin
         Set @w_sql = Concat(@w_sql, ', descripcion = ', @w_comilla,  @PsDescripcion, @w_comilla);
      End

   If @PnParametroNumber Is Not Null
      Begin
         Set @w_sql = Concat(@w_sql, ',  parametroNumber = ',@PnParametroNumber);
      End

   If @PsParametroChar Is Not Null
      Begin
         Set @w_sql = Concat(@w_sql, ', parametroChar = ', @w_comilla, @PsParametroChar, @w_comilla);
      End

   If @PdParametroFecha Is Not Null
      Begin
         Set]]></definition>
         <parameters>
            <parameter mode="IN" name="@PnIdParametroGral" type="smallint"/>
            <parameter mode="IN" name="@PsDescripcion" type="varchar"/>
            <parameter mode="IN" name="@PnParametroNumber" type="numeric"/>
            <parameter mode="IN" name="@PsParametroChar" type="varchar"/>
            <parameter mode="IN" name="@PdParametroFecha" type="datetime"/>
            <parameter mode="IN" name="@PnIdUsuarioAct" type="int"/>
            <parameter mode="IN" name="@PsIpAct" type="varchar"/>
            <parameter mode="IN" name="@PsMacAddressAct" type="varchar"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="READS" deterministic="false" name="fn_DesEncrypta64" returnType="varchar" type="FUNCTION">
         <comment/>
         <definition language="SQL"><![CDATA[--
-- Select dbo.fn_DesEncrypta64 ('SGVsbG8gQmFzZTY0')
--

Create   Function dbo.fn_DesEncrypta64
  (@PsInput    Varchar(Max))
Returns Varchar(max)
As
Begin
   Declare
      @o_salida    Varchar(Max);

   Begin
      Set @o_salida = cast('' as xml).value('xs:base64Binary(sql:variable("@PsInput"))', 'Varbinary(max)')

   End
   
   Return @o_salida
End;]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsInput" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="READS" deterministic="false" name="fn_EncryptBase64" returnType="nvarchar" type="FUNCTION">
         <comment/>
         <definition language="SQL"><![CDATA[CREATE FUNCTION dbo.fn_EncryptBase64
(
    @Input NVARCHAR(MAX)
)
RETURNS NVARCHAR(MAX)
AS
BEGIN
    DECLARE @Binary VARBINARY(MAX) = CONVERT(VARBINARY(MAX), @Input);
    DECLARE @Base64 NVARCHAR(MAX);

    -- Convierte el binario a Base64 usando XML
    SET @Base64 = CAST('' AS XML).value('xs:base64Binary(sql:variable("@Binary"))', 'VARCHAR(MAX)');

    RETURN @Base64;
END;]]></definition>
         <parameters>
            <parameter mode="IN" name="@Input" type="nvarchar"/>
         </parameters>
      </routine>
      <routine dataAccess="READS" deterministic="false" name="fn_Encrypta64" returnType="varchar" type="FUNCTION">
         <comment/>
         <definition language="SQL"><![CDATA[--
-- Select dbo.fn_Encrypta64 ('Hello Base64')
--

Create   Function dbo.fn_Encrypta64
(@PsInput    Varchar(Max))
Returns varchar(max)
As
Begin
   Declare
      @o_salida    varchar(max),
      @w_Binary     Varbinary(Max);

   Begin
      Set @w_Binary = CONVERT(Varbinary(Max), @PsInput);

      Set @o_salida = cast('' as xml).value('xs:base64Binary(sql:variable("@w_Binary"))', 'varchar(max)') 

   End
   
   Return @o_salida
End;]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsInput" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="spc_Lista_Det_Procedimientos" type="PROCEDURE">
         <comment><![CDATA[Procedimiento que Consulta los parámetros de los Procedimientos declarados en la base de datos.]]></comment>
         <definition language="SQL"><![CDATA[/*
Declare
   @PsProc       Sysname      = Null,
   @PnEstatus    Integer      = 0,
   @PsMensaje    Varchar(250) = ' ';
Begin
   Execute dbo.spc_Lista_Det_Procedimientos @PsProc    = @PsProc,
                                            @PnEstatus = @PnEstatus Output,
                                            @PsMensaje = @PsMensaje Output;
   If @PnEstatus != 0
      Begin
         Select @PnEstatus, @PsMensaje;
      End

   Return

End
Go
*/

Create   Procedure dbo.spc_Lista_Det_Procedimientos
  (@PsProc       Sysname      = Null,
   @PnEstatus    Integer      = 0    Output,
   @PsMensaje    Varchar(250) = ' '  Output)
As

Begin
   Set Nocount       On
   Set Xact_Abort    On

   create table #Tempsps(
    objeto_id              Integer,
    Procedimiento          Varchar(150),
    Posicion               Smallint,
    TipoParametro          Varchar( 10),
    NombreParametro        Varchar(100),
    TipoDato               Varchar( 30),
    Longitud               Integer,
    Precision              Integer,
    Escala                 Integer,
    Collation              Varchar(150),
    FechaCreacion          Varchar( 10),
    FechaAct               Varchar( 10));

    Insert into #Tempsps
    Select S.object_id,             P.SPECIFIC_NAME,
           P.ordinal_position,      P.PARAMETER_MODE,  P.PARAMETER_NAME,  P.DATA_TYPE,         P.CHARACTER_MAXIMUM_LENGTH,
           P.NUMERIC_PRECISION,     P.NUMERIC_SCALE,   P.COLLATION_NAME,
           Convert(Varchar(10),     R.CREATED,      121),
           Convert(Varchar(10),     R.LAST_ALTERED, 121)
    From   Information_schema.Parameters P
    Join   Information_schema.Routines R
    On     R.specific_name = P.specific_name
    Join   sys.objects S
    On     S.name = R.SPECIFIC_NAME
    Where  R.ROUTINE_TYPE = 'PROCEDURE'
    Order By P.SPECIFIC_NAME, P.ORDINAL_POSITION;

    If @PsProc Is Not Null
       Begin
          Delete #Tempsps
          Where  Procedimiento Not Like Concat('%', @PsProc, '%');
       End

    Update #Tempsps
    Set    Procedimiento     = Char(32),
           FechaCreacion     = Char(32),
           FechaAct          = Char(32)
    Where  Posicion  > 1;

    Update #Tempsps
    Set    Longitud     = Isnull(Longitud,  Char(32)),
           Precision    = Isnull(Precision, Char(32)),
           Escala       = Isnull(Escala,    Char(32)),
           Collation    = Isnull(Collation, Char(32));


    Select Procedimiento,  Posicion,           TipoParametro "Tipo Parametro",
           NombreParametro "Nombre Parametro", TipoDato      "Tipo Dato",
           Longitud,       Precision           "Precision Numerica",  Escala,     Collation,
           FechaCreacion "Fecha Creacion",   FechaAct "Fecha Últ Act"
    From   #Tempsps
    Order By objeto_id, Posicion;

    Return

End]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsProc" type="nvarchar"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="spc_busca_campos" type="PROCEDURE">
         <comment><![CDATA[Procedimiento que Consulta las tablas que contengan un campo solicitado.]]></comment>
         <definition language="SQL"><![CDATA[/*
Declare
   @PsCampo         Sysname      = Null,
   @PnEstatus       Integer      = 0,
   @PsMensaje       Varchar(250) = ' ';
Begin
   Execute dbo.spc_busca_campos        @PsCampo      = @PsCampo,
                                       @PnEstatus    = @PnEstatus Output,
                                       @PsMensaje    = @PsMensaje Output;
   If @PnEstatus != 0
      Begin
         Select @PnEstatus, @PsMensaje;
      End

   Return

End
Go
*/

Create   Procedure spc_busca_campos
  (@PsCampo    Sysname,
   @PnEstatus  Integer       = 0  Output,
   @PsMensaje  Varchar( 250) = '' Output)
-- With Encryption
As

Declare
   @w_desc_error              Varchar( 250),
   @w_Error                   Integer,
   @w_registros               Integer;

Begin
   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    On
   Set Ansi_Warnings On
   Set Ansi_Padding  On

   Select @PnEstatus  = 0,
          @PsMensaje  = '';

   Begin Try
      Select a.name, b.name, b.column_id
      From   sys.tables a, sys.columns b
      Where  a.object_id = b.object_id
      And    b.name      Like '%' + rtrim(ltrim(@Pscampo)) + '%'
      Order by 3, 1;
      Set @w_registros = @@Rowcount
   End Try

   Begin Catch
      Select  @w_Error      = @@Error,
              @w_desc_error = Substring (Error_Message(), 1, 230)
   End   Catch

   If Isnull(@w_Error, 0) <> 0
      Begin
         Select @PnEstatus = @w_Error,
                @PsMensaje = 'Error.: ' + Rtrim(Ltrim(Cast(@w_Error As Varchar))) + ' ' + @w_desc_error
         Set Xact_Abort Off
         Return
      End

   If Isnull(@w_registros, 0) <> 0
      Begin
         Select @PnEstatus = 99,
                @PsMensaje = dbo.Fn_Busca_MensajeError(@PnEstatus);

         Set Xact_Abort Off
         Return
      End

   Set Xact_Abort Off
   Return

End]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsCampo" type="nvarchar"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="spd_conProcesosTbl" type="PROCEDURE">
         <comment/>
         <definition language="SQL"><![CDATA[create Procedure [dbo].[spd_conProcesosTbl]
  (@PnIdProceso               Integer,
   @PnIdUsuarioAct            Integer,
   @PnEstatus                 Integer       = 0   Output,
   @PsMensaje                 Varchar( 250) = ' ' Output)
As

Declare
   @w_desc_error              Varchar( 250),
   @w_Error                   Integer,
   @w_fechaAct                Datetime,
   @w_idEstatus               Bit

Begin
   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    On
   Set Ansi_Warnings On
   Set Ansi_Padding  On

   Select @PnEstatus       = 0,
          @w_idEstatus     = 1,
          @PsMensaje       = Null,
          @w_fechaAct      = Getdate()

--
   Select @PnEstatus = dbo.Fn_ValidaUsuario(@PnIdUsuarioAct)
   If @PnEstatus != 0
      Begin
         Set @PsMensaje = Dbo.Fn_Busca_MensajeError(@PnEstatus)

         Set Xact_Abort Off
         Return
      End
--

   If Not Exists ( Select Top 1 1
                   From   conProcesosTbl
                   Where   idProceso = @PnIdProceso)
      Begin
         Select @PnEstatus = 6308,
                @PsMensaje = 'Error.: ' + Dbo.Fn_Busca_MensajeError(@PnEstatus)

         Set Xact_Abort Off
         Return
      End

   Begin Try
      Delete  conProcesosTbl
      Where   idProceso = @PnIdProceso
   End Try

   Begin Catch
      Select  @w_Error      = @@Error,
              @w_desc_error = Substring (Error_Message(), 1, 230)
   End   Catch

   If Isnull(@w_Error, 0) <> 0
      Begin
         Select @PnEstatus = @w_Error,
                @PsMensaje = 'Error.: ' + Rtrim(Ltrim(Cast(@w_Error As Varchar(10)))) + ' ' + @w_desc_error
      End

   Set Xact_Abort Off
   Return

End]]></definition>
         <parameters>
            <parameter mode="IN" name="@PnIdProceso" type="int"/>
            <parameter mode="IN" name="@PnIdUsuarioAct" type="int"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="spp_DepuracionTablasLog" type="PROCEDURE">
         <comment><![CDATA[Procedimiento que Depura tablas de movimientos y logs.]]></comment>
         <definition language="SQL"><![CDATA[/*
Declare
   @PnEstatus                 Integer        = 0,
   @PsMensaje                 Varchar (250)  = ' '
Begin
   Execute dbo.spp_DepuracionTablasLog @PnEstatus = @PnEstatus Output,
                                       @PsMensaje = @PsMensaje Output;

   Select @PnEstatus, @PsMensaje
   Return

End

*/


Create   Procedure dbo.spp_DepuracionTablasLog
  (@PnEstatus                 Integer        = 0   Output,
   @PsMensaje                 Varchar (250)  = ' ' Output)
As

Declare
   @w_desc_error              Varchar( 250),
   @w_sql                     Varchar( Max),
   @w_fecha                   Date,
   @w_Error                   Integer,
   @w_dias                    Integer,
   @w_linea                   Integer,
   @w_tabla                   Sysname,
   @w_comilla                 Char(1);

Begin
   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    On

   Select @PnEstatus         = 0,
          @PsMensaje         = '',
          @w_comilla         = Char(39);

   Select @w_dias = parametroNumber
   From   dbo.conParametrosGralesTbl
   Where  idParametroGral = 17
   Set    @w_dias = Isnull(@w_dias, 90) * -1


   Set @w_fecha  =  DateAdd(dd, @w_dias, Getdate())


   If Exists (Select Top 1 1
              From   sysobjects
              Where  Uid  = 1
              And    Type = 'U'
              And    Name = 'movDatosAdicionalesCorreoTbl')
      Begin
         Begin Try
            Delete dbo.movDatosAdicionalesCorreoTbl
            Where  idProceso In (Select idProceso
                                 From   dbo.conProcesosTbl
                                 Where  Cast(fechaProgramada As Date) <  @w_fecha );

         End Try

         Begin Catch
            Select  @w_Error      = @@Error,
                    @w_desc_error = Substring (Error_Message(), 1, 230),
                    @w_linea      = error_line();

         End   Catch

         If Isnull(@w_Error, 0) <> 0
            Begin
               Select @PnEstatus = @w_Error,
                      @PsMensaje = Concat('Error.: ', @w_Error, ' ',  @w_desc_error, ' En Línea ', @w_linea);

               Insert Into dbo.tmpLogError
               (error, descripcion)
               Select @w_Error, Concat(@w_desc_error, ' Tabla: ', 'movDatosAdicionalesCorreoTbl', ' Línea ', @w_linea);

               Set Xact_Abort Off
               Return
            End
      End

    -- conEmisionNotificacionesTbl*

   If Exists (Select Top 1 1
              From   sysobjects
              Where  Uid  = 1
              And    Type = 'U'
              And    Name = 'conEmisionNotificacionesTbl')
      Begin
         Begin Try
            Delete dbo.conEmisionNotificacionesTbl
            Where  Cast(fechaEnvioNotificacion As Date) < @w_fecha
         End Try

         Begin Catch
            Select  @w_Error      = @@Error,
                    @w_desc_error = Substring (Error_Message(), 1, 230),
                    @w_linea      = error_line();

          End   Catch

          If Isnull(@w_Error, 0) <> 0
             Begin
               Select @PnEstatus = @w_Error,
                      @PsMensaje = Concat('Error.: ', @w_Error, ' ',  @w_desc_error, ' En Línea ', @w_linea);

               Insert Into dbo.tmpLogError
               (error, descripcion)
               Select @w_Error, Concat(@w_desc_error, ' Tabla: ', 'conEmisionNotificacionesTbl', ' Línea ', @w_linea);

               Set Xact_Abort Off
               Return
            End

       End

   -- movProcesosDetELTbl

   If Exists (Select Top 1 1
              From   sysobjects
              Where  Uid  = 1
              And    Type = 'U'
              And    Name = 'movProcesosDetELTbl')
      Begin
         Begin Try
            Delete dbo.movProcesosDetELTbl
            Where  Cast(fechaInicio As Date) < @w_fecha
         End Try

         Begin Catch]]></definition>
         <parameters>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="spp_notificaObjetosNoValidos" type="PROCEDURE">
         <comment><![CDATA[Genera Notificación de las Objetos de la Base de Datos no Válidos.]]></comment>
         <definition language="SQL"><![CDATA[/*

Declare
   @PnIdProceso             Integer      = 0,
   @PnIdUsuarioAct          Integer      = 18,
   @PnEstatus               Integer      = 0,
   @PsMensaje               Varchar(250);

Begin
   Execute dbo.spp_notificaObjetosNoValidos @PnIdProceso    = @PnIdProceso,
                                             @PnIdUsuarioAct = @PnIdUsuarioAct,
                                             @PnEstatus      = @PnEstatus Output,
                                             @PsMensaje      = @PsMensaje Output;

   If @PnEstatus != 0
      Begin
         Select @PnEstatus As Estatus, @PsMensaje As Mensaje
     End

   Return

End
Go
*/

Create   Procedure dbo.spp_notificaObjetosNoValidos
  (@PnIdProceso                Integer,
   @PnIdUsuarioAct             Integer,
   @PnEstatus                  Integer      = 0    Output,
   @PsMensaje                  Varchar(250) = Null Output)
As

Declare
   @w_error                    Integer,
   @w_desc_error               Varchar(  250),
   @w_registros                Integer,
   @w_secuencia                Integer,
   @w_sql                      NVarchar( 1500),
   @w_param                    NVarchar(  750),
   @w_comilla                  Char(1),
   @w_basedatos                Sysname,
   @w_tablaOrigen              Sysname,
   @w_idProceso                Bigint,
   @w_linea                    Integer,
--
   @w_idSession                Varchar(  64),
   @w_idEstatus                Tinyint,
   @w_idGrupo                  Integer,
   @w_idMotivoCorreo           Integer,
   @w_parametros               Varchar( Max),
   @w_account_name             Sysname,
   @w_grupoCorreo              Varchar(  20),
   @w_idAplicacion             Integer,
   @w_fechaProc                Date,
   @w_fechaInicial             Date,
   @w_ambiente                 Varchar(100),
   @w_instancia                Sysname,
--

   @w_html                     Nvarchar( Max),

--

   @w_idAplicacionBD           Integer,
   @w_idReceptor               Integer,
   @w_aplicacion               Varchar(100),
   @w_cuerpo                   Varchar(Max),
   @w_body                     Varchar(Max),
   @w_saludo                   Varchar(100),
   @w_nombre                   Varchar(100),
   @w_correo                   Varchar(100),
   @w_asunto                   Varchar(250),
   @w_ipOrigen                 Varchar( 30),
   @w_server                   Sysname,
   @w_servidorOrigen           Sysname,
   @w_idCorreo                 Integer,
   @w_registrosUser            Integer;


Begin

/*

Objetivo:    Genera Notificación de las Objetos de la Base de Datos no Válidos.
Programador: Pedro Felipe Zambrano
Fecha:       31/10/2025
Versión:     1


*/

   Set Nocount       On
   Set Xact_Abort    On
   Set Ansi_Nulls    Off

--
-- Inicializamos Variables
--

   Select @PnEstatus            = 0,
          @PsMensaje            = '',
          @w_comilla            = Char(39),
          @w_secuencia          = 0,
          @w_saludo             = '<p>' + dbo.Fn_calculaSaludo(),
          @w_server             = @@Servername;

--
-- Búsqueda de Parámetros.
--

   Select @w_idSession          = idSession,
          @w_idMotivoCorreo     = idMotivoCorreo,
          @w_parametros         = parametros,
          @w_idEstatus          = idEstatus
   From   dbo.conProcesosTbl
   Where  idProceso = @PnIdProceso
   If @@Rowcount = 0
      Begin
         Select @PnEstatus = 3000,
                @PsMensaje = dbo.Fn_Busca_MensajeError(@PnEstatus);

         Set Xact_Abort Off
         Return
      End

   If @w_idEstatus != 1
      Begin
         Select @PnEstatus = Case When @w_idEstatus = 2
                                  Then 2999
                                  Else 3004
                             End,
                @PsMensaje = dbo.Fn_Busca_MensajeError(@PnEstatus);

         Set Xact_Abort O]]></definition>
         <parameters>
            <parameter mode="IN" name="@PnIdProceso" type="int"/>
            <parameter mode="IN" name="@PnIdUsuarioAct" type="int"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="spp_reindexa" type="PROCEDURE">
         <comment><![CDATA[Procedimiento que Realiza la reindexación de los indices.]]></comment>
         <definition language="SQL"><![CDATA[Create   Procedure spp_reindexa
  (@PsTabla      Sysname = Null)
As

Declare 
   @w_tabla       Sysname,
   @w_sql         NVarchar( 1500),
   @w_param       NVarchar(  750),
   @w_registros   Integer
  
Declare 
    C_Tablas Cursor For 
    Select Name 
    From   sys.tables a
    Where  name = Case When @PsTabla Is Null
                       Then a.name
                       Else @PsTabla
                  End
    Order  By 1
   
Begin

   Create Table #Temp
   (tabla          Sysname       Not Null,
    registros      Integer       Not Null Default 0,
    fechaInicio    Smalldatetime Not Null,
    fechatermino   Smalldatetime     Null,
    Primary Key (tabla))
    
   Open C_Tablas 
   While @@fetch_status < 1
   Begin
      Fetch C_Tablas Into @w_tabla 
      If @@Fetch_status != 0
         Begin
            Break
         End

      Select @w_sql   = 'Select @o_registros = Count(1) ' +
                        'From ' + @w_tabla,
             @w_param = ' @o_registros   Integer Output '
             
      Execute Sp_executeSQL @w_sql, @w_param, @o_registros = @w_registros Output
      
      Insert Into #Temp
      Select @w_tabla, @w_registros, Getdate(), Null
      
      DBCC Dbreindex(@w_Tabla,' ',90) 
      
      Update #Temp 
      Set     fechatermino = Getdate()
      
      
   End
   Close      C_Tablas 
   Deallocate C_Tablas
   
   Select *
   From   #Temp
   
   
   Return
   
End]]></definition>
         <parameters>
            <parameter mode="IN" name="@PsTabla" type="nvarchar"/>
         </parameters>
      </routine>
      <routine dataAccess="MODIFIES" deterministic="false" name="spu_conEmisionNotificacionesTbl" type="PROCEDURE">
         <comment><![CDATA[Procedimiento que Actualiza la tabla conEmisionNotificacionesTbl.]]></comment>
         <definition language="SQL"><![CDATA[/*
Declare
   @PnIdMonitor      Smallint  = 4,
   @PnIdOrigen      Smallint  = 2,
   @PnEstatus      Integer  = 0,
   @PsMensaje      Varchar( 250) = ' '
Begin
   Execute dbo.spu_conEmisionNotificacionesTbl @PnIdMonitor = @PnIdMonitor,
              @PnIdOrigen = @PnIdOrigen,
              @PnEstatus = @PnEstatus  Output,
              @PsMensaje = @PsMensaje  Output

   Select @PnEstatus, @PsMensaje

   Return
End
Go

*/

Create   Procedure dbo.spu_conEmisionNotificacionesTbl
  (@PnIdMonitor      Smallint,
   @PnIdOrigen       Smallint,
   @PnIdEstatus      Tinyint  = 1,
   @PnEstatus        Integer  = 0   Output,
   @PsMensaje        Varchar( 250) = ' ' Output)
As

Declare
   @w_desc_error        Varchar( 250),
   @w_fechaProc         Datetime,
   @w_idEntrega         Bigint,
   @w_idEstatus         Tinyint,
   @w_idMovimiento      Bigint,
   @w_secuencia         Integer,
   @w_notificaciones    Integer,
   @w_registros         Integer,
   @w_Error             Integer,
   @w_linea             Integer,
   @w_minutossDelay     Integer;

Begin
   Set Nocount   On
   Set Xact_Abort  On
   Set Ansi_Nulls  On

   Select @PnEstatus      = 0,
          @PsMensaje      = Char(32),
          @w_fechaProc    = Getdate(),
          @w_secuencia    = 0,
          @w_registros    = 0;

   Select @w_minutossDelay = parametroNumber
   From   dbo.conParametrosGralesTbl
   Where  idParametroGral = 13;
   If @@Rowcount = 0
      Begin
         Set @w_minutossDelay = 2
      End

   If @PnIdOrigen In (6, 7)
      Begin
         Set Xact_Abort    Off
         Return
      End

   If Not Exists ( Select Top 1 1
                   From   dbo.conEmisionNotificacionesTbl  a With (Nolock)
                   Join   dbo.catRelMonitorPushAplicacionTbl b With (Nolock)
                   On     a.idAplicacion = b.idAplicacion
                   And    a.idOrigen     = @PnIdOrigen
                   And    b.idMonitor    = @PnIdMonitor
                   And   Datediff(mi, a.fechaEnvioNotificacion, Getdate())  >= @w_minutossDelay
                   Where  a.idEstatus  In (2, 3))
   Begin
      Set Xact_Abort    Off
      Return
   End

   Begin Try
      Update dbo.conEmisionNotificacionesTbl
      Set    idEstatus    = 1,
             Observaciones   = 'Registro Reversado',
             fechaEnvioNotificacion = Null
      From   dbo.conEmisionNotificacionesTbl a
      Join   dbo.catRelMonitorPushAplicacionTbl b
      On     b.idAplicacion    = a.idAplicacion
      And    b.idMonitor       = @PnIdMonitor
      Where  a.idEstatus      In (2, 3)
      And    a.idOrigen       = @PnIdOrigen
      And    Datediff(mi, fechaEnvioNotificacion, Getdate())  >= @w_minutossDelay;

      Set @w_registros = @@Rowcount

   End Try

   Begin Catch
      Select @w_error       = Error_Number(),
             @w_desc_error  = Substring(Error_Message(), 1, 220),
             @w_linea       = error_line();
   End Catch

   If IsNull(@w_error, 0) <> 0
      Begin
         Select @PnEstatus = @w_error,
                @PsMensaje = Concat('Error: ', @w_error, ' ', @w_desc_error, ' En Linea ', @w_linea);

         Set Xact_Abort   Off
         Return
      End

   Begin Try
   Insert Into dbo.movLogMonitoresPushTbl
   (idMonitor, idOrigen, fechaInicio, registros,
    error,   comentarios)
   Select @PnIdMonitor, @PnIdOrigen, Getdate(), @w_registros,
    0 error,    'Registros Reversados'
   End Try

   Begin Catch
  Select @w_error = Error_Number(),
   @w_desc_error  = Error_Message()
   End Catch

   If IsNull(@w_error, 0) <> 0
      Begin
         Select @PnEstatus = @w_error,
                @PsMensaje = @w_desc_error,
                @w_linea   = error_line();

      End

   Set Xact_Abort  Off
   Return

End]]></definition>
         <parameters>
            <parameter mode="IN" name="@PnIdMonitor" type="smallint"/>
            <parameter mode="IN" name="@PnIdOrigen" type="smallint"/>
            <parameter mode="IN" name="@PnIdEstatus" type="tinyint"/>
            <parameter mode="INOUT" name="@PnEstatus" type="int"/>
            <parameter mode="INOUT" name="@PsMensaje" type="varchar"/>
         </parameters>
      </routine>
   </routines>
</database>
